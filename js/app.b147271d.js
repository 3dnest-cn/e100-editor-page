(function(t){function e(e){for(var o,a,s=e[0],l=e[1],c=e[2],p=0,d=[];p<s.length;p++)a=s[p],Object.prototype.hasOwnProperty.call(i,a)&&i[a]&&d.push(i[a][0]),i[a]=0;for(o in l)Object.prototype.hasOwnProperty.call(l,o)&&(t[o]=l[o]);u&&u(e);while(d.length)d.shift()();return r.push.apply(r,c||[]),n()}function n(){for(var t,e=0;e<r.length;e++){for(var n=r[e],o=!0,s=1;s<n.length;s++){var l=n[s];0!==i[l]&&(o=!1)}o&&(r.splice(e--,1),t=a(a.s=n[0]))}return t}var o={},i={app:0},r=[];function a(e){if(o[e])return o[e].exports;var n=o[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=t,a.c=o,a.d=function(t,e,n){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},a.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)a.d(n,o,function(e){return t[e]}.bind(null,o));return n},a.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="/house_plan/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],l=s.push.bind(s);s.push=e,s=s.slice();for(var c=0;c<s.length;c++)e(s[c]);var u=l;r.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"0085":function(t,e,n){"use strict";n("12fd")},"026c":function(t,e,n){},1227:function(t,e,n){},"12fd":function(t,e,n){},"14ac":function(t,e,n){"use strict";n("9018")},"2b1a":function(t,e,n){},"389a":function(t,e,n){},"3a74":function(t,e,n){},"40e4":function(t,e,n){"use strict";n("8899")},"4c00":function(t,e,n){"use strict";n("88d6")},5051:function(t,e,n){},"507d":function(t,e,n){"use strict";n("3a74")},"56d7":function(t,e,n){"use strict";n.r(e);var o={};n.r(o),n.d(o,"Line",(function(){return W})),n.d(o,"Vector",(function(){return E})),n.d(o,"Segment",(function(){return N})),n.d(o,"Point",(function(){return F}));var i={};n.r(i),n.d(i,"fromBothPoint",(function(){return B})),n.d(i,"fromSegment",(function(){return G})),n.d(i,"from",(function(){return U})),n.d(i,"dot",(function(){return H})),n.d(i,"multiply",(function(){return z})),n.d(i,"cross",(function(){return V})),n.d(i,"length",(function(){return J})),n.d(i,"rotate90",(function(){return K})),n.d(i,"normalize",(function(){return Y})),n.d(i,"invert",(function(){return q})),n.d(i,"rotate",(function(){return X})),n.d(i,"project",(function(){return Z})),n.d(i,"equal",(function(){return it}));var r={};n.r(r),n.d(r,"fromSegment",(function(){return ut})),n.d(r,"toStandard",(function(){return mt})),n.d(r,"intersectLine",(function(){return vt}));var a={};n.r(a),n.d(a,"translate",(function(){return M})),n.d(a,"toLeftOfSegment",(function(){return rt})),n.d(a,"rotate",(function(){return at})),n.d(a,"project",(function(){return st})),n.d(a,"distanceToPoint",(function(){return lt})),n.d(a,"distanceToLine",(function(){return ct})),n.d(a,"distanceToSegment",(function(){return bt})),n.d(a,"equal",(function(){return gt}));var s={};n.r(s),n.d(s,"containsPoint",(function(){return yt})),n.d(s,"area",(function(){return wt}));var l={};n.r(l),n.d(l,"symbol",(function(){return No})),n.d(l,"map",(function(){return Po}));var c={};n.r(c),n.d(c,"symbol",(function(){return Fo})),n.d(c,"typeSymbol",(function(){return Mo})),n.d(c,"toolSymbol",(function(){return Bo})),n.d(c,"map",(function(){return Go})),n.d(c,"typeMap",(function(){return Uo})),n.d(c,"toolMap",(function(){return Ho})),n.d(c,"symmetryMap",(function(){return zo}));var u={};n.r(u),n.d(u,"typeSymbol",(function(){return Vo})),n.d(u,"toolSymbol",(function(){return Io})),n.d(u,"typeMap",(function(){return Jo})),n.d(u,"toolMap",(function(){return Ko}));var p={};n.r(p),n.d(p,"typeList",(function(){return Yo})),n.d(p,"bedroomTypeList",(function(){return qo})),n.d(p,"hallTypeList",(function(){return Xo})),n.d(p,"bathroomTypeList",(function(){return Zo}));var d={};n.r(d),n.d(d,"install",(function(){return mi}));var f={};n.r(f),n.d(f,"install",(function(){return gi}));var h={};n.r(h),n.d(h,"install",(function(){return yi}));var m={};n.r(m),n.d(m,"install",(function(){return Si}));var v={};n.r(v),n.d(v,"SingleDoor",(function(){return Ai})),n.d(v,"DoubleDoor",(function(){return Ni})),n.d(v,"SlidingDoor",(function(){return Pi})),n.d(v,"ParentDoor",(function(){return Fi})),n.d(v,"Bealock",(function(){return Mi}));var b={};n.r(b),n.d(b,"BasicWindow",(function(){return Bi})),n.d(b,"BoilerWindow",(function(){return Gi})),n.d(b,"FloorWindow",(function(){return Ui})),n.d(b,"LWindow",(function(){return Hi})),n.d(b,"UWindow",(function(){return zi})),n.d(b,"LBoilerWindow",(function(){return Vi})),n.d(b,"UBoilerWindow",(function(){return Ii}));var g={};n.r(g),n.d(g,"doorResouceId",(function(){return Ji})),n.d(g,"windowResourceId",(function(){return Ki})),n.d(g,"install",(function(){return Yi})),n.d(g,"screenshoter",(function(){return qi}));var y={};n.r(y),n.d(y,"install",(function(){return rr}));var w={};n.r(w),n.d(w,"isHouse",(function(){return cr})),n.d(w,"isDrawing",(function(){return ur})),n.d(w,"fromHouse",(function(){return pr}));var k=n("d198"),x=n("7580"),O=(n("e260"),n("e6cf"),n("cca6"),n("a79d"),n("d81d"),n("b0c0"),n("d9e2"),n("b64b"),n("e9c4"),n("d3b7"),n("159b"),n("1227"),n("2b0e")),T=n("5f5b"),S=n("b1e0"),_=n("0bd7"),j=n("26a3"),C=n("ac84"),L=n("2d58"),$=Math,D=($.PI,[0,0,1,0]),W=function(t,e,n,o){return D[0]=t,D[1]=e,D[2]=n,D[3]=o,D},R=[0,0],E=function(t,e){return R[0]=t,R[1]=e,R},A=[0,0,0,0],N=function(t,e,n,o){return A[0]=t,A[1]=e,A[2]=n,A[3]=o,A},P=[0,0],F=function(t,e){return P[0]=t,P[1]=e,P},M=function(t,e,n,o){return F(t+n,e+o)},B=(n("99af"),function(t,e,n,o){return E(n-t,o-e)}),G=B,U=B,H=function(t,e,n,o){return t*n+e*o},z=function(t,e,n){return E(t*n,e*n)},V=function(t,e,n,o){return t*o-e*n},I=n("a326"),J=function(t,e){return I["b"].sqrt(H(t,e,t,e))},K=function(t,e){return E(-e,t)},Y=function(t,e){var n=J(t,e);return 0===n&&I["a"].throwError("Zero Vector CAN NOT be normalized."),E(t/n,e/n)},q=function(t,e){return E(-t,-e)},X=function(t,e,n){var o=I["b"].cos(n),i=I["b"].sin(n);return E(t*o-e*i,t*i+e*o)},Z=function(t,e,n,o){var i=Y(n,o);return z.apply(void 0,Object(_["a"])(i).concat([H.apply(void 0,[t,e].concat(Object(_["a"])(i)))]))},Q=1e-6,tt=function(t){return t<Q&&t>-Q},et=function(t,e){var n=t-e;return n<Q&&n>-Q},nt=function(t,e){return t-e>Q},ot=function(t,e){return t-e<-Q},it=function(t,e,n,o){return et(t,n)&&et(e,o)},rt=function(t,e,n,o,r,a){return nt(V.apply(i,Object(_["a"])(B(n,o,r,a)).concat(Object(_["a"])(B(r,a,t,e)))),0)},at=function(t,e,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=B(o,r,t,e);return M.apply(void 0,Object(_["a"])(X.apply(i,Object(_["a"])(a).concat([n]))).concat([o,r]))},st=function(t,e,n,o,r,a){if(gt(t,e,n,o))return F(t,e);var s=B(t,e,n,o);return tt(V.apply(i,Object(_["a"])(s).concat([r,a])))?F(n,o):M.apply(void 0,[t,e].concat(Object(_["a"])(Z.apply(i,Object(_["a"])(s).concat([r,a])))))},lt=function(t,e,n,o){return J.apply(i,Object(_["a"])(B(t,e,n,o)))},ct=function(t,e){for(var n=arguments.length,o=new Array(n>2?n-2:0),i=2;i<n;i++)o[i-2]=arguments[i];return lt.apply(void 0,[t,e].concat(Object(_["a"])(st.apply(void 0,[t,e].concat(o)))))},ut=function(t,e,n,r){var a=G(t,e,n,r),s=K.apply(i,Object(_["a"])(Y.apply(i,Object(_["a"])(a)))),l=H.apply(i,Object(_["a"])(s).concat([t,e])),c=ot(l,0)?s:q.apply(i,Object(_["a"])(s));return W.apply(o,[t,e].concat(Object(_["a"])(c)))},pt=[0,0,0],dt=0,ft=1,ht=2,mt=function(t,e,n,o){return pt[dt]=n,pt[ft]=o,pt[ht]=H(n,o,t,e),pt},vt=function(t,e,n,o,i,r,a,s){var l=mt(t,e,n,o),c=Object(j["a"])(l,3),u=c[0],p=c[1],d=c[2],f=mt(i,r,a,s),h=Object(j["a"])(f,3),m=h[0],v=h[1],b=h[2],g=u*v-p*m,y=d*v-p*b,w=u*b-d*m;return tt(g)?null:tt(p)?F(d/u,w/g):tt(v)?F(b/m,w/g):tt(u)?F(y/g,d/p):tt(m)?F(y/g,b/v):F(y/g,w/g)},bt=function(t,e,n,o,i,r){return ct.apply(void 0,[t,e].concat(Object(_["a"])(ut(n,o,i,r))))},gt=function(t,e,n,o){return et(t,n)&&et(e,o)},yt=function(t,e){for(var n=!1,o=t.length,i=0,r=o-1;i<o;r=i++){var a=t[i],s=t[r],l=a.y>e.y!==s.y>e.y&&e.x<(e.y-a.y)/(s.y-a.y)*(s.x-a.x)+a.x;l&&(n=!n)}return n},wt=function(){for(var t=arguments.length/2,e=0,n=0;n<t;n++){var o=(n+1)%t;e+=V(2*n<0||arguments.length<=2*n?void 0:arguments[2*n],2*n+1<0||arguments.length<=2*n+1?void 0:arguments[2*n+1],2*o<0||arguments.length<=2*o?void 0:arguments[2*o],2*o+1<0||arguments.length<=2*o+1?void 0:arguments[2*o+1])}return e/2};var kt,xt,Ot,Tt,St,_t,jt,Ct=n("0402"),Lt=(n("aff5"),n("a9e3"),n("caad"),n("2532"),n("a434"),function(t){return t/1e3}),$t=function(t){return 1e3*t},Dt=function(){function t(){Object(C["a"])(this,t),this.width=0,this.height=0,this.center=[0,0],this.worldOrigin=[0,0],this.referenceY=0,this.rotation=0}return Object(L["a"])(t,[{key:"bitmapUvOrigin",get:function(){var t=this.width,e=this.height,n=this.center,o=Object(j["a"])(n,2),i=o[0],r=o[1];return[i-t/2,r-e/2]}},{key:"worldOriginGeometry",get:function(){return this.bitmapUvToGeometry.apply(this,Object(_["a"])(this.worldOrigin))}},{key:"setWidth",value:function(t){this.width=t}},{key:"setHeight",value:function(t){this.height=t}},{key:"setRotation",value:function(t){this.rotation=t}},{key:"setReferenceY",value:function(t){this.referenceY=t}},{key:"setCenter",value:function(t,e){this.center=[t,e]}},{key:"setWorldOrigin",value:function(t,e){this.worldOrigin=[t,e]}},{key:"bitmapUvToGeometry",value:function(t,e){var n=this.width,o=this.height,i=this.rotation,r=this.center,s=this.bitmapUvOrigin,l=Object(j["a"])(r,2),c=l[0],u=l[1],p=Object(j["a"])(s,2),d=p[0],f=p[1];return Object(_["a"])(a.rotate(d+n*t,f+o*e,-i,c,u))}},{key:"geometryToBitmapUv",value:function(t,e){var n=this.width,o=this.height,i=this.rotation,r=this.center,s=this.bitmapUvOrigin,l=Object(j["a"])(r,2),c=l[0],u=l[1],p=Object(j["a"])(s,2),d=p[0],f=p[1],h=Object(_["a"])(a.rotate(t,e,i,c,u));return[(h[0]-d)/n,(h[1]-f)/o]}},{key:"geometryTo3D",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.referenceY,o=Object(j["a"])(this.worldOriginGeometry,2),i=o[0],r=o[1];return[Lt(t-i),n,Lt(r-e)]}},{key:"threeToGeometry",value:function(t,e){var n=this.rotation,o=Object(j["a"])(this.worldOriginGeometry,2),i=o[0],r=o[1];return Object(_["a"])(a.rotate($t(t)+i,$t(e)+r,-n,i,r))}},{key:"geometryToCaptureUv",value:function(t,e,n,o,i,r){return[(i-n)/t,(r-o)/e]}},{key:"captureUvToGeometry",value:function(t,e,n,o,i,r){return[n+t*i,o+e*r]}},{key:"bitmapUvTo3D",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.referenceY,o=this.bitmapUvToGeometry(t,e),i=Object(j["a"])(o,2),r=i[0],a=i[1];return this.geometryTo3D(r,a,n)}},{key:"bitmapUvToCaptureUv",value:function(t,e,n,o,i,r){var a=this.bitmapUvToGeometry(i,r),s=Object(j["a"])(a,2),l=s[0],c=s[1];return this.geometryToCaptureUv(t,e,n,o,l,c)}},{key:"threeToBitmapUv",value:function(t,e){var n=this.threeToGeometry(t,e),o=Object(j["a"])(n,2),i=o[0],r=o[1];return this.geometryToBitmapUv(i,r)}},{key:"threeToCaptureUv",value:function(t,e,n,o,i,r){var a=this.threeToGeometry(i,r),s=Object(j["a"])(a,2),l=s[0],c=s[1];return this.geometryToCaptureUv(t,e,n,o,l,c)}},{key:"captureUvToBitmapUv",value:function(t,e,n,o,i,r){var a=this.captureUvToGeometry(t,e,n,o,i,r),s=Object(j["a"])(a,2),l=s[0],c=s[1];return this.geometryToBitmapUv(l,c)}},{key:"captureUvTo3D",value:function(t,e,n,o,i,r){var a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:this.referenceY,s=this.captureUvToGeometry(t,e,n,o,i,r),l=Object(j["a"])(s,2),c=l[0],u=l[1];return this.geometryTo3D(c,u,a)}}]),t}(),Wt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"d-flex flex-column position-relative w-100 h-100",attrs:{id:"app"}},[n("div",[n("app-menu")],1),n("div",{staticClass:"d-flex flex-fill w-100"},[n("div",{staticClass:"h-100 w-100 overflow-hidden position-relative"},[n("div",{ref:"drawing",staticClass:"w-100 h-100",class:{"cursor-move":"transformer"===t.tool},staticStyle:{"line-height":"0"},on:{dblclick:t.useTransformerFromSelector}}),n("div",{staticClass:"position-absolute",staticStyle:{height:"calc(100% - 20px)",top:"10px",left:"10px"}},[n("app-tool-bar"),n("div",{staticClass:"position-absolute",staticStyle:{right:"-80px",bottom:"30px"}},[n("app-visible")],1)],1),n("div",{staticClass:"position-absolute",staticStyle:{height:"calc(100% - 20px)",top:"10px",right:"10px"}},[n("app-property"),n("div",{staticClass:"position-absolute",staticStyle:{left:"-350px",bottom:"90px"}},[n("app-check")],1),n("div",{staticClass:"position-absolute",staticStyle:{left:"-350px",bottom:"30px"}},[n("app-viewport")],1)],1),n("app-tool-setting"),n("app-property-card")],1)])])},Rt=[],Et=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"d-flex justify-content-between align-items-center border-bottom",attrs:{id:"menu"}},[n("div",{staticClass:"d-flex align-items-center font-weight-bold",staticStyle:{width:"500px",height:"50px","line-height":"50px"}},[n("b-img",{staticClass:"mr-3",staticStyle:{width:"21px"},attrs:{src:"img/House.svg"}}),n("span",[t._v(t._s(t.name))])],1),n("div",{staticClass:"d-flex align-items-center app-custom"},t._l(t.toolGroupList,(function(e,o){return n("div",{key:o,staticClass:"d-flex align-items-center"},[t._l(e,(function(e){return n("b-button",{directives:[{name:"show",rawName:"v-show",value:t.shownMap[e],expression:"shownMap[symbol]"}],key:e,staticClass:"menu-btn",attrs:{disabled:t.disabledMap[e]||t.readonly,pressed:e===t.active,variant:"outline-secondary"},on:{mouseenter:function(n){return t.mouseenterHandler(e)},mouseleave:t.mouseleaveHandler,click:t.clickMethods[e]}},[n("b-img",{staticStyle:{width:"24px"},attrs:{src:t.toolMap[e].image[e===t.hover?"hover":e===t.active?"active":"base"]}}),n("span",{staticClass:"mt-1 app-text-tiny"},[t._v(t._s(t.toolMap[e].label))])],1)})),o<t.toolGroupList.length-1?n("div",{staticClass:"border-left",staticStyle:{height:"50px"}}):t._e()],2)})),0),n("div",{staticClass:"d-flex flex-row-reverse",staticStyle:{width:"500px"}},[n("b-button",{staticClass:"menu-btn",attrs:{variant:"outline-secondary"},on:{mouseenter:function(e){return t.mouseenterHandler("exit")},mouseleave:t.mouseleaveHandler,click:t.showExitModal}},[n("b-img",{staticStyle:{width:"24px"},attrs:{src:"img/Exit"+("exit"===t.hover?"_Active":"")+".svg"}}),n("span",{staticClass:"mt-1 app-text-tiny"},[t._v("退出")])],1)],1),n("b-modal",{attrs:{id:"clear-modal","content-class":"custom-modal-content",title:"一键清空","hide-footer":"","hide-header-close":"",size:"sm"}},[n("div",{staticClass:"d-block text-center mt-3 mb-4"},[t._v("您确定要清空当前楼层的户型图")]),n("div",{staticClass:"d-flex justify-content-center align-items-center"},[n("b-button",{staticClass:"mr-5",attrs:{block:""},on:{click:t.clear}},[t._v("确定")]),n("b-button",{attrs:{block:"",variant:"outline-primary"},on:{click:function(e){return t.$bvModal.hide("clear-modal")}}},[t._v("取消")])],1)]),n("b-modal",{attrs:{id:"exit-modal","content-class":"custom-modal-content",title:"退出","hide-footer":"","hide-header-close":"",size:"sm"}},[n("div",{staticClass:"d-block text-center mt-3 mb-4"},[t._v("您是否要退出户型图绘制工具")]),n("div",{staticClass:"d-flex justify-content-center align-items-center"},[n("b-button",{staticClass:"mr-5",attrs:{block:""},on:{click:t.exit}},[t._v("确定")]),n("b-button",{attrs:{block:"",variant:"outline-primary"},on:{click:function(e){return t.$bvModal.hide("exit-modal")}}},[t._v("取消")])],1)]),n("b-toast",{attrs:{visible:t.opened&&t.readonly,"no-auto-hide":"","no-hover-pause":"",variant:"danger","toast-class":"custom-toast"}},[t._v("已有用户正在绘制中，暂不支持同时绘制，请稍等")])],1)},At=[],Nt=n("2fe6"),Pt=n("b192"),Ft=(n("4de4"),n("7db0"),6e5),Mt={data:function(){return{name:"",hover:"",active:this.$spec.menu.symbol.selector,locked:!1,hasWall:!1,opened:!1,readonly:!0}},computed:{toolMap:function(){return this.$spec.menu.map},toolGroupList:function(){var t=this.$spec.menu.symbol;return[[t.selector,t.transformer],[t.save,t.clear,t.lock,t.unlock]]},disabledMap:function(){var t=this.$spec.menu.symbol,e={};return Object.keys(t).forEach((function(t){return e[t]=!1})),Object(Pt["a"])(Object(Pt["a"])({},e),{},Object(Nt["a"])({},t.unlock,this.hasWall))},shownMap:function(){var t,e=this.$spec.menu.symbol,n={};return Object.keys(e).forEach((function(t){return n[t]=!0})),Object(Pt["a"])(Object(Pt["a"])({},n),{},(t={},Object(Nt["a"])(t,e.lock,!this.locked),Object(Nt["a"])(t,e.unlock,this.locked),t))},clickMethods:function(){var t,e=this,n=this.$spec.menu.symbol;return t={},Object(Nt["a"])(t,n.selector,(function(){return e.select()})),Object(Nt["a"])(t,n.transformer,(function(){return e.move()})),Object(Nt["a"])(t,n.save,(function(){return e.clickSave()})),Object(Nt["a"])(t,n.clear,(function(){return e.requestClear()})),Object(Nt["a"])(t,n.lock,(function(){return e.lock()})),Object(Nt["a"])(t,n.unlock,(function(){return e.unlock()})),t}},mounted:function(){this.init()},destroyed:function(){var t=this.$editor;t.off("opened",this._openedListener),t.off("tool-open",this._toolOpenListener),t.off("wall-create",this._wallCreateListener),t.off("wall-destroy",this._wallDestroyListener),this.closeAutoSave()},methods:{init:function(){var t=this,e=this.$editor;this.$root.$on("readonly",(function(e){t.readonly!==e&&(t.readonly=e,e?t.closeAutoSave():t.autoSave())})),e.on("opened",this._openedListener=function(n){t.name=e.feature.document.name,t.opened=!0,n&&(t.readonly=!0,t.$editor.feature.tool.closeAll())}),e.on("tool-open",this._toolOpenListener=function(e){t.active!==e&&(t.active=e)}),e.on("wall-create",this._wallCreateListener=function(){t.hasWall=!0,t.locked||t.lock(!0)}),e.on("wall-destroy",this._wallDestroyListener=function(){t.hasWallAllFloor()||(t.hasWall=!1,t.unlock())})},mouseenterHandler:function(t){this.hover=t},mouseleaveHandler:function(){this.hover=""},select:function(){this.$editor.feature.tool.openSelector()},move:function(){this.$editor.feature.tool.openTransformer()},save:function(t){var e=this;document.hidden||this.$editor.feature.document.save().then((function(){e.$root.$emit("save"),e.$bvToast.toast(t?"自动保存成功...":"保存成功",{autoHideDelay:2e3,noHoverPause:!0,toastClass:"custom-toast",variant:"default"})}))},clickSave:function(){this.$editor.resetEditorStatus(),this.save()},autoSave:function(){var t=this;this._timeout=setTimeout((function(){t.save(),t.autoSave()}),Ft)},closeAutoSave:function(){this._timeout&&clearTimeout(this._timeout)},retreat:function(){console.log("retreat")},advance:function(){console.log("advance")},hasWallAllFloor:function(){var t=this.$editor,e=t.feature.floor,n=t.solution.drawing.structure.getAllWallList(),o=e.getData().list.filter((function(t){return t.level!==e.current}));return n.length>0||o.find((function(t){return t.drawing.wallList.length>0}))},requestClear:function(){this.$bvModal.show("clear-modal")},clear:function(){this.$editor.resetEditorStatus(),this.$editor.feature.floor.clear(),this.$bvModal.hide("clear-modal"),this.hasWallAllFloor()||(this.hasWall=!1,this.unlock())},lock:function(t){var e=t?"底图已锁定，清空户型图后可解锁":"底图已锁定";this.locked=!0,this.$root.$emit("lock"),this.readonly||this.$bvToast.toast(e,{autoHideDelay:2e3,noHoverPause:!0,toastClass:"custom-toast",variant:"default"})},unlock:function(){this.locked=!1,this.$root.$emit("unlock")},showExitModal:function(){this.$bvModal.show("exit-modal")},exit:function(){var t=this;this.$editor.resetEditorStatus(),this.$editor.feature.document.save().then((function(){t.$bvModal.hide("exit-modal"),window.close()}))}}},Bt=Mt,Gt=(n("bb78"),n("0c7c")),Ut=Object(Gt["a"])(Bt,Et,At,!1,null,null,null),Ht=Ut.exports,zt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"h-100 border d-flex",attrs:{id:"tool-bar-container"}},[n("b-button-toolbar",{staticClass:"flex-column app-custom",staticStyle:{width:"60px","font-size":"12px"},attrs:{id:"app-toolgroup"}},t._l(t.toolList,(function(e,o){return n("b-button-group",{key:o,staticStyle:{padding:"9px 7px 9px 7px"}},[n("b-button",{staticClass:"d-flex flex-column align-items-center p-1 border-0",attrs:{pressed:e.id===t.active,variant:"outline-secondary",disabled:t.readonly},on:{click:function(n){return t.changeTool(e.id)}}},[n("b-img",{staticStyle:{width:"26px"},attrs:{src:e.id===t.active?e.active:e.img}}),n("span",{staticClass:"app-text-tiny mt-1"},[t._v(t._s(e.title))])],1)],1)})),1),n("div",{staticClass:"tool-bar-content"},[n("span",{staticClass:"content-button",on:{click:t.toggleConetnt}},[n("b-icon",{attrs:{icon:t.contentVisible?"caret-left-fill":"caret-right-fill"}})],1),n(t.activeTool,{tag:"component",staticClass:"content-component",class:{hidden:!t.contentVisible}})],1)],1)},Vt=[],It=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"d-flex flex-column",attrs:{id:"tool"}},[t._l(t.toolGroup,(function(e,o){return n("div",{key:e.title+o,staticClass:"px-2"},[n("div",{staticClass:"border-bottom app-text-small tool-title"},[t._v(t._s(e.title))]),n("div",{staticClass:"d-flex flex-wrap pt-2"},t._l(e.toolList,(function(e,o){return n("b-button",{key:e+o,staticClass:"tool-item",class:{"no-margin-right":(o+1)%3===0,"btn-active":t.toolGroupMap[e].id===t.activeToolGroup},attrs:{disabled:t.readonly},on:{mouseenter:function(n){return t.mouseenterHandler(t.toolGroupMap[e].id)},mouseleave:function(e){return t.mouseleaveHandler()},click:function(n){return t.activeTool(e)}}},[n("span",{staticClass:"tool-item-img"},[n("b-img",{staticClass:"w-100 h-100",attrs:{src:t.toolGroupMap[e].id===t.activeToolGroup&&t.toolGroupMap[e].active?t.toolGroupMap[e].active:t.toolGroupMap[e].id===t.hover?t.toolGroupMap[e].hover:t.toolGroupMap[e].img}})],1),n("span",{staticClass:"mt-2 app-text-tiny text-center"},[t._v(t._s(t.toolGroupMap[e].title))])])})),1)])})),t._l(t.windoorGroup,(function(e,o){return n("div",{key:e.title+o,staticClass:"px-2"},[n("div",{staticClass:"border-bottom app-text-small tool-title"},[t._v(t._s(e.title))]),n("div",{staticClass:"d-flex flex-wrap pt-3"},t._l(e.toolList,(function(e,o){return n("b-button",{key:e+o,staticClass:"tool-item",class:{"no-margin-right":(o+1)%3===0},attrs:{disabled:t.readonly},on:{mouseenter:function(n){return t.mouseenterHandler(t.windoorMap[e].id)},mouseleave:function(e){return t.mouseleaveHandler()},click:function(n){return t.activeWindoor(e)}}},[n("span",{staticClass:"tool-item-img"},[n("b-img",{staticClass:"w-100 h-100",attrs:{src:t.windoorMap[e].id===t.hover?t.windoorMap[e].hover:t.windoorMap[e].img}})],1),n("span",{staticClass:"mt-1 app-text-tiny text-center"},[t._v(t._s(t.windoorMap[e].title))])])})),1)])}))],2)},Jt=[],Kt="selector",Yt="transformer",qt="builder",Xt="chamber",Zt="spliter",Qt="labeler",te="viewport",ee=(kt={},Object(Nt["a"])(kt,Kt,{id:Kt,title:"选择器",icon:"cursor",click:function(t){t.feature.tool.openSelector()}}),Object(Nt["a"])(kt,Yt,{id:Yt,title:"变形器",icon:"arrows-move",click:function(t){t.feature.tool.openTransformer()}}),Object(Nt["a"])(kt,qt,{id:qt,title:"墙",img:"img/Wall.svg",hover:"img/Wall_Active.svg",active:"img/Wall_Active.svg",click:function(t){t.feature.tool.openBuilder()}}),Object(Nt["a"])(kt,Xt,{id:Xt,title:"房间",img:"img/Room.svg",hover:"img/Room_Active.svg",active:"img/Room_Active.svg",click:function(t){t.feature.tool.openChamber()}}),Object(Nt["a"])(kt,Zt,{id:Zt,title:"截断器",icon:"input-cursor",click:function(t){t.feature.tool.openSpliter()}}),Object(Nt["a"])(kt,Qt,{id:Qt,title:"标注",icon:"tags",click:function(t){t.feature.tool.openLabeler()}}),Object(Nt["a"])(kt,te,{id:te,title:"视口",icon:"search",click:function(t){t.feature.tool.openViewport()}}),kt),ne={singleDoor:{id:"singleDoor",title:"单开门",img:"img/SingleDoor.svg",hover:"img/SingleDoor_Active.svg"},doubleDoor:{id:"doubleDoor",title:"双开门",img:"img/DoubleDoor.svg",hover:"img/DoubleDoor_Active.svg"},slidingDoor:{id:"slidingDoor",title:"推拉门",img:"img/SlidingDoor.svg",hover:"img/SlidingDoor_Active.svg"},basicWindow:{id:"basicWindow",title:"窗",img:"img/BasicWindow.svg",hover:"img/BasicWindow_Active.svg"},boilerWindow:{id:"boilerWindow",title:"飘窗",img:"img/BoilerWindow.svg",hover:"img/BoilerWindow_Active.svg"},bealock:{id:"bealock",title:"垭口",img:"img/Bealock.svg",hover:"img/Bealock_Active.svg"}},oe=[{title:"墙",toolList:[qt,Xt]}],ie=[{title:"门窗",toolList:["singleDoor","doubleDoor","slidingDoor","basicWindow","boilerWindow"]},{title:"其他构件",toolList:["bealock"]}],re={name:"Tool",data:function(){return{activeToolGroup:null,toolGroup:oe,windoorGroup:ie,toolGroupMap:ee,windoorMap:ne,readonly:!0,hover:null}},mounted:function(){var t=this;this.activeTool(Kt),this.$root.$on("readonly",(function(e){return t.readonly=e})),this.$editor.on("tool-open",this._toolOpenListener=function(e){t.activeToolGroup!==e&&(t.activeToolGroup=e,t.$root.$emit("toolGroupChange",e))})},destroyed:function(){this.$editor.off("open",this._toolOpenListener)},methods:{activeTool:function(t){this.$editor.solution.drawing.hammer.adjuster.removeElement(),ee[t].click(this.$editor),this.activeToolGroup=t,this.$root.$emit("toolGroupChange",t)},activeWindoor:function(t){var e=this.$editor;e.feature.tool.openDefault();var n=e.solution.drawing.windoor.createMovingHollow();e.map.get(n).setResource(this.$spec.hollow.map[t].resource)},mouseenterHandler:function(t){this.hover=t},mouseleaveHandler:function(){this.hover=null}}},ae=re,se=(n("6db6"),Object(Gt["a"])(ae,It,Jt,!1,null,null,null)),le=se.exports,ce=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"tool-bar-material"}},[n("b-tabs",{staticClass:"p-2",attrs:{pills:"","no-fade":"","nav-class":"material-tab-nav"}},t._l(t.materialGroup,(function(e,o){return n("b-tab",{key:o,attrs:{title:e.title,active:e.active}},t._l(e.dataList,(function(e,o){return n("div",{key:o},[n("div",{staticClass:"border-bottom px-2",staticStyle:{height:"30px","line-height":"30px"}},[t._v(t._s(e.title))]),n("div",{staticClass:"d-flex flex-wrap pt-3"},t._l(e.materialList,(function(e,o){return n("div",{key:o,staticClass:"d-flex flex-column align-items-center mb-2",staticStyle:{width:"50px"},on:{click:function(n){return t.create(t.materialMap[e].id)}}},[n("span",{staticStyle:{width:"40px",height:"40px",cursor:"pointer"}},[n("b-img",{staticClass:"h-100 w-100",attrs:{src:t.materialMap[e].img}})],1),n("span",{staticClass:"mt-1 app-text-tiny text-center"},[t._v(t._s(t.materialMap[e].title))])])})),0)])})),0)})),1)],1)},ue=[],pe={0:{id:0,title:"单人床",img:"img/SingleDoor.png"},1:{id:1,title:"双人床",img:"img/SingleDoor.png"},2:{id:2,title:"组合床",img:"img/SingleDoor.png"},3:{id:3,title:"榻榻米",img:"img/SingleDoor.png"},4:{id:4,title:"单人沙发",img:"img/SingleDoor.png"},5:{id:5,title:"双人沙发",img:"img/SingleDoor.png"},6:{id:6,title:"多人沙发",img:"img/SingleDoor.png"},7:{id:7,title:"组合沙发",img:"img/SingleDoor.png"},8:{id:8,title:"转角沙发",img:"img/SingleDoor.png"},9:{id:9,title:"弧形沙发",img:"img/SingleDoor.png"},10:{id:10,title:"圆形餐桌",img:"img/SingleDoor.png"},11:{id:11,title:"方形餐桌",img:"img/SingleDoor.png"},12:{id:12,title:"长条形餐桌",img:"img/SingleDoor.png"},13:{id:13,title:"书桌",img:"img/SingleDoor.png"},14:{id:14,title:"梳妆台",img:"img/SingleDoor.png"},15:{id:15,title:"一字型橱柜",img:"img/SingleDoor.png"},16:{id:16,title:"L形橱柜",img:"img/SingleDoor.png"},17:{id:17,title:"U形橱柜",img:"img/SingleDoor.png"},18:{id:18,title:"浴缸",img:"img/SingleDoor.png"},19:{id:19,title:"淋浴房",img:"img/SingleDoor.png"},20:{id:20,title:"洗手台",img:"img/SingleDoor.png"},21:{id:21,title:"马桶",img:"img/SingleDoor.png"},22:{id:22,title:"洗衣机",img:"img/SingleDoor.png"},23:{id:23,title:"绿植",img:"img/SingleDoor.png"},24:{id:24,title:"地毯",img:"img/SingleDoor.png"},25:{id:25,title:"长方形楼梯",img:"img/SingleDoor.png"},26:{id:26,title:"L形楼梯",img:"img/SingleDoor.png"},27:{id:27,title:"U形楼梯",img:"img/SingleDoor.png"},28:{id:28,title:"圆形楼梯",img:"img/SingleDoor.png"},29:{id:29,title:"地板",img:"img/SingleDoor.png"},30:{id:30,title:"瓷砖",img:"img/SingleDoor.png"},31:{id:31,title:"地毯",img:"img/SingleDoor.png"}},de=[{title:"家具",dataList:[{title:"床",materialList:[0,1,2,3]},{title:"沙发",materialList:[4,5,6,7,8,9]},{title:"桌几",materialList:[10,11,12,13,14]}]},{title:"厨卫",dataList:[{title:"厨房",materialList:[15,16,17]},{title:"卫浴",materialList:[18,19,20,21,22]}]},{title:"家饰",dataList:[{title:"家饰",materialList:[23,24]}]},{title:"建筑",dataList:[{title:"楼梯",materialList:[25,26,27,28]},{title:"地板设计",materialList:[29,30,31]}]}],fe={name:"Material",data:function(){return{materialMap:pe,materialGroup:de}},mounted:function(){console.log("material")},methods:{create:function(t){console.log(t)}}},he=fe,me=(n("9342"),Object(Gt["a"])(he,ce,ue,!1,null,null,null)),ve=me.exports,be={tool:le,material:ve},ge={name:"ToolBarContainer",data:function(){return{toolList:[{id:"tool",title:"画户型",img:"img/DrawTool.svg",active:"img/DrawTool_Active.svg"}],active:"tool",activeTool:le,contentVisible:!0,readonly:!0}},mounted:function(){var t=this;this.$root.$on("readonly",(function(e){return t.readonly=e}))},methods:{changeTool:function(t){this.active=t,this.activeTool=be[t],this.contentVisible||this.toggleConetnt()},toggleConetnt:function(){var t=this.$editor.solution.drawing;this.contentVisible=!this.contentVisible,t.compass.setPosition(this.contentVisible?410:130,60),this.$root.$emit("drawing-resize")}}},ye=ge,we=(n("0085"),Object(Gt["a"])(ye,zt,Vt,!1,null,null,null)),ke=we.exports,xe=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"position-absolute d-flex justify-content-center w-100",staticStyle:{top:"0",height:"0"}},[n(t.current,{tag:"component",staticClass:"border mt-1 position-absolute",staticStyle:{"background-color":"#FFF"}})],1)},Oe=[],Te=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"d-flex",attrs:{id:"builder-setting"}},[n("b-form-radio-group",{staticClass:"d-flex align-items-center pr-1 pl-3",attrs:{options:t.alignOptions},on:{change:t.setWallAlignment},model:{value:t.align,callback:function(e){t.align=e},expression:"align"}}),n("div",{staticClass:"position-relative"},[n("b-form-group",{staticClass:"my-1 px-2 border-left border-right",staticStyle:{width:"12em"},attrs:{"label-cols-sm":"3","content-cols-sm":"9",label:"墙厚","label-for":"wall-thinkness"}},[n("b-input-group",{attrs:{append:"mm"}},[n("b-form-input",{attrs:{id:"wall-thinkness",type:"number",autocomplete:"off"},on:{change:t.setWallThinkness,focus:function(){return t.thinknessDropdownShow=!0},blur:function(){return t.thinknessDropdownShow=!1}},model:{value:t.thinkness,callback:function(e){t.thinkness=t._n(e)},expression:"thinkness"}})],1)],1),n("b-list-group",{directives:[{name:"show",rawName:"v-show",value:t.thinknessDropdownShow,expression:"thinknessDropdownShow"}],staticClass:"input-dropdown"},t._l(t.thinknessList,(function(e,o){return n("b-list-group-item",{key:o,attrs:{button:""},on:{mousedown:function(n){return t.setWallThinkness(e)}}},[t._v(t._s(e))])})),1)],1),n("b-form-checkbox",{staticClass:"d-flex align-items-center mx-3",on:{change:t.setSnapState},model:{value:t.snapState,callback:function(e){t.snapState=e},expression:"snapState"}},[t._v("吸附")])],1)},Se=[],_e=10,je=1e3,Ce={name:"BuilderSetting",data:function(){return{thinkness:240,thinknessList:[100,120,180,200,240],thinknessDropdownShow:!1,align:"center",alignOptions:[{value:"center",text:"墙中线绘制"},{value:"right",text:"墙内线绘制"}],snapState:!0}},mounted:function(){this.setWallThinkness(this.thinkness),this.setWallAlignment(this.align),this.snapState=this.$editor.getState().snap},methods:{setWallThinkness:function(t){var e=Number(t);this.thinkness=e<_e?_e:e>je?je:e,this.$editor.solution.drawing.bricklayer.Builder.setThickness(this.thinkness)},setWallAlignment:function(t){this.$editor.solution.drawing.bricklayer.Builder.setAlignment(t)},setSnapState:function(t){this.$editor.setSnap(t)}}},Le=Ce,$e=(n("7b33"),Object(Gt["a"])(Le,Te,Se,!1,null,null,null)),De=$e.exports,We=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"d-flex",attrs:{id:"chamber-setting"}},[n("div",[n("b-form-group",{staticClass:"my-1 pr-2 pl-3 border-right",staticStyle:{width:"12em"},attrs:{"label-cols-sm":"3","content-cols-sm":"9",label:"墙厚","label-for":"wall-thinkness"}},[n("b-input-group",{attrs:{append:"mm"}},[n("b-form-input",{attrs:{id:"wall-thinkness",type:"number",autocomplete:"off"},on:{change:t.setWallThinkness,focus:function(){return t.thinknessDropdownShow=!0},blur:function(){return t.thinknessDropdownShow=!1}},model:{value:t.thinkness,callback:function(e){t.thinkness=t._n(e)},expression:"thinkness"}})],1)],1),n("b-list-group",{directives:[{name:"show",rawName:"v-show",value:t.thinknessDropdownShow,expression:"thinknessDropdownShow"}],staticClass:"input-dropdown"},t._l(t.thinknessList,(function(e,o){return n("b-list-group-item",{key:o,attrs:{button:""},on:{mousedown:function(n){return t.setWallThinkness(e)}}},[t._v(t._s(e))])})),1)],1),n("b-form-checkbox",{staticClass:"d-flex align-items-center mx-3",on:{change:t.setSnapState},model:{value:t.snapState,callback:function(e){t.snapState=e},expression:"snapState"}},[t._v("吸附")])],1)},Re=[],Ee=10,Ae=1e3,Ne={name:"ChamberSetting",data:function(){return{thinkness:240,thinknessList:[100,120,180,200,240],thinknessDropdownShow:!1,snapState:!0}},mounted:function(){this.setWallThinkness(this.thinkness),this.snapState=this.$editor.getState().snap},methods:{setWallThinkness:function(t){var e=Number(t);this.thinkness=e<Ee?Ee:e>Ae?Ae:e,this.$editor.solution.drawing.bricklayer.Chamber.setThickness(this.thinkness)},setSnapState:function(t){this.$editor.setSnap(t)}}},Pe=Ne,Fe=(n("698f"),Object(Gt["a"])(Pe,We,Re,!1,null,null,null)),Me=Fe.exports,Be={builder:De,chamber:Me},Ge={name:"ToolSetting",data:function(){return{current:null}},mounted:function(){var t=this;this.$root.$on("toolGroupChange",(function(e){t.current=Be[e]}))}},Ue=Ge,He=Object(Gt["a"])(Ue,xe,Oe,!1,null,null,null),ze=He.exports,Ve=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"border",class:{hidden:!t.contentVisible},attrs:{id:"property-container"}},[n("span",{staticClass:"property-button",on:{click:t.toggleConetnt}},[n("b-icon",{attrs:{icon:t.contentVisible?"caret-right-fill":"caret-left-fill"}})],1),n("div",{staticClass:"property-content",class:{hidden:!t.contentVisible}},[n("floor",{staticClass:"mb-3"}),n(t.activeTool,{tag:"component"})],1)])},Ie=[],Je=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"property-floor"}},[n("div",{staticClass:"property-title border-bottom app-text-small"},[t._v("户型属性")]),n("div",{staticClass:"d-flex flex-column app-text-tiny"},[n("div",{staticClass:"property-item"},[n("span",[t._v("底图旋转：")]),n("div",{staticClass:"position-relative"},[n("b-form-input",{staticClass:"spin-input spin-button-hidden",staticStyle:{width:"39px",left:"36px"},attrs:{type:"number",readonly:t.negativeLocked||t.readonly},on:{change:t.bitmapRotate},model:{value:t.property.bitmapRotation,callback:function(e){t.$set(t.property,"bitmapRotation",e)},expression:"property.bitmapRotation"}}),n("b-form-spinbutton",{staticClass:"mr-2",attrs:{inline:"",wrap:"",min:"0",max:"359",readonly:t.negativeLocked||t.readonly},on:{change:function(e){return t.rotationUpdate("bitmap",e)}},model:{value:t.spinNumber.bitmapRotation,callback:function(e){t.$set(t.spinNumber,"bitmapRotation",e)},expression:"spinNumber.bitmapRotation"}}),n("b-icon",{staticStyle:{cursor:"pointer"},attrs:{icon:"arrow-repeat","font-scale":"1.2"},on:{click:function(e){return t.bitmapRotate(0)}}})],1)]),n("div",{staticClass:"property-item"},[n("span",[t._v("楼层数量：")]),n("b-form-input",{attrs:{value:t.property.length+"层",readonly:""}})],1),n("div",{staticClass:"property-item"},[n("span",[t._v("楼层选择：")]),n("b-form-select",{attrs:{options:t.floorOptions,disabled:t.readonly},on:{change:t.changeFloor},model:{value:t.selectedFloor,callback:function(e){t.selectedFloor=e},expression:"selectedFloor"}})],1),n("div",{staticClass:"property-item"},[n("span",[t._v("名称修改：")]),n("b-form-input",{attrs:{state:t.floorNameChangeState,readonly:t.readonly},on:{change:t.changeFloorName},model:{value:t.property.floorName,callback:function(e){t.$set(t.property,"floorName",e)},expression:"property.floorName"}})],1),n("div",{staticClass:"property-item"},[n("span",[t._v("户型面积 (单层)：")]),n("div",{staticClass:"d-flex align-items-center"},[n("b-form-input",{staticClass:"mr-1",staticStyle:{width:"114px"},attrs:{readonly:""},model:{value:t.layerArea,callback:function(e){t.layerArea=e},expression:"layerArea"}}),n("span",[t._v("m²")])],1)])])])},Ke=[],Ye=(n("b680"),function(t){return(t/1e6).toFixed(2)}),qe=function(t){return t/Math.PI/2*360},Xe=function(t){return t/360*2*Math.PI},Ze=function(t){return t<0?0:t>359?359:Number(t)},Qe={name:"FloorProperty",data:function(){return{floorOptions:[],property:{length:0,floorName:"",bitmapRotation:0,compassRotation:0},spinNumber:{bitmapRotation:0,compassRotation:0},selectedFloor:1,layerArea:0,floorNameChangeState:null,negativeLocked:!1,readonly:!0}},mounted:function(){var t=this,e=this.$editor;e.on("floor-set",this._floorSetListener=function(){t.updateFloorOptions(),t.updateProperty()}),e.on("area-change",this._areaListener=function(e){return t.layerArea=Ye(e)}),e.on("compass-change",this._compassListener=function(e){t.spinNumber.compassRotation=t.property.compassRotation=Number(qe(e.rotation).toFixed())}),e.on("bitmap-create",this._bitmapListener=function(){return t.updateProperty()}),this.$root.$on("lock",(function(){return t.negativeLocked=!0})),this.$root.$on("unlock",(function(){return t.negativeLocked=!1})),this.$root.$on("readonly",(function(e){return t.readonly=e}))},destroyed:function(){var t=this.$editor;t.off("floor-set",this._floorSetListener),t.off("area-change",this._areaListener),t.off("compass-change",this._compassListener),t.off("bitmap-create",this._bitmapListener)},methods:{compassRotate:function(t){this.readonly||(this.property.compassRotation=Ze(t),this.$editor.solution.drawing.compass.setRotation(Xe(this.property.compassRotation)))},bitmapRotate:function(t){this.negativeLocked||this.readonly||this.$editor.negativeRotate(Xe(Ze(t)))},rotationUpdate:function(t,e){this.property["".concat(t,"Rotation")]=e,this["".concat(t,"Rotate")](e)},changeFloor:function(t){this.$editor.feature.floor.select(t),this.updateProperty(),this.selectedFloor=t},changeFloorName:function(){var t=this,e=this.property.floorName;e?(this.$editor.feature.floor.setFloorName(e),this.floorOptions.find((function(e){return e.level===t.selectedFloor})).text=e):(this.$editor.feature.floor.setFloorName(""),this.property.floorName="",this.updateFloorOptions()),this.floorNameChangeState=!0,this.property.floorName=""},updateProperty:function(){var t=this.$editor.solution.drawing,e=this.$editor.feature.floor,n=t.negative.getAllBitmapList();this.property.length=e.length,this.property.compassRotation=qe(t.compass.rotation),this.property.bitmapRotation=n[0]?qe(n[0].rotation):0,this.selectedFloor=e.current,this.floorNameChangeState=null},updateFloorOptions:function(){var t=this.$editor.feature.floor.getData();this.floorOptions=t.list.map((function(t){return{level:t.level,text:t.name||"".concat(t.level+1,"层"),value:t.level}}))}}},tn=Qe,en=(n("4c00"),Object(Gt["a"])(tn,Je,Ke,!1,null,null,null)),nn=en.exports,on=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"property-room"}},[n("div",{staticClass:"property-title border-bottom"},[t._v("功能间信息")]),n("div",{staticClass:"app-text-tiny"},[n("div",{staticClass:"property-item"},[n("span",[t._v("房间类型：")]),n("b-form-select",{attrs:{options:t.options},on:{change:t.changeRoomType},model:{value:t.property.type,callback:function(e){t.$set(t.property,"type",e)},expression:"property.type"}})],1),n("div",{staticClass:"property-item"},[n("span",[t._v("房间名称：")]),n("b-form-input",{on:{change:t.changeRoomName},model:{value:t.property.name,callback:function(e){t.$set(t.property,"name",e)},expression:"property.name"}})],1)])])},rn=[],an=null,sn={name:"PropertyRoom",data:function(){return{property:{type:"",name:""}}},computed:{options:function(){var t=this.$spec.room.typeList.map((function(t){return{value:t,text:t}}));return t.unshift({value:"自定义",text:"自定义"}),t}},mounted:function(){this.init()},destroyed:function(){this.$editor.off("select",this._selectListener),this.$root.$off("room-property-change",this._changeListener)},methods:{init:function(){var t=this,e=this.$editor;an=e.getSelected()[0],this.updateProperty(an),e.on("select",this._selectListener=function(e){var n=e[0];n!==an&&n.constructor===an.constructor&&(an=n,t.updateProperty(n))}),this.$root.$on("room-property-change",this._changeListener=function(){return t.updateProperty(an)})},updateProperty:function(t){var e=t.type,n=t.name;Object.assign(this.property,{type:e||"自定义",name:n||""})},changeRoomType:function(){this.property.name=this.property.type,an.setType(this.property.type),an.setName(this.property.name),this.$root.$emit("room-property-change"),this.$root.$emit("room-name-change")},changeRoomName:function(){an.setName(this.property.name||"未命名"),this.$root.$emit("room-property-change"),this.$root.$emit("room-name-change")}}},ln=sn,cn=(n("783f"),Object(Gt["a"])(ln,on,rn,!1,null,null,null)),un=cn.exports,pn=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"property-wall"}},[n("div",{staticClass:"property-title border-bottom"},[t._v("基础参数（墙体）")]),n("div",{staticClass:"app-custom app-text-tiny"},[n("div",[n("div",{staticClass:"property-title"},[t._v("墙体类型：")]),n("b-form-radio-group",{staticClass:"wall-type-radio",attrs:{options:t.typeOptions,buttons:"","button-variant":"outline-secondary"},on:{change:t.setType},model:{value:t.property.type,callback:function(e){t.$set(t.property,"type",e)},expression:"property.type"}})],1),n("div",[n("div",{staticClass:"property-title"},[t._v("墙体参数：")]),n("div",{staticClass:"d-flex align-items-center"},[n("div",{staticClass:"app-text-tiny",staticStyle:{width:"60px"}},[t._v("厚度")]),n("b-form-input",{staticClass:"mx-2",attrs:{min:"10",max:"1000",type:"range"},on:{update:t.setThickness},model:{value:t.property.thickness,callback:function(e){t.$set(t.property,"thickness",e)},expression:"property.thickness"}}),n("b-form-input",{staticClass:"mr-1",staticStyle:{width:"50px"},attrs:{min:"10",max:"1000"},on:{change:t.setThickness},model:{value:t.property.thickness,callback:function(e){t.$set(t.property,"thickness",e)},expression:"property.thickness"}}),n("span",[t._v("mm")])],1)])])])},dn=[],fn=null,hn={name:"PropertyWall",data:function(){return{property:{thickness:0,type:""}}},computed:{typeOptions:function(){var t=this.$spec.wall,e=t.typeSymbol,n=t.typeMap;return Object.keys(e).map((function(t){return{value:e[t],text:n[e[t]].label}}))}},mounted:function(){this.init()},destroyed:function(){this.$editor.off("select",this._selectListener)},methods:{init:function(){var t=this,e=this.$editor;fn=e.getSelected()[0],this.updateProperty(fn),e.on("select",this._selectListener=function(e){var n=e[0];n!==fn&&n.constructor===fn.constructor&&(fn=n,t.updateProperty(n))})},updateProperty:function(t){var e=t.thickness,n=t.resource,o=this.$spec.wall.typeMap,i="common";for(var r in o)if(o[r].resource===n){i=r;break}Object.assign(this.property,{thickness:e.toFixed(),type:i})},setType:function(t){fn.setResource(this.$spec.wall.typeMap[t].resource)},setThickness:function(t){isNaN(Number(t))?this.property.thickness=100:fn.thickness=Number(t)}}},mn=hn,vn=(n("687c"),Object(Gt["a"])(mn,pn,dn,!1,null,null,null)),bn=vn.exports,gn=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"property-hollow"}},[n("div",{staticClass:"property-title border-bottom app-text-small"},[t._v(t._s("基础参数（"+t.typeName+"）"))]),n("div",{staticClass:"app-custom app-text-tiny"},[n("div",{directives:[{name:"show",rawName:"v-show",value:t.hollowTypeOptions.length,expression:"hollowTypeOptions.length"}]},[n("div",{staticClass:"property-title"},[t._v(t._s(t.typeName+"类型："))]),n("b-form-radio-group",{staticClass:"type-radio",attrs:{options:t.hollowTypeOptions,buttons:"","button-variant":"outline-secondary"},on:{change:t.setType},model:{value:t.property.material,callback:function(e){t.$set(t.property,"material",e)},expression:"property.material"}})],1),n("div",[n("div",{staticClass:"property-title"},[t._v(t._s(t.typeName+"参数："))]),n("div",{staticClass:"d-flex align-items-center"},[n("div",{staticClass:"app-text-tiny",staticStyle:{width:"60px"}},[t._v("长度")]),n("b-form-input",{staticClass:"mx-2",attrs:{min:"100",max:t.maxWidth,type:"range"},on:{update:t.setWidth},model:{value:t.property.width,callback:function(e){t.$set(t.property,"width",e)},expression:"property.width"}}),n("b-form-input",{staticClass:"mr-1",staticStyle:{width:"50px"},attrs:{min:"100",max:"3000"},on:{change:t.setWidth},model:{value:t.property.width,callback:function(e){t.$set(t.property,"width",e)},expression:"property.width"}}),n("span",[t._v("mm")])],1)]),n("div",{staticClass:"py-4 d-flex justify-content-center"},[n("b-button",{staticClass:"app-text-small",staticStyle:{"border-radius":"0 !important",width:"100px"},attrs:{variant:"primary",size:"lg"},on:{click:t.setDefault}},[t._v("恢复默认")])],1)])])},yn=[],wn=function(t,e,n,o){return i.length.apply(i,Object(_["a"])(i.fromBothPoint(t,e,n,o)))},kn=function(t,e,n){var o=t.corner,i=t.back.corner,s=a.project.apply(a,[e,n].concat(Object(_["a"])(r.fromSegment(o.x,o.y,i.x,i.y))));return wn.apply(void 0,[o.x,o.y].concat(Object(_["a"])(s)))},xn=null,On={name:"PropertyHollow",data:function(){return{property:{material:"",width:0},hollowTypeOptions:[],typeName:"",maxWidth:0,aheadTrap:null,behindTrap:null}},mounted:function(){this.init()},destroyed:function(){this.$editor.off("select",this._selectListener)},methods:{init:function(){var t=this,e=this.$editor;xn=e.getSelected()[0],this.updateProperty(xn),e.on("select",this._selectListener=function(e){var n=e[0];n!==xn&&n.constructor===xn.constructor&&(xn=n,t.updateProperty(n))})},updateProperty:function(t){var e=this.$spec.hollow,n=e.map,o=e.typeMap,i=t.width,r=t.resource,a=Object.keys(n).find((function(t){return n[t].resource===r})),s=Object.keys(o).find((function(t){return o[t].list.includes(a)}));Object.assign(this.property,{width:i.toFixed(),material:a}),this.hollowTypeOptions=o[s].list.map((function(t){return{value:t,text:n[t].label}})),this.typeName=o[s].label,this.updateTrap(t)},updateTrap:function(t){var e=t.surface,n=t.offset;if("virtual"!==e.name){var o=this.$editor.solution.drawing,i=e.back,r=o.windoor.getAllHollowList(),a=r.filter((function(n){return n!==t&&n!==t.$proxy&&n.surface===e})),s=r.filter((function(e){return e!==t&&e!==t.$proxy&&e.surface===i})),l=[],c=wn(e.corner.x,e.corner.y,i.corner.x,i.corner.y);a.forEach((function(t){var e=t.width,n=t.offset;l.push([n-e/2,n+e/2])})),s.forEach((function(t){var e=t.width,n=t.offset;l.push([c-(n+e/2),c-(n-e/2)])})),l.push([0,i.wall===i.next.wall?0:kn.apply(void 0,[e].concat(Object(_["a"])(e.origin)))]),l.push([e.wall===e.next.wall?c:c-kn.apply(void 0,[i].concat(Object(_["a"])(i.origin))),c]);var u=null,p=null;l.forEach((function(t){t[0]>n&&(null===p||t[1]<p[0])&&(p=t),t[1]<n&&(null===u||t[0]>u[1])&&(u=t)})),this.maxWidth=(p[0]-u[1]).toFixed(),this.aheadTrap=u,this.behindTrap=p}else this.maxWidth=1e4},setType:function(t){xn.setResource(this.$spec.hollow.map[t].resource)},setWidth:function(t){var e=xn,n=e.offset,o=e.surface;if(isNaN(Number(t)))return this.property.width=100,void(xn.width=100);if("virtual"!==o.name){if(Number(t)>this.maxWidth)return this.property.width=this.maxWidth,void(xn.width=Number(this.maxWidth));var i=n-Number(t)/2,r=n+Number(t)/2;xn.width=Number(t),i<this.aheadTrap[1]&&(xn.offset=n+(this.aheadTrap[1]-i)),r>this.behindTrap[0]&&(xn.offset=n-(r-this.behindTrap[0]))}else xn.width=Number(t)},setDefault:function(){xn.setDefaultWidth(),this.property.width=xn.width}}},Tn=On,Sn=(n("14ac"),Object(Gt["a"])(Tn,gn,yn,!1,null,null,null)),_n=Sn.exports,jn={name:"Property",components:{Floor:nn},data:function(){return{activeTool:null,contentVisible:!0}},mounted:function(){this.init()},destroyed:function(){var t=this.$editor;t.off("select",this._selectListener),t.off("select",this._unselectListener)},methods:{init:function(){var t=this,e=this.$editor,n={EditorWall:bn,EditorRoom:un,EditorHollow:_n};e.on("select",this._selectListener=function(e){t.activeTool=n[e[0].className],t.contentVisible||t.toggleConetnt()}),e.on("unselect",this._unselectListener=function(){t.activeTool=null})},toggleConetnt:function(){this.contentVisible=!this.contentVisible,this.$root.$emit("drawing-resize")}}},Cn=jn,Ln=(n("f709"),Object(Gt["a"])(Cn,Ve,Ie,!1,null,null,null)),$n=Ln.exports,Dn=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"property-card"}},[n(t.activeCard,{tag:"component",staticClass:"card-component app-text-tiny"})],1)},Wn=[],Rn=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"px-2"},[n("span",{staticClass:"mr-2",staticStyle:{width:"25px",color:"#FFFFFF"}},[t._v("类型")]),n("b-form-select",{staticClass:"mr-2",staticStyle:{width:"100px"},attrs:{options:t.options},on:{change:t.changeRoomType},model:{value:t.property.type,callback:function(e){t.$set(t.property,"type",e)},expression:"property.type"}}),n("b-form-input",{staticStyle:{width:"100px"},attrs:{placeholder:"房间名称"},on:{change:t.changeRoomName},model:{value:t.property.name,callback:function(e){t.$set(t.property,"name",e)},expression:"property.name"}})],1)},En=[],An=null,Nn={name:"PropertyCardRoom",data:function(){return{property:{type:"",name:""}}},computed:{options:function(){var t=this.$spec.room.typeList.map((function(t){return{value:t,text:t}}));return t.unshift({value:"自定义",text:"自定义"}),t}},mounted:function(){this.init()},destroyed:function(){this.$editor.off("select",this._selectListener),this.$root.$off("room-property-change",this._changeListener)},methods:{init:function(){var t=this,e=this.$editor;An=e.getSelected()[0],this.updateProperty(An),e.on("select",this._selectListener=function(e){var n=e[0];n!==An&&n.constructor===An.constructor&&(An=n,t.updateProperty(n))}),this.$root.$on("room-property-change",this._changeListener=function(){return t.updateProperty(An)})},updateProperty:function(t){var e=t.type,n=t.name;Object.assign(this.property,{type:e||"自定义",name:n||""})},changeRoomType:function(){this.property.name=this.property.type,An.setType(this.property.type),An.setName(this.property.name),this.$root.$emit("room-property-change")},changeRoomName:function(){An.setName(this.property.name||"未命名"),this.$root.$emit("room-property-change")}}},Pn=Nn,Fn=Object(Gt["a"])(Pn,Rn,En,!1,null,null,null),Mn=Fn.exports,Bn=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",t._l(t.toolList,(function(e){return n("b-button",{key:e,attrs:{variant:"outline-secondary"},on:{click:t.buttonMethods[e]}},[n("b-img",{attrs:{src:t.toolMap[e].image.base}}),n("span",{staticClass:"app-text-tiny"},[t._v(t._s(t.toolMap[e].label))])],1)})),1)},Gn=[],Un=(n("ac1f"),n("1276"),null),Hn={name:"PropertyCardWall",computed:{toolMap:function(){return this.$spec.wall.toolMap},toolList:function(){var t=this.$spec.wall.toolSymbol;return[t.split,t.delete]},buttonMethods:function(){var t,e=this,n=this.$spec.wall.toolSymbol;return t={},Object(Nt["a"])(t,n.split,(function(){return e.split()})),Object(Nt["a"])(t,n.delete,(function(){return e.delete()})),t}},mounted:function(){this.init()},destroyed:function(){this.$editor.off("select",this._selectListener)},methods:{init:function(){var t=this.$editor;Un=t.getSelected()[0],t.on("select",this._selectListener=function(t){var e=t[0];e!==Un&&e.constructor===Un.constructor&&(Un=e)})},split:function(){Un.split()},delete:function(){this.$editor.delete()}}},zn=Hn,Vn=Object(Gt["a"])(zn,Bn,Gn,!1,null,null,null),In=Vn.exports,Jn=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",t._l(t.toolList,(function(e){return n("b-button",{directives:[{name:"show",rawName:"v-show",value:t.shownMap[e],expression:"shownMap[symbol]"}],key:e,attrs:{variant:"outline-secondary"},on:{click:t.buttonMethods[e]}},[n("b-img",{attrs:{src:t.toolMap[e].image.base}}),n("span",{staticClass:"app-text-tiny"},[t._v(t._s(t.toolMap[e].label))])],1)})),1)},Kn=[],Yn=null,qn={name:"PropertyCardWall",data:function(){return{entranceShow:!0,flipWallShow:!0,flipShow:!0,deleteShow:!0}},computed:{toolMap:function(){return this.$spec.hollow.toolMap},toolList:function(){var t=this.$spec.hollow.toolSymbol;return[t.entrance,t.flip,t.flipWall,t.delete]},shownMap:function(){var t,e=this.$spec.hollow.toolSymbol,n={};return Object.keys(e).forEach((function(t){return n[t]=!0})),Object(Pt["a"])(Object(Pt["a"])({},n),{},(t={},Object(Nt["a"])(t,e.entrance,this.entranceShow),Object(Nt["a"])(t,e.flipWall,this.flipWallShow),Object(Nt["a"])(t,e.flip,this.flipShow),Object(Nt["a"])(t,e.delete,this.deleteShow),t))},buttonMethods:function(){var t,e=this,n=this.$spec.hollow.toolSymbol;return t={},Object(Nt["a"])(t,n.entrance,(function(){return e.setEntrance()})),Object(Nt["a"])(t,n.flipWall,(function(){return e.changeSurface()})),Object(Nt["a"])(t,n.flip,(function(){return e.flip()})),Object(Nt["a"])(t,n.delete,(function(){return e.delete()})),t}},mounted:function(){this.init()},destroyed:function(){this.$editor.off("select",this._selectListener)},methods:{init:function(){var t=this,e=this.$editor;Yn=e.getSelected()[0],this.updateToolList(Yn),e.on("select",this._selectListener=function(e){var n=e[0];n!==Yn&&n.constructor===Yn.constructor&&(Yn=n,t.updateToolList(n))})},getEntranceShow:function(){return this.entranceShow},updateToolList:function(t){var e=t.resource,n=this.$spec.hollow,o=n.typeSymbol,i=n.typeMap,r=n.map,a=n.symmetryMap,s=Object.keys(r).find((function(t){return r[t].resource===e}));this.entranceShow=i[o.door].list.includes(s),this.flipWallShow=!a.topBottom.includes(s),this.flipShow=!a.leftRight.includes(s)},setEntrance:function(){Yn.setEntrance()},changeSurface:function(){Yn.changeSurface()},flip:function(){Yn.flip()},delete:function(){Yn.arrow&&Yn.arrow.remove(),this.$editor.delete()}}},Xn=qn,Zn=Object(Gt["a"])(Xn,Jn,Kn,!1,null,null,null),Qn=Zn.exports,to={name:"PropertyCard",data:function(){return{activeCard:null,position:[0,0]}},mounted:function(){this.init()},destroyed:function(){var t=this.$editor;t.off("select",this._selectListener),t.off("unselect",this._unselectListener),document.removeEventListener("mousemove",this._moveListener)},methods:{init:function(){var t=this,e=this.$editor,n=document.getElementById("property-card"),o={EditorWall:In,EditorRoom:Mn,EditorHollow:Qn};e.on("select",this._selectListener=function(e){t.activeCard=o[e[0].className],n.style.left="".concat(t.position[0]+30,"px"),n.style.top="".concat(t.position[1]-70,"px")}),e.on("unselect",this._unselectListener=function(){t.activeCard=null}),document.addEventListener("mousemove",this._moveListener=function(e){t.position[0]=e.layerX,t.position[1]=e.layerY})}}},eo=to,no=(n("507d"),Object(Gt["a"])(eo,Dn,Wn,!1,null,null,null)),oo=no.exports,io=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"px-4",attrs:{id:"viewport"}},[n("div",{staticClass:"mr-4",staticStyle:{width:"40px",cursor:"pointer"},on:{click:t.negativeBackToCenter}},[n("b-img",{staticClass:"h-100 w-100",attrs:{src:"img/ViewReset.svg"}})],1),n("span",{staticStyle:{width:"25px",height:"30px","line-height":"25px",cursor:"pointer"},on:{click:t.zoomOut}},[n("b-img",{staticClass:"w-100 h-100",attrs:{src:"img/Dash.svg"}})],1),n("b-form-input",{staticClass:"mx-2",attrs:{type:"range",min:"1",max:"100",disabled:t.readonly},on:{update:t.changeScale},model:{value:t.inputScale,callback:function(e){t.inputScale=e},expression:"inputScale"}}),n("span",{staticStyle:{width:"25px",height:"30px","line-height":"25px",cursor:"pointer"},on:{click:t.zoomIn}},[n("b-img",{staticClass:"w-100 h-100",attrs:{src:"img/Plus.svg"}})],1)],1)},ro=[],ao=1,so=200,lo={name:"Viewport",data:function(){return{inputScale:0,inputScaleClone:0,readonly:!0}},computed:{scale:function(){return 100-this.inputScale}},mounted:function(){var t=this,e=this.$editor.solution.drawing;this.inputScale=100-e.scale,this._interval=setInterval((function(){t.inputScaleClone=100-e.scale,t.inputScaleClone!==t.inputScale&&(t.inputScale=t.inputScaleClone)}),so),this.$root.$on("readonly",(function(e){return t.readonly=e}))},destroyed:function(){clearInterval(this._interval)},methods:{negativeBackToCenter:function(){this.readonly||this.$editor.feature.drawing.negativeBackToCenter()},changeScale:function(){this.$editor.feature.drawing.setScale(this.scale)},zoomOut:function(){1==this.inputScale||this.readonly||(this.inputScale=Number(this.inputScale)-ao,this.$editor.feature.drawing.setScale(this.scale))},zoomIn:function(){100==this.inputScale||this.readonly||(this.inputScale=Number(this.inputScale)+ao,this.$editor.feature.drawing.setScale(this.scale))}}},co=lo,uo=(n("95f6"),Object(Gt["a"])(co,io,ro,!1,null,null,null)),po=uo.exports,fo=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"visible"}},[n("b-dropdown",{attrs:{"no-caret":"",dropup:"",size:"sm",variant:"link",disabled:t.readonly},scopedSlots:t._u([{key:"button-content",fn:function(){return[n("b-img",{attrs:{src:"img/Eye.svg"}})]},proxy:!0}])},[n("b-dropdown-group",{attrs:{header:"勾选隐藏项","header-classes":"visible-dropdown-header"}},[n("b-dropdown-form",{staticClass:"visible-dropdown-form"},[n("b-form-checkbox",{on:{change:t.changeRoomNameVisible},model:{value:t.visible.roomName,callback:function(e){t.$set(t.visible,"roomName",e)},expression:"visible.roomName"}},[t._v("房间名")]),n("b-form-checkbox",{on:{change:t.changeRoomAreaVisible},model:{value:t.visible.roomArea,callback:function(e){t.$set(t.visible,"roomArea",e)},expression:"visible.roomArea"}},[t._v("面积")]),n("b-form-checkbox",{on:{change:t.changeSizeVisible},model:{value:t.visible.size,callback:function(e){t.$set(t.visible,"size",e)},expression:"visible.size"}},[t._v("尺寸标注")]),n("b-form-checkbox",{on:{change:t.changeGridVisible},model:{value:t.visible.grid,callback:function(e){t.$set(t.visible,"grid",e)},expression:"visible.grid"}},[t._v("网格线")])],1)],1)],1)],1)},ho=[],mo={name:"Visible",data:function(){return{visible:{roomName:!1,roomArea:!1,size:!0,grid:!1},readonly:!0}},mounted:function(){var t=this;this.$editor.setRoomAreaShow(!0),this.$root.$on("readonly",(function(e){return t.readonly=e}))},methods:{changeRoomNameVisible:function(t){this.$editor.setRoomNameShow(!t)},changeRoomAreaVisible:function(t){this.$editor.setRoomAreaShow(!t)},changeSizeVisible:function(t){this.$editor.setDimensionShow(!t)},changeGridVisible:function(t){this.$editor.setGridShow(!t)}}},vo=mo,bo=(n("40e4"),Object(Gt["a"])(vo,fo,ho,!1,null,null,null)),go=bo.exports,yo=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{directives:[{name:"show",rawName:"v-show",value:t.visiable,expression:"visiable"}],attrs:{id:"check"}},[n("b-card",{directives:[{name:"show",rawName:"v-show",value:t.modalVisiable,expression:"modalVisiable"}],staticStyle:{width:"330px"},attrs:{"no-body":"","header-class":"p-2"},scopedSlots:t._u([{key:"header",fn:function(){return[n("div",{staticClass:"d-flex justify-content-between"},[n("div",[t._v("智能检测结果")]),n("b-button",{staticClass:"py-0 border-0",staticStyle:{color:"#FF8040"},attrs:{variant:"outline-secondary"},on:{click:t.toggleVisiable}},[t._v("忽略")])],1)]},proxy:!0}])},[t.hasEntrance?t._e():n("div",{staticClass:"d-flex align-items-center py-3",staticStyle:{"border-bottom":"1px dotted #CCCCCC"}},[n("div",{staticClass:"sign-warning app-text-tiny"},[t._v("警告")]),n("div",[n("div",{staticClass:"app-text-small font-weight-bold"},[t._v("未设置入户门")]),n("div",{staticClass:"app-text-tiny"},[t._v("请设置一个入户门，设置为入户门，多楼层注意选择正确的入户门")])])]),t.allRoomNamed?t._e():n("div",{staticClass:"d-flex align-items-center py-3 mb-3",staticStyle:{"border-bottom":"1px dotted #CCCCCC"}},[n("div",{staticClass:"sign-warning app-text-tiny"},[t._v("警告")]),n("div",[n("div",{staticClass:"app-text-small font-weight-bold"},[t._v("未命名房间名称")]),n("div",{staticClass:"app-text-tiny"},[t._v("房间名称中有存在未命名，请将未命名的房间编辑房间名称")])])])]),n("b-button",{directives:[{name:"show",rawName:"v-show",value:!t.modalVisiable&&!t.pass,expression:"!modalVisiable && !pass"}],staticClass:"p-0 border-0 position-absolute",staticStyle:{top:"-20px",right:"-330px"},attrs:{variant:"outline-secondary"},on:{click:t.toggleVisiable}},[n("b-img",{attrs:{src:"img/Duty.svg"}})],1),n("b-img",{directives:[{name:"show",rawName:"v-show",value:t.pass,expression:"pass"}],staticClass:"position-absolute",staticStyle:{top:"-20px",right:"-330px"},attrs:{src:"img/Signs.svg"}})],1)},wo=[],ko={data:function(){return{visiable:!1,modalVisiable:!1,hasEntrance:!1,allRoomNamed:!1}},computed:{pass:function(){return this.hasEntrance&&this.allRoomNamed}},watch:{pass:function(t,e){var n=this;t&&!e&&setTimeout((function(){n.pass&&(n.visiable=!1)}),2e3)}},mounted:function(){this.init()},destroyed:function(){this.$editor.off("entrance",this._entranceListener),this.$root.$off("save",this._saveListener)},methods:{init:function(){var t=this,e=this.$editor;e.on("opened",this._openedListener=function(){t.checkRoomName()}),e.on("entrance",this._entranceListener=function(e){t.hasEntrance=e,t.pass&&(t.modalVisiable=!1)}),this.$root.$on("room-name-change",this._roomNameListener=function(){t.$editor.feature.floor.updateFloorData(),t.checkRoomName(),t.pass&&(t.modalVisiable=!1)}),this.$root.$on("save",this._saveListener=function(){t.checkRoomName(),t.pass||(t.visiable=!0,t.modalVisiable=!0)})},checkRoomName:function(){var t=this.$editor.feature.floor.getData().list;this.allRoomNamed=!t.find((function(t){return!!t.roomList&&t.roomList.find((function(t){return"未命名"===t.name}))}))},toggleVisiable:function(){this.modalVisiable=!this.modalVisiable}}},xo=ko,Oo=(n("78a9"),Object(Gt["a"])(xo,yo,wo,!1,null,null,null)),To=Oo.exports,So=3e4,_o={name:"",components:{AppMenu:Ht,AppToolBar:ke,AppToolSetting:ze,AppProperty:$n,AppPropertyCard:oo,appViewport:po,appVisible:go,appCheck:To},data:function(){return{tool:"selector"}},mounted:function(){var t=this,e=this.$editor,n=e.solution.drawing;n.mount(this.$refs.drawing),e.feature.drawing.originBackToCenter(),n.structure.options.corner.style.hover.color=4235007,n.structure.options.wall.style.color=10921638,n.structure.options.wall.midline.show=!1,n.grid.options.rectangular.style.color=16777215,n.label.options.textLabel.color=16777215,n.label.options.textLabel.backgroundColor="black",n.label.options.textLabel.alpha=.5,n.compass.element.setNorthPointColor(4235007),n.compass.element.setSouthPointColor(14540253),n.compass.lock(),n.compass.setPosition(410,60),e.on("opened",(function(e){e?t.$root.$emit("readonly",!0):t.$root.$emit("readonly",!1)})),e.on("tool-open",(function(e){t.tool=e}))},methods:{useTransformerFromSelector:function(){var t=this.$editor.solution,e=t.tool,n=t.drawing;e.activated===e.symbol.SELECTOR&&(e.openTransformer(),n.focusing instanceof this.$editor.Element.Hollow&&n.hammer.adjuster.pick())},autoCheck:function(){var t=this;setTimeout((function(){t.checkState(),t.autoCheck()}),So)},checkState:function(){var t=this,e=this.$editor;this.$e100.updateStatus().then((function(n){null===n&&e.feature.tool.closeAll(),t.$root.$emit("readonly",!n)}))}}},jo=_o,Co=Object(Gt["a"])(jo,Wt,Rt,!1,null,null,null),Lo=Co.exports,$o=n("c20e"),Do=n("a007"),Wo=n("e3fc"),Ro=(n("dca8"),n("3ca3"),n("10d1"),n("ddb0"),n("7d94")),Eo=function(t){Object(Do["a"])(n,t);var e=Object(Wo["a"])(n);function n(){return Object(C["a"])(this,n),e.apply(this,arguments)}return Object(L["a"])(n)}(Ro["a"].Emitter),Ao=(n("81b2"),n("0eb6"),n("b7ef"),n("8bd4"),n("fb6a"),n("5cc6"),n("907a"),n("9a8c"),n("a975"),n("735e"),n("c1ac"),n("d139"),n("3a7b"),n("d5d6"),n("82f8"),n("e91f"),n("60bd"),n("5f96"),n("3280"),n("3fcc"),n("ca91"),n("25a1"),n("cd26"),n("3c5d"),n("2954"),n("649e"),n("219c"),n("170b"),n("b39a"),n("72f7"),n("fa9e"),n("77d9"),n("c740"),n("9224")),No={selector:"selector",transformer:"transformer",save:"save",clear:"clear",lock:"lock",unlock:"unlock"},Po=(xt={},Object(Nt["a"])(xt,No.selector,{label:"选择",image:{base:"img/Pointer.svg",hover:"img/Pointer_Active.svg",active:"img/Pointer_Active.svg"}}),Object(Nt["a"])(xt,No.transformer,{label:"移动",image:{base:"img/Move.svg",hover:"img/Move_Active.svg",active:"img/Move_Active.svg"}}),Object(Nt["a"])(xt,No.save,{label:"保存",image:{base:"img/Save.svg",hover:"img/Save_Active.svg"}}),Object(Nt["a"])(xt,No.clear,{label:"清空",image:{base:"img/Clear.svg",hover:"img/Clear_Active.svg"}}),Object(Nt["a"])(xt,No.lock,{label:"锁定",image:{base:"img/Lock.svg",hover:"img/Lock_Active.svg"}}),Object(Nt["a"])(xt,No.unlock,{label:"解锁",image:{base:"img/Unlock.svg",hover:"img/Unlock_Active.svg"}}),xt),Fo={singleDoor:"singleDoor",doubleDoor:"doubleDoor",slidingDoor:"slidingDoor",basicWindow:"basicWindow",boilerWindow:"boilerWindow",bealock:"bealock"},Mo={door:"door",window:"window",bealock:"bealock"},Bo={entrance:"entrance",flipWall:"flipWall",flip:"flip",delete:"delete"},Go=(Ot={},Object(Nt["a"])(Ot,Fo.singleDoor,{label:"单开门",resource:100}),Object(Nt["a"])(Ot,Fo.doubleDoor,{label:"双开门",resource:101}),Object(Nt["a"])(Ot,Fo.slidingDoor,{label:"推拉门",resource:102}),Object(Nt["a"])(Ot,Fo.basicWindow,{label:"普通窗",resource:103}),Object(Nt["a"])(Ot,Fo.boilerWindow,{label:"一字飘窗",resource:104}),Object(Nt["a"])(Ot,Fo.bealock,{label:"垭口",resource:105}),Ot),Uo=(Tt={},Object(Nt["a"])(Tt,Mo.door,{label:"门",list:[Fo.singleDoor,Fo.doubleDoor,Fo.slidingDoor]}),Object(Nt["a"])(Tt,Mo.window,{label:"窗",list:[Fo.basicWindow,Fo.boilerWindow]}),Object(Nt["a"])(Tt,Mo.bealock,{label:"垭口",list:[Fo.bealock]}),Tt),Ho=(St={},Object(Nt["a"])(St,Bo.entrance,{label:"入户门",image:{base:"img/Entrance.svg"}}),Object(Nt["a"])(St,Bo.flipWall,{label:"内外翻转",image:{base:"img/FlipWall.svg"}}),Object(Nt["a"])(St,Bo.flip,{label:"左右翻转",image:{base:"img/Flip.svg"}}),Object(Nt["a"])(St,Bo.delete,{label:"删除",image:{base:"img/Delete.svg"}}),St),zo={leftRight:[Fo.doubleDoor,Fo.basicWindow,Fo.boilerWindow,Fo.bealock],topBottom:[Fo.slidingDoor,Fo.slidingDoor,Fo.basicWindow,Fo.bealock]},Vo={common:"common",bearing:"bearing",short:"short"},Io={split:"split",delete:"delete"},Jo=(_t={},Object(Nt["a"])(_t,Vo.common,{label:"普通墙",resource:1}),Object(Nt["a"])(_t,Vo.bearing,{label:"承重墙",resource:2}),Object(Nt["a"])(_t,Vo.short,{label:"矮墙",resource:3}),_t),Ko=(jt={},Object(Nt["a"])(jt,Io.split,{label:"截断",image:{base:"img/Split.svg"}}),Object(Nt["a"])(jt,Io.delete,{label:"删除",image:{base:"img/Delete.svg"}}),jt),Yo=["客厅","餐厅","客餐厅","厨房","主卧","次卧","卧室","老人房","儿童房","过道","阳台","卫生间","玄关","地下室"],qo=["主卧","次卧","卧室","老人房","儿童房","地下室"],Xo=["客厅","餐厅","客餐厅"],Zo=["卫生间"],Qo={install:function(t){t.prototype.$spec={menu:l,hollow:c,wall:u,room:p}}},ti=new Dt,ei=p.bedroomTypeList,ni=p.bathroomTypeList,oi=p.hallTypeList,ii=function(t){return(t/1e6).toFixed(2)},ri=function(t,e,n,o,i,r){return((n-t)*(r-e)-(i-t)*(o-e))/2},ai=function(t){if(!(t.length<3)){for(var e=t[0],n=0,o=0,i=0,r=t[1],a=2;a<t.length;a++){var s=t[a],l=ri.apply(void 0,Object(_["a"])(e).concat(Object(_["a"])(r),Object(_["a"])(s)));i+=l,n+=(e[0]+r[0]+s[0])*l,o+=(e[1]+r[1]+s[1])*l,r=s}return[n/i/3,o/i/3]}},si=function(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:512,o=atob(t),i=[],r=0;r<o.length;r+=n){for(var a=o.slice(r,r+n),s=new Array(a.length),l=0;l<a.length;l++)s[l]=a.charCodeAt(l);i.push(new Uint8Array(s))}return new Blob(i,{type:e})},li=function(t,e,n){var o=ui(t,n),i=pi(t,e,n),r=di(t,e,n);return{info:o,entrance:i,floors:r}},ci=function(t,e){var n=t.find((function(t){return t.info.flooridx===e.level})),o=n.info,i=o.width,r=o.height,a=o.ratio,s=o.floor_height,l=o.center_point_coordinates;ti.setWidth(i/a),ti.setHeight(r/a),ti.setRotation(e.bitmap.rotation),ti.setCenter.apply(ti,Object(_["a"])(e.bitmap.position)),ti.setReferenceY(s),ti.setWorldOrigin(l.u,l.v)},ui=function(t,e){var n=0,o=0,i=0,r=t.floor.list[0].bitmap.rotation,a=e[0];return t.floor.list.forEach((function(t){t.roomList&&t.roomList.forEach((function(t){var e=t.type;n+=ei.indexOf(e)>-1?1:0,o+=oi.indexOf(e)>-1?1:0,i+=ni.indexOf(e)>-1?1:0}))})),{version:Ao["a"],name:t.name,room:"".concat(n,"室"),hall:"".concat(o,"厅"),bathroom:"".concat(i,"卫"),rotation:r,totalfloor:t.floor.list.length,resolution:a?a.compute.resolution:0}},pi=function(t,e,n){var o=-1,r=t.floor.list.findIndex((function(t){return!!t.hollowList&&(o=t.hollowList.findIndex((function(t){return t.entrance})),-1!==o)}));if(-1===r)return{exist_entrance:!1,position:null,uv:null,normal_vector:null};var a=t.floor.list[r],s=n[r],l=a.drawing,c=l.cornerList,u=l.hollowList,p=u[o],d=p.surface,f=p.offset,h=c[d[0]],m=c[d[1]],v=Object(_["a"])(i.normalize.apply(i,Object(_["a"])(i.from.apply(i,Object(_["a"])(h).concat(Object(_["a"])(m)))))),b=Object(_["a"])(i.multiply.apply(i,Object(_["a"])(v).concat([f]))),g=Object(_["a"])(i.rotate90.apply(i,Object(_["a"])(b))),y=[b[0]+h[0],b[1]+h[1]];return ci(e,a),{exist_entrance:!0,position:ti.geometryTo3D.apply(ti,y),uv:ti.geometryToCaptureUv.apply(ti,[s.width,s.height,s.x,s.y-s.height].concat(y)),normal_vector:ti.geometryTo3D.apply(ti,Object(_["a"])(g).concat([0]))}},di=function(t,e,n){var o=t.floor.list;return o.map((function(t,o){var i=e.find((function(e){return e.info.flooridx===t.level})),r=i.info,a=i.locations,l=n[o],c=l||{},u=c.width,p=c.height,d=c.x,f=c.y,h=c.compute,m="floor".concat(o>8?o+1:"0"+(o+1));ci(e,t);var v={size:l?{width:u/1e3,height:p/1e3}:null,name:t.name,flooridx:r.flooridx,area:0};h&&(v.area=ii(h.rooms.map((function(t){return t.area})).reduce((function(t,e){return t+e}))));var b=r.center_point_coordinates,g=b.u,y=b.v,w=null!==l?ti.bitmapUvToCaptureUv(u,p,d,f-p,g,y):[0,0],k={exist_plan:null!==l,origin_uv:{u:w[0],v:w[1]},rotate_origin:{position:ti.geometryTo3D.apply(ti,Object(_["a"])(t.bitmap.position)),uv:ti.geometryToCaptureUv.apply(ti,[u,p,d,f-p].concat(Object(_["a"])(t.bitmap.position)))},plan_position:l?[{position:ti.geometryTo3D(d,f),uv:[0,1]},{position:ti.geometryTo3D(d+u,f),uv:[1,1]},{position:ti.geometryTo3D(d+u,f-p),uv:[1,0]},{position:ti.geometryTo3D(d,f-p),uv:[0,0]}]:[]},x=t.drawing.roomList.map((function(e,n){var o=t.roomList[n],i=e.cornerList.map((function(e){var n=t.drawing.cornerList[e];return{x:n[0],y:n[1]}})),l="".concat(m,"_room").concat(n>8?n+1:"0"+(n+1)),c=h.rooms[n];a.forEach((function(t){var e=t.viewpoint,n=e.x,o=e.y;t.position=ti.threeToGeometry(n,o)}));var v={position:ti.geometryTo3D.apply(ti,Object(_["a"])(o.labelPosition)),uv:ti.geometryToCaptureUv.apply(ti,[u,p,d,f-p].concat(Object(_["a"])(o.labelPosition)))},b=a.filter((function(t){var e=Object(j["a"])(t.position,2),n=e[0],o=e[1];return s.containsPoint(i,{x:n,y:o})})).map((function(t){return t.locationid})),g=c.originList.map((function(t){return{position:ti.geometryTo3D.apply(ti,Object(_["a"])(t)),uv:ti.geometryToCaptureUv.apply(ti,[u,p,d,f-p].concat(Object(_["a"])(t)))}})),y=c.connectedRooms.map((function(t){return"".concat(m,"_room").concat(t>8?t+1:"0"+(t+1))}));return{id:l,info:{roomidx:n,name:o.name,area:ii(c.area),roomHeight:r.floor_height,default_position:"",room_center_point:v,rotation:"",direction:"",connected_rooms:y,vertex_position:g,locations:b}}}));return{id:m,info:v,plan:k,rooms:x}}))},fi=new Dt;function hi(){return{name:"untitled",floor:{base:0,list:[]}}}var mi=function(t){var e=t.editor,n=t.accessor,o={name:""};function i(){var t=hi();return t.floor=e.feature.floor.getData(),t.name=o.name,t}function r(t){o.name=t.name,e.feature.floor.setData(t.floor)}return{get name(){return o.name},open:function(){return Object(x["a"])(Object(k["a"])().mark((function t(){var o,i,a,s;return Object(k["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,n.open();case 2:o=t.sent,i=o.drawing,a=o.model,s=o.status,e.data.model=a,r(i),e.emit("opened",!s);case 9:case"end":return t.stop()}}),t)})))()},save:function(){var t=arguments;return Object(x["a"])(Object(k["a"])().mark((function o(){var r,a,s,l,c,u,p;return Object(k["a"])().wrap((function(o){while(1)switch(o.prev=o.next){case 0:return r=!(t.length>0&&void 0!==t[0])||t[0],r&&e.feature.floor.updateFloorData(),a=i(),s=new FormData,l=e.data.model,o.next=7,e.feature.screenshoter.screenshot();case 7:return c=o.sent,u=li(a,l,c),p=a.floor.list[0].drawing.compass,a.floor.list.forEach((function(t,e){var n=t.level,o=l.find((function(t){return t.info.flooridx===n})),i=o.info,r=i.width,a=i.height,u=i.ratio,p=i.floor_height,d=i.center_point_coordinates,f=c[e];if(fi.setWidth(r/u),fi.setHeight(a/u),fi.setRotation(t.bitmap.rotation),fi.setCenter.apply(fi,Object(_["a"])(t.bitmap.position)),fi.setReferenceY(p),fi.setWorldOrigin(d.u,d.v),f){var h=si(f.base64.split(",")[1],"image/png");s.append("screenshot",h,"screenshot_".concat(n,".png"))}})),s.append("drawing",JSON.stringify(a)),s.append("map",JSON.stringify(u)),o.next=15,n.save(s,p.rotation);case 15:case"end":return o.stop()}}),o)})))()}}},vi=(n("8ba4"),n("4e82"),function(t){if(!Number.isInteger(t))throw new TypeError("Invalid base, an integer expected.")}),bi=function(t){if(vi(t.base),!Array.isArray(t.list))throw new TypeError("Invalid lsit, an Array expected.")},gi=function(t){var e=t.editor,n=null,o={base:null,list:[]},i=function(t){if(!o.list.some((function(e){return e.level===t})))throw new Error("Can NOT found a floor level=".concat(t))},r=function(){o.base=null,o.list=[]},a=function(t){return o.list.find((function(e){return e.level===t}))},s={get length(){return o.list.length},get base(){return o.base},get current(){return n},set current(t){n=t},get currentFloor(){return a(n)},select:function(t){if(vi(t),i(t),null!==n){var o=a(n);Object.assign(o,e.serialize())}n=t,this.clear(!0),e.deserialize(a(t))},getData:function(){return o},setData:function(t){bi(t),r(),t.list.slice(0).sort((function(t,e){return t.level-e.level})).forEach((function(t){return o.list.push(t)})),o.base=t.base,s.select(t.base),e.emit("floor-set")},setFloorName:function(t){a(n).name=t},clear:function(t){var n=e.solution.drawing,o=n.structure.getAllCornerList(),i=n.windoor.getAllHollowList(),r=n.entrance.getAllArrowList(),a=n.negative.getAllBitmapList(),s=n.label.getAllLabelImageList();e.feature.tool.openDefault();try{i.forEach((function(t){return t.remove()})),o.forEach((function(t){return t.remove()})),r.forEach((function(t){return t.remove()})),s.forEach((function(t){return t.remove()})),t&&a.forEach((function(t){return t.remove()}))}catch(l){console.log(l),this.save()}},updateFloorData:function(){null!==n&&Object.assign(a(n),e.serialize())}};return s},yi=function(t){var e=t.editor,n=e.solution.tool,o={get activated(){return n.activated},get symbol(){return n.symbol},openDefault:function(){n.openDefault(),e.solution.drawing.common.selector.drop()},openSelector:function(){n.openSelector()},openTransformer:function(){n.openTransformer()},openBuilder:function(){n.openWallBuilder()},openChamber:function(){n.openChamber()},closeAll:function(){n.closeAllTool()}};return o},wi=function(){function t(e,n){Object(C["a"])(this,t),this.wall=e,this.editor=n,this.className="EditorWall",this.resource=1}return Object(L["a"])(t,[{key:"thisSurface",get:function(){return this.wall.thisSurface}},{key:"thatSurface",get:function(){return this.wall.thatSurface}},{key:"thickness",get:function(){return this.wall.thickness},set:function(t){this.wall.thickness=t}},{key:"color",set:function(t){this.wall.color=t}},{key:"setResource",value:function(t){this.resource=t,this.editor.feature.resource.get(t).apply(this.wall)}},{key:"split",value:function(){var t=this.editor.solution.drawing,e=this.wall,n=e.thisCorner,o=e.thatCorner,i=e.thickness,r=t.structure.createCorner((n.x+o.x)/2,(n.y+o.y)/2);t.common.selector.drop(),this.wall.removeSimple();var a=this.editor.map.get(t.structure.createWall(n,r)),s=this.editor.map.get(t.structure.createWall(r,o));a.thickness=i,s.thickness=i,a.setResource(this.resource),s.setResource(this.resource)}}]),t}(),ki=function(){function t(e,n){Object(C["a"])(this,t),this.room=e,this.editor=n,this.className="EditorRoom",this.type="",this.name="",this.labelPosition=null}return Object(L["a"])(t,[{key:"area",get:function(){return this.room.area}},{key:"label",get:function(){var t=this;return this.editor.solution.drawing.label.getAllLabelTextList().find((function(e){return e.room===t.room}))||null}},{key:"setType",value:function(t){this.type=t}},{key:"setName",value:function(t){if(this.name=t,this.label){var e="";this.editor.state.roomNameShow&&(e+=t),this.editor.state.roomAreaShow&&(e+="".concat(e.length>0?"\n":"","约").concat(ii(this.area),"m²")),this.label.setText(e)}}},{key:"getLabelPosition",value:function(){return Object(_["a"])(this.labelPosition)}},{key:"setLabelPosition",value:function(t,e){this.labelPosition=[t,e],this.label&&this.label.setPosition(t,e)}},{key:"updateLabelPosition",value:function(){var t=this.room.getOuterSurfaceList().map((function(t){return[t.corner.x,t.corner.y]}));this.setLabelPosition.apply(this,Object(_["a"])(ai(t)))}},{key:"updateLabelText",value:function(){this.setName(this.name)}}]),t}(),xi=function(t,e){var n=t.x-e.x,o=t.y-e.y;return Math.pow(n*n+o*o,.5)},Oi=function(){function t(e,n){var o=this;Object(C["a"])(this,t),this.hollow=e,this.editor=n,this.className="EditorHollow",this.resource=100,e.on("change",(function(){"virtual"===e.surface.name&&o.setDefaultWidth()}))}return Object(L["a"])(t,[{key:"width",get:function(){return this.hollow.width},set:function(t){this.hollow.setWidth(t)}},{key:"materialName",get:function(){return this.hollow.materialName}},{key:"surface",get:function(){return this.hollow.surface}},{key:"offset",get:function(){return this.hollow.offset},set:function(t){this.hollow.setOffset(t)}},{key:"arrow",get:function(){var t=this,e=this.editor.solution.drawing.entrance.getAllArrowList().find((function(e){return e.hollow===t.hollow}));return e||null}},{key:"setResource",value:function(t){this.resource=t,this.editor.feature.resource.get(t).apply(this.hollow)}},{key:"setDefaultWidth",value:function(){this.hollow.setWidth(this.hollow.defaultWidth)}},{key:"flip",value:function(){this.hollow.flip()}},{key:"setEntrance",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=this.editor.solution.drawing,n=e.entrance.getAllArrowList();if(this.arrow)return this.arrow.remove(),void this.editor.emit("entrance",!1);n.forEach((function(t){return t.remove()})),this.editor.feature.floor.getData().list.forEach((function(t){var e=t.hollowList;e&&e.length&&e.forEach((function(t){return t.entrance=null}))}));var o=e.entrance.createArrow(this.hollow);t&&o.flip(),this.editor.emit("entrance",!0)}},{key:"changeSurface",value:function(){var t=xi(this.surface.corner,this.surface.back.corner)-this.offset;this.hollow.setSurface(this.surface.back),this.hollow.setOffset(t)}}]),t}(),Ti=function(){function t(e,n){Object(C["a"])(this,t),this.corner=e,this.editor=n,this.className="EditorCorner"}return Object(L["a"])(t,[{key:"walls",get:function(){var t=this;return this.editor.solution.drawing.structure.getAllWallList().filter((function(e){return[e.thisCorner,e.thatCorner].includes(t.corner)})).map((function(e){return t.editor.map.get(e)}))}},{key:"rooms",get:function(){var t=this,e=[];return this.walls.forEach((function(t){var n=t.thisSurface.room,o=t.thatSurface.room;n&&!e.includes(n)&&e.push(n),o&&!e.includes(o)&&e.push(o)})),e.map((function(e){return t.editor.map.get(e)}))}}]),t}(),Si=function(t){var e,n,o,i,r=t.editor,a=t.Element,s=t.Tool,l=r.solution.drawing,c=l.bricklayer.Builder,u=l.bricklayer.Chamber,p=!1,d=(e={},Object(Nt["a"])(e,s.Bricklayer.Builder.PICKUP_FROM,(function(t){0===t&&c.pick()})),Object(Nt["a"])(e,s.Bricklayer.Builder.PICKUP_TO,(function(t){0===t&&c.build().pick().pick()})),e),f=(n={},Object(Nt["a"])(n,s.Bricklayer.Builder.PICKUP_FROM,(function(t){2!==t||p||r.feature.tool.openDefault()})),Object(Nt["a"])(n,s.Bricklayer.Builder.PICKUP_TO,(function(t){2!==t||p||c.drop()})),n),h=(o={},Object(Nt["a"])(o,s.Bricklayer.Chamber.PICKUP_FROM,(function(t){0===t&&u.pick()})),Object(Nt["a"])(o,s.Bricklayer.Chamber.PICKUP_TO,(function(t){0===t&&u.build().pick()})),o),m=(i={},Object(Nt["a"])(i,s.Bricklayer.Chamber.PICKUP_FROM,(function(t){2!==t||p||r.feature.tool.openDefault()})),Object(Nt["a"])(i,s.Bricklayer.Chamber.PICKUP_TO,(function(t){2!==t||p||u.drop()})),i),v=function(t){0===t&&l.common.selectorAction(l.focusing)},b=function(t){if(2!==t||p||r.feature.tool.openDefault(),0===t){var e=l.focusing;l.common.transformerAction(e),e instanceof a.Hollow?l.hammer.adjuster.pick():l.hammer.adjuster.drop(),e instanceof a.LabelText?l.label.LabelTransformer.pick():l.label.LabelTransformer.drop()}};l.on("pointerdown",(function(t){if(2===t.button){var e=function(){return p=!0},n=function t(){l.off("pointermove",e),window.removeEventListener("mouseup",t)};p=!1,l.on("pointermove",e),window.addEventListener("mouseup",n)}c.$state!==s.Ready&&d[c.$state](t.button),u.$state!==s.Ready&&h[u.$state](t.button)})),l.on("pointerup",(function(t){r.feature.tool.activated===r.feature.tool.symbol.SELECTOR&&v(t.button),r.feature.tool.activated===r.feature.tool.symbol.TRANSFORMER&&b(t.button),u.$state!==s.Ready&&m[u.$state](t.button),c.$state!==s.Ready&&f[c.$state](t.button)}));var g=function(){var t=l.structure.getAllRoomList();return t.length?t.map((function(t){return t.area})).reduce((function(t,e){return t+e})):0},y=function(t){r.map.set(t,new Ti(t,r)),t.on("destroy",(function(){return r.map.delete(t)}))},w=function(t){r.map.set(t,new wi(t,r)),t.on("destroy",(function(){r.map.delete(t),setTimeout((function(){var t,e=Object(Ct["a"])(l.structure.rooms());try{for(e.s();!(t=e.n()).done;){var n=t.value;r.map.get(n).updateLabelPosition(),r.map.get(n).updateLabelText()}}catch(o){e.e(o)}finally{e.f()}r.emit("area-change",g())}))}))},k=function(t){var e=new ki(t,r);r.map.set(t,e),setTimeout((function(){var n="未命名",o=l.label.createLabelText();o.setRoom(t),e.setName(n),e.updateLabelPosition(),r.emit("area-change",g()),t.on("destroy",(function(){o.remove(),r.map.delete(t)})),c.$state===s.Bricklayer.Builder.PICKUP_TO&&1!==c.from.size&&c.drop()}))},x=function(t){r.map.has(t)||r.map.set(t,new Oi(t,r)),t.on("destory",(function(){return r.map.delete(t)}))},O=function(t){t.on("change",(function(){t.room&&r.map.get(t.room).setLabelPosition(t.x,t.y)}))},T=function(t){t.on("pointerdown",(function(){t.flip()}))},S=function(t){r.state.dimensionShow||t.hide()};l.on("element-create",(function(t){t instanceof a.Corner&&y(t),t instanceof a.Wall&&w(t),t instanceof a.Room&&k(t),t instanceof a.Hollow&&x(t),t instanceof a.LabelText&&O(t),t instanceof a.Arrow&&T(t),t instanceof a.Dimension&&S(t)}));var _=function(t){var e,n=r.map.get(t).rooms,o=Object(Ct["a"])(n);try{for(o.s();!(e=o.n()).done;){var i=e.value;i.updateLabelPosition(),i.updateLabelText()}}catch(a){o.e(a)}finally{o.f()}},j=function(t){var e=t.thisSurface,n=t.thatSurface,o=r.map.get(e.room),i=r.map.get(n.room);o&&(o.updateLabelPosition(),o.updateLabelText()),i&&(i.updateLabelPosition(),i.updateLabelText())};l.structure.on("change",(function(t){t instanceof a.Corner&&_(t),t instanceof a.Wall&&j(t),r.emit("area-change",g())})),l.canvasElement.addEventListener("wheel",(function(){r.solution.drawing.common.selector.drop()})),window.addEventListener("keydown",(function(t){if("Escape"===t.key){if(r.feature.tool.activated===r.feature.tool.symbol.WALL_BUILDER&&c.$state===s.Bricklayer.Builder.PICKUP_TO)return void c.drop();r.feature.tool.openDefault()}"Delete"===t.key&&l.common.remove()}));var C={setScale:function(t){l.setScale(t),l.common.selector.drop()},originBackToCenter:function(){var t=l.width,e=l.height;l.setOrigin(t/2,e/2),this.setScale(25)},negativeBackToCenter:function(){var t=l.width,e=l.height,n=l.negative.getAllBitmapList();if(n[0]){var o=n[0],i=o.width,r=o.height;l.viewport.ViewAdjuster.backToCenter(-i/2,r/2,i/2,-r/2)}else l.setOrigin(t/2,e/2),l.setScale(25);l.common.selector.drop()}};return C},_i=n("493b"),ji=Object(L["a"])((function t(e){Object(C["a"])(this,t),this.id=e})),Ci=function(){function t(){Object(C["a"])(this,t),this.map=new WeakMap,this.resources={},this.classes={}}return Object(L["a"])(t,[{key:"CustomResource",value:function(t){return this.classes[t]}},{key:"get",value:function(t){return this.resources[t]}},{key:"define",value:function(t,e){var n=e,o=this,i="".concat(t,"Resource"),r=Object(Nt["a"])({},i,function(t){Object(Do["a"])(i,t);var e=Object(Wo["a"])(i);function i(t){var r;Object(C["a"])(this,i),r=e.call(this,t),o.resources[t]=Object($o["a"])(r);for(var a=arguments.length,s=new Array(a>1?a-1:0),l=1;l<a;l++)s[l-1]=arguments[l];return r.data=n.Data.apply(n,s),r}return Object(L["a"])(i,[{key:"apply",value:function(t,e){return n.apply(t,this.data,e,this.id),o.map.set(t,this),this}}],[{key:"create",value:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];return Object(_i["a"])(this,[t].concat(n))}}]),i}(ji))[i];return this.classes[t]=r,r}}]),t}(),Li=(n("cb29"),Math.PI),$i=60,Di=15,Wi=10,Ri={stateless:{line:0,arcLine:14145753,fill:16777215,windowFill:13421772},hover:{line:8053503,arcLine:15464441,fill:16777215,windowFill:13421772},select:{line:4096759,arcLine:15068665,fill:16777215,windowFill:13421772},virtual:{line:16711680,arcLine:16711680,fill:16777215,windowFill:16777215}},Ei=function(t){var e=t.hover,n=t.focus,o=t.select,i=t.virtual;return o||n?Ri.select:e?Ri.hover:i?Ri.virtual:Ri.stateless},Ai={width:800,render:function(t,e){var n=e.width,o=e.height,i=e.fliped,r=e.scale,a=i?1:0,s=Di/r,l=$i/r,c=Ei(e);return t.lineStyle(s,c.arcLine).beginFill(c.fill,.1).arc(n*a,o/2,n,-Li/2*a-Li/2,-Li*a/2).lineTo(n*a,o/2).lineTo(0,o/2-n+a*n).endFill().beginFill(c.fill).lineStyle(s,c.fill).drawRect(0,0,n,o).lineStyle(s,c.line).moveTo(0,0).lineTo(0,o).moveTo(n,0).lineTo(n,o).lineStyle(s,c.line).drawRect((n-l)*a,o/2,l,-n),t.pivot.x=n/2,t.pivot.y=o/2,t}},Ni={width:800,render:function(t,e){var n=e.width,o=e.height,i=e.scale,r=Di/i,a=$i/i,s=Ei(e);return t.lineStyle(r,s.arcLine).beginFill(s.fill,.1).arc(0,o/2,n/2,-Li/2,0).lineTo(0,o/2).lineTo(0,(o-n)/2).endFill().beginFill(s.fill,.1).lineStyle(r,s.arcLine).arc(n,o/2,n/2,Li,-Li/2).lineTo(n,o/2).lineTo(n/2,o/2).endFill().beginFill(s.fill).lineStyle(r,s.fill).drawRect(0,0,n,o).lineStyle(r,s.line).moveTo(0,0).lineTo(0,o).moveTo(n,0).lineTo(n,o).drawRect(0,o/2,a,-n/2).drawRect(n,o/2,-a,-n/2),t.pivot.x=n/2,t.pivot.y=o/2,t}},Pi={width:800,render:function(t,e){var n=e.width,o=e.height,i=e.scale,r=e.fliped,a=r?-1:1,s=Di/i,l=Wi/i,c=Ei(e);return t.lineStyle(s,c.line).beginFill(c.fill).drawRect(0,0,n,o).drawRect(0+s+l,o/2,2*n/3,o/4*a).drawRect(n-s-l,o/2,-2*n/3,-o/4*a),t.pivot.x=n/2,t.pivot.y=o/2,t}},Fi={width:1450,render:function(t,e){var n=e.width,o=e.height,i=e.fliped,r=e.scale,a=i?1:0,s=Di/r,l=Ei(e);return t.lineStyle(s,l.line).beginFill(l.fill).drawRect(0,0,n,o).moveTo(0,o/3).lineTo(n,o/3).moveTo(0,2*o/3).lineTo(n,2*o/3).moveTo(n/4+a*n/2,o/3).lineTo(n/4+a*n/2,2*o/3).endFill(),t.pivot.x=n/2,t.pivot.y=o/2,t}},Mi={width:2e3,render:function(t,e){var n=e.width,o=e.height,i=e.scale,r=Di/i,a=Ei(e);return t.lineStyle(r,a.fill).beginFill(a.fill).drawRect(0,0,n,o).endFill().lineStyle(r,a.line).drawRect(0,0,n,o/3).drawRect(0,2*o/3,n,o/3),t.pivot.x=n/2,t.pivot.y=o/2,t}},Bi={width:800,render:function(t,e){var n=e.width,o=e.height,i=e.scale,r=Di/i,a=Ei(e);return t.lineStyle(r,a.line).beginFill(a.fill).drawRect(0,0,n,o).moveTo(0,o/2).lineTo(n,o/2).endFill(),t.pivot.x=n/2,t.pivot.y=o/2,t}},Gi={width:1500,render:function(t,e){var n=e.width,o=e.scale,i=e.sillThickness,r=void 0===i?500/o:i,a=e.height,s=Di/o,l=a,c=Ei(e);return t.lineStyle(s,c.line).beginFill(c.windowFill).drawRect(0,-r,n,r).endFill().beginFill(c.fill).moveTo(0,-a).lineTo(0,-r).lineTo(n,-r).lineTo(n,-a).lineTo(n+l,-a).lineTo(n+l,-(r+l)).lineTo(-l,-(r+l)).lineTo(-l,-a).lineTo(0,-a).endFill().moveTo(-l/2,-a).lineTo(-l/2,-(r+l/2)).lineTo(n+l/2,-(r+l/2)).lineTo(n+l/2,-a),t.pivot.x=n/2,t.pivot.y=-a/2,t}},Ui={width:1500,render:function(t,e){var n=e.width,o=e.height,i=e.scale,r=Di/i,a=Ei(e);return t.lineStyle(r,a.line).beginFill(a.fill).drawRect(0,0,n,o).endFill().moveTo(0,o/2).lineTo(n,o/2).moveTo(0,o/3).lineTo(n,o/3).moveTo(0,2*o/3).lineTo(n,2*o/3).moveTo(n/2,o/3).lineTo(n/2,2*o/3),t.pivot.x=n/2,t.pivot.y=o/2,t}},Hi={render:function(t,e){var n=e.leftWidth,o=e.rightWidth,i=e.leftWallThickness,r=e.rightWallThickness,a=e.scale,s=Di/a,l=Ei(e);return t.lineStyle(s,l.line).beginFill(l.fill).moveTo(0,0).lineTo(o,0).lineTo(o,r).lineTo(i,r).lineTo(i,n).lineTo(0,n).lineTo(0,0).endFill().moveTo(i/2,n).lineTo(i/2,r/2).lineTo(o,r/2),t.pivot.x=o/2,t.pivot.y=r/2,t}},zi={render:function(t,e){var n=e.leftWidth,o=e.centerWidtn,i=e.rightWidth,r=e.leftWallThickness,a=e.centerWallThickness,s=e.rightWallThickness,l=e.scale,c=Di/l,u=Ei(e);return t.lineStyle(c,u.line).beginFill(u.fill).moveTo(0,0).lineTo(o,0).lineTo(o,i).lineTo(o-s,i).lineTo(o-s,a).lineTo(r,a).lineTo(r,n).lineTo(0,n).lineTo(0,0).endFill().moveTo(r/2,n).lineTo(r/2,a/2).lineTo(o-s/2,a/2).lineTo(o-s/2,i),t.pivot.x=o/2,t.pivot.y=a/2,t}},Vi={render:function(t,e){var n=e.leftWidth,o=e.rightWidth,i=e.leftWindowThickness,r=e.rightWindowThickness,a=e.leftWallThickness,s=e.rightWallThickness,l=e.scale,c=Di/l,u=Ei(e);return t.lineStyle(c,u.line).beginFill(u.windowFill).moveTo(a,s).lineTo(o,s).lineTo(o,s-r).lineTo(a-i,s-r).lineTo(a-i,n).lineTo(a,n).lineTo(a,s).endFill().beginFill(u.fill).moveTo(a-i,s-r).lineTo(o,s-r).lineTo(o,0).lineTo(o+s,0).lineTo(o+s,-r).lineTo(-i,-r).lineTo(-i,n+a).lineTo(0,n+a).lineTo(0,n).lineTo(a-i,n).lineTo(a-i,s-r).endFill().moveTo(0,n+a/2).lineTo(a/2-i,n+a/2).lineTo(a/2-i,s/2-r).lineTo(o+s/2,s/2-r).lineTo(o+s/2,0),t.pivot.x=o/2,t.pivot.y=s/2,t}},Ii={render:function(t,e){var n=e.leftWidth,o=e.centerWidtn,i=e.rightWidth,r=e.leftWindowThinkness,a=e.centerWindowThinkness,s=e.rightWindowThinkness,l=e.leftWallThickness,c=e.centerWallThickness,u=e.rightWallThickness,p=e.scale,d=Di/p,f=Ei(e);return t.lineStyle(d,f.line).beginFill(f.windowFill).moveTo(l,c).lineTo(o-u,c).lineTo(o-u,i).lineTo(o-u+s,i).lineTo(o-u+s,c-a).lineTo(l-r,c-a).lineTo(l-r,n).lineTo(l,n).lineTo(l,c).endFill().beginFill(f.fill).moveTo(l-r,c-a).lineTo(o+s-u,c-a).lineTo(o+s-u,i).lineTo(o,i).lineTo(o,i+u).lineTo(o+s,i+u).lineTo(o+s,-a).lineTo(-r,-a).lineTo(-r,n+l).lineTo(0,n+l).lineTo(0,n).lineTo(l-r,n).lineTo(l-r,c-a).endFill().moveTo(0,n+l/2).lineTo(l/2-r,n+l/2).lineTo(l/2-r,c/2-a).lineTo(o+s-u/2,c/2-a).lineTo(o+s-u/2,i+u/2).lineTo(o,i+u/2),t.pivot.x=o/2,t.pivot.y=c/2,t}},Ji=[100,101,102],Ki=[103,104],Yi=function(){var t=new Ci,e=v,n=b,o=t.define("Wall",{Data:function(t){return t},apply:function(t,e){t.color=e}}),i=t.define("Hollow",{Data:function(t){return t},apply:function(t,e){t.setMaterial(e)}});return o.create(1,null),o.create(2,3355443),o.create(3,16777215),i.create(100,e.SingleDoor),i.create(101,e.DoubleDoor),i.create(102,e.SlidingDoor),i.create(103,n.BasicWindow),i.create(104,n.BoilerWindow),i.create(105,e.Bealock),t},qi=function(){var t=new Ci,e=v,n=b,o=t.define("Wall",{Data:function(t){return t},apply:function(t,e){t.color=e}}),i=t.define("Hollow",{Data:function(t){return t},apply:function(t,e){t.setMaterial(e)}});return o.create(1,16777215),o.create(2,16777215),o.create(3,13421772),i.create(100,e.SingleDoor),i.create(101,e.DoubleDoor),i.create(102,e.SlidingDoor),i.create(103,n.BasicWindow),i.create(104,n.BoilerWindow),i.create(105,e.Bealock),t},Xi=function(t){var e={begin:function(t,e){var n=e.negative.getAllBitmapList();n[0]&&(t.bitmap={position:[n[0].x,n[0].y],rotation:n[0].rotation})},walls:function(t){t.wallList=[]},wall:function(e,n){e.wallList.push({resource:t.map.get(n).resource})},rooms:function(t){t.roomList=[]},room:function(e,n){var o=t.map.get(n);e.roomList.push({type:o.type,name:o.name,labelPosition:Object(_["a"])(o.labelPosition)})},hollows:function(t){t.hollowList=[]},hollow:function(e,n,o){var i=o.entrance.getAllArrowList().find((function(t){return t.hollow===n}));e.hollowList.push({resource:t.map.get(n).resource,entrance:i?{fliped:i.fliped}:null})}},n={end:function(t,e){if(t.bitmap){var n=t.bitmap,o=n.position,i=n.rotation,r=e.negative.createBitmap("negative".concat(t.level));r.setPosition.apply(r,Object(_["a"])(o)),r.setRotation(i)}},wall:function(e,n,o){var i=e.wallList[o],r=t.map.get(n);r.setResource(i.resource)},room:function(e,n,o){var i=e.roomList[o],r=i.name,a=i.type,s=i.labelPosition,l=t.map.get(n);r&&l.setName(r),a&&l.setType(a),s&&l.setLabelPosition.apply(l,Object(_["a"])(s))},hollow:function(e,n,o){var i=e.hollowList[o],r=i.resource,a=i.entrance,s=t.map.get(n);s.setResource(r),a&&s.setEntrance(a.fliped)}};return{serializer:e,deserializer:n}},Zi=new Dt,Qi=10,tr=null,er=function(t,e){var n=t.bitmap,o=e.info,i=o.width,r=o.height,a=o.ratio,s=o.center_point_coordinates;return Zi.setWidth(i/a),Zi.setHeight(r/a),Zi.setRotation(n.rotation),Zi.setCenter.apply(Zi,Object(_["a"])(n.position)),Zi.bitmapUvToGeometry(s.u,s.v)},nr=function(t){var e=t.solution.drawing,n=e.structure.getAllCornerList();n.forEach((function(t){t.hide()}))},or=function(t,e){return new Promise((function(n){var o,i=t.drawing,r=t.hollowList,a=t.wallList,s=t.roomList,l=r?r.map((function(t){return{resource:t.resource}})):[];tr.deserialize({drawing:i,hollowList:l,wallList:a,roomList:s}),nr(tr);var c=er(t,e);(o=tr.solution.drawing.label).createLabelImage.apply(o,Object(_["a"])(c)),setTimeout((function(){var t,e=tr.solution.drawing,o=Object(Ct["a"])(e.measure.dimensions());try{for(o.s();!(t=o.n()).done;){var i=t.value;i.hide()}}catch(D){o.e(D)}finally{o.f()}var r=e.getElementContainerBounds("Wall"),a=e.getElementContainerBounds("Hollow"),s=0!==r.width&&0!==r.height,l=0!==a.width&&0!==a.height;if(s||l){var c=e.scale,u=tr.screenshot(),p=e.toGeometry(r.x,r.y),d=Object(j["a"])(p,2),f=d[0],h=d[1],m=e.toGeometry(a.x,a.y),v=Object(j["a"])(m,2),b=v[0],g=v[1],y=r.width*c,w=r.height*c,k=a.width*c,x=a.height*c,O=e.structure.getAllRoomList(),T=e.windoor.getAllHollowList(),S=[];O.forEach((function(t){var e=t.getOuterSurfaceList(),n=e.map((function(t){return t.origin})),o=[];e.forEach((function(t){var e=t.back,n=T.find((function(n){var o=tr.map.get(n);return[t,e].includes(o.surface)&&Ji.includes(o.resource)}));null!==t.back.room&&n&&o.push(O.indexOf(e.room))})),S.push({area:t.area,originList:n,connectedRooms:o})}));var _=s?l?Math.min(f,b):f:b,C=s?l?Math.max(h,g):h:g,L=s?l?Math.max(f+y,b+k)-_:y:k,$=s?l?C-Math.min(h-w,g-x):w:x;n({base64:u,width:L,height:$,x:_,y:C,compute:{rooms:S,resolution:1/Qi}})}else n(null)}),50)}))},ir=function(t,e){return new Promise((function(n){var o=[];setTimeout(Object(x["a"])(Object(k["a"])().mark((function i(){var r,a,s,l;return Object(k["a"])().wrap((function(i){while(1)switch(i.prev=i.next){case 0:r=Object(Ct["a"])(t.list),i.prev=1,r.s();case 3:if((a=r.n()).done){i.next=11;break}return s=a.value,i.next=7,or(s,e[t.list.indexOf(s)]);case 7:l=i.sent,o.push(l);case 9:i.next=3;break;case 11:i.next=16;break;case 13:i.prev=13,i.t0=i["catch"](1),r.e(i.t0);case 16:return i.prev=16,r.f(),i.finish(16);case 19:n(o);case 20:case"end":return i.stop()}}),i,null,[[1,13,16,19]])}))))}))},rr=function(t){var e=t.Solution,n=t.editor,o={Wall:e.Element.Wall,Room:e.Element.Room,Hollow:e.Element.Hollow},i=function(t){Object(Do["a"])(i,t);var n=Object(Wo["a"])(i);function i(){var t;Object(C["a"])(this,i),t=n.call(this),t.map=new WeakMap,t.solution=new e(Xi(Object($o["a"])(t)));var r=t.solution.drawing;return t.feature={resource:qi()},r.on("element-create",(function(e){e instanceof o.Wall&&t.map.set(e,new wi(e,Object($o["a"])(t))),e instanceof o.Room&&t.map.set(e,new ki(e,Object($o["a"])(t))),e instanceof o.Hollow&&t.map.set(e,new Oi(e,Object($o["a"])(t))),e.on("destory",(function(){return t.map.delete(e)}))})),r.structure.options.wall.style.color=8355711,r.structure.options.wall.midline.show=!1,r.structure.options.surface.opacity=0,r.mount(document.createElement("div")),r.compass.element.hide(),r.setScale(Qi),t}return Object(L["a"])(i,[{key:"deserialize",value:function(t){var e=this.solution.drawing,n=e.structure.getAllCornerList(),o=e.windoor.getAllHollowList(),i=e.negative.getAllBitmapList(),r=e.label.getAllLabelImageList();o.forEach((function(t){return t.remove()})),n.forEach((function(t){return t.remove()})),i.forEach((function(t){return t.remove()})),r.forEach((function(t){return t.remove()})),this.solution.deserializer.execute(t.drawing,t)}},{key:"screenshot",value:function(){return this.solution.drawing.screenshot()}}]),i}(Eo);return{screenshot:function(){return Object(x["a"])(Object(k["a"])().mark((function t(){var e;return Object(k["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=n.data.model,n.feature.floor.updateFloorData(),tr||(tr=new i),t.next=5,ir(n.feature.floor.getData(),e);case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t)})))()}}},ar=new Dt,sr=function(t,e){var n=t.bitmap,o=e.info,i=e.locations,r=o.width,a=o.height,s=o.ratio,l=o.center_point_coordinates;return ar.setWidth(r/s),ar.setHeight(a/s),ar.setRotation(n.rotation),ar.setCenter.apply(ar,Object(_["a"])(n.position)),ar.setWorldOrigin(l.u,l.v),{origin:ar.bitmapUvToGeometry(l.u,l.v),locationList:i.map((function(t){var e=t.viewpoint,n=e.x,o=e.y;return ar.threeToGeometry(n,o)}))}},lr=function(t){var e=t.Solution,n=t.accessor,o={Corner:e.Element.Corner,Wall:e.Element.Wall,Room:e.Element.Room,Hollow:e.Element.Hollow,LabelText:e.Element.LabelText,Bitmap:e.Element.Bitmap,Arrow:e.Element.Arrow,Dimension:e.Element.Dimension},i={Ready:e.Tool.Ready,Common:e.Tool.Common,Hammer:e.Tool.Hammer,Bricklayer:e.Tool.Bricklayer},r=function(t){return Object.freeze({editor:t,Element:o,Tool:i,accessor:n,Solution:e})},a=function(t){Object(Do["a"])(i,t);var n=Object(Wo["a"])(i);function i(){var t;Object(C["a"])(this,i),t=n.call(this),t.map=new WeakMap,t.data={},t.state={roomNameShow:!0,roomAreaShow:!0,dimensionShow:!1,gridShow:!0,snap:!0};var a=r(Object($o["a"])(t)),s=new e(Xi(Object($o["a"])(t))),l=s.drawing;return t.solution=s,t.feature={document:d.install(a),floor:f.install(a),tool:h.install(a),drawing:m.install(a),resource:g.install(a),screenshoter:y.install(a)},t.feature.document.open(),l.common.on("selector-add",(function(e){var n=e.map((function(e){return t.map.get(e)||null}));t.emit("select",n)})),l.common.on("selector-clear",(function(){t.emit("unselect")})),l.on("element-create",(function(e){e instanceof o.Wall?t.emit("wall-create",e):e instanceof o.Room?t.emit("room-create",e):e instanceof o.Hollow?t.emit("hollow-create",e):e instanceof o.Bitmap&&t.emit("bitmap-create",e)})),l.on("element-destroy",(function(e){e instanceof o.Wall?t.emit("wall-destroy",e):e instanceof o.Room?t.emit("room-destroy",e):e instanceof o.Hollow&&t.emit("hollow-destroy",e)})),s.tool.on("open",(function(e){t.emit("tool-open",e)})),l.compass.element.on("change",(function(e){t.emit("compass-change",e)})),Object.freeze(Object($o["a"])(t)),t}return Object(L["a"])(i,[{key:"Element",get:function(){return o}},{key:"getSelected",value:function(){var t=this;return this.solution.drawing.common.getSelectedList().map((function(e){return t.map.get(e)||null}))}},{key:"getState",value:function(){return this.state}},{key:"serialize",value:function(){var t=this.feature.floor,e=t.currentFloor,n=this.solution.serializer.execute(e);return e.drawing=n,t.getData().list.forEach((function(t){t.drawing.compass?t.drawing.compass.rotation=n.compass.rotation:t.drawing.compass={rotation:n.compass.rotation}})),e}},{key:"deserialize",value:function(t){var e;this.solution.deserializer.execute(t.drawing,t);var n=sr(t,this.data.model[this.feature.floor.current]),o=n.origin;(e=this.solution.drawing.label).createLabelImage.apply(e,Object(_["a"])(o))}},{key:"updateAllRoomLabel",value:function(){var t,e=Object(Ct["a"])(this.solution.drawing.structure.rooms());try{for(e.s();!(t=e.n()).done;){var n=t.value;this.map.get(n).updateLabelText()}}catch(o){e.e(o)}finally{e.f()}}},{key:"setRoomNameShow",value:function(t){this.state.roomNameShow=t,this.updateAllRoomLabel()}},{key:"setRoomAreaShow",value:function(t){this.state.roomAreaShow=t,this.updateAllRoomLabel()}},{key:"setDimensionShow",value:function(t){this.state.dimensionShow=t;var e,n=Object(Ct["a"])(this.solution.drawing.measure.dimensions());try{for(n.s();!(e=n.n()).done;){var o=e.value;t?o.show():o.hide()}}catch(i){n.e(i)}finally{n.f()}}},{key:"setGridShow",value:function(t){this.solution.drawing.grid.options.enabled=this.state.gridShow=t}},{key:"setSnap",value:function(t){var e=this.solution.drawing;e.grid.options.rectangular.snap.enabled=t,e.structure.options.snap.corner.active=t,this.state.snap=t}},{key:"negativeRotate",value:function(t){var e=this.solution.drawing.negative.getAllBitmapList(),n=this.feature.floor.getData();e[0].setRotation(t);var o,i=Object(Ct["a"])(n.list);try{for(i.s();!(o=i.n()).done;){var r=o.value;r.bitmap.rotation=t}}catch(a){i.e(a)}finally{i.f()}}},{key:"resetEditorStatus",value:function(){this.solution.drawing.hammer.adjuster.removeElement()}},{key:"delete",value:function(){this.solution.drawing.common.remove()}}]),i}(Eo);return a},cr=function(t){return!!t&&("string"===typeof t.name&&(!!Number.isInteger(t.base)&&!!Array.isArray(t.list)))},ur=function(t){return!(!t||!t.floor)&&("string"===typeof t.name&&(!!Number.isInteger(t.floor.base)&&!!Array.isArray(t.floor.list)))},pr=function(t){return{name:t.name,floor:{base:0,list:t.list.map((function(t){return{name:"",level:t.level,bitmap:{position:[0,0],rotation:0},drawing:{compass:{rotation:0},cornerList:[],wallList:[],roomList:[],hollowList:[],stuffList:[],labelTextList:[],labelLineList:[]}}}))}}},dr={install:function(t,e){var n=lr(e);t.prototype.$editor=new n}},fr=(n("2b3d"),n("9861"),""),hr="/",mr=hr+"api/v1/e100/business/house_plan",vr=hr+"api/v1/status_record",br=new URL(location.href),gr=br.searchParams.get("model_id"),yr=br.searchParams.get("model_version"),wr=br.searchParams.get("work_id"),kr=localStorage.getItem("LOGIN.TOKEN"),xr="/zhanguan/login",Or=function(){var t=Object(x["a"])(Object(k["a"])().mark((function t(e){var n;return Object(k["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(404!==e.status){t.next=2;break}return t.abrupt("return",null);case 2:return t.next=4,e.json();case 4:if(n=t.sent,1!==n.code){t.next=9;break}return t.abrupt("return",n.data);case 9:if(2601!==n.code){t.next=13;break}location.href=xr,t.next=14;break;case 13:return t.abrupt("return",null);case 14:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),Tr=function(){function t(){Object(C["a"])(this,t)}return Object(L["a"])(t,[{key:"getAuth",value:function(){return fetch(mr+"/e100_auth/",{method:"GET",headers:{Authorization:kr}}).then((function(t){return Or(t)}))}},{key:"getModel",value:function(){return fetch("".concat(mr,"/model_data/"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:kr},body:JSON.stringify({model_id:gr,model_version:yr,scene_id:wr})}).then((function(t){return Or(t)})).then((function(t){return fr=t.id,t}))}},{key:"getDrawing",value:function(){return fetch("".concat(mr,"/manager/?model=").concat(gr,"&model_version=").concat(yr,"&work=").concat(wr),{method:"GET",headers:{Authorization:kr}}).then((function(t){return Or(t)})).then((function(t){return t?(fr=t.id,JSON.parse(t.drawing)):null}))}},{key:"saveDrawing",value:function(t){return t.append("model",gr),t.append("model_version",yr),t.append("work",wr),fetch("".concat(mr,"/manager/"),{method:"POST",headers:{Authorization:kr},body:t}).then((function(t){return Or(t)}))}},{key:"getStatus",value:function(){return fetch("".concat(vr,"/status_manager?type=houseplan&object_id=").concat(fr))}},{key:"updateStatus",value:function(){return fetch("".concat(vr,"/status_manager"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"houseplan",session:kr,object_id:fr})}).then((function(t){return 200!==t.status?null:Or(t)}))}},{key:"deleteStatus",value:function(){return fetch("".concat(vr,"/status_manager"),{method:"DELETE",headers:{"Content-Type":"application/json"},body:JSON.stringify({type:"houseplan",object_id:fr}),keepalive:!0})}},{key:"getCompassAngle",value:function(){return fetch("".concat(mr,"/compass_angle/?model=").concat(gr,"&work=").concat(wr),{method:"GET",headers:{Authorization:kr}}).then((function(t){return Or(t)})).then((function(t){return t?t.compass_angle:null}))}},{key:"updateCompassAngle",value:function(t){return fetch("".concat(mr,"/compass_angle/"),{method:"PUT",headers:{"Content-Type":"application/json",Authorization:kr},body:JSON.stringify({model:gr,work:wr,compass_angle:t})}).then((function(t){return Or(t)}))}}]),t}(),Sr=new Tr,_r={install:function(t){t.prototype.$e100=Sr}},jr=n("c6c5"),Cr=function(){var t=Object(x["a"])(Object(k["a"])().mark((function t(){var e,n,o,i,r,a,s=arguments;return Object(k["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:e=s.length>0&&void 0!==s[0]?s[0]:function(){},n={app:"",id:""},o=new URL(location.href),i={hostname:"127.0.0.1",port:"3001"},r=o.searchParams.get("host")||i.hostname,a=o.searchParams.get("port")||i.port,jr["a"]({origin:"//".concat(r).concat(a?":"+a:""),ticket:n.id,app:n.app},(function(t,n){window.PIXI=n.PIXI,e(t)}));case 7:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),Lr=n("8f9c"),$r=new Dt,Dr=function(t){return t/360*2*Math.PI};Cr((function(t){O["default"].use(T["a"],Lr),O["default"].use(S["a"]),O["default"].use(_r),O["default"].use(Qo),O["default"].use(dr,{Solution:t,accessor:{save:function(t){return Object(x["a"])(Object(k["a"])().mark((function e(){return Object(k["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:console.log(t);case 1:case"end":return e.stop()}}),e)})))()},open:function(){return Object(x["a"])(Object(k["a"])().mark((function e(){var n,o,i,r,a,s,l,c;return Object(k["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=[{name:"测试1",info:{center_point_coordinates:{u:.4268035292625427,v:.4820511341094971},direction:0,floor_height:6.162445068359375,flooridx:0,height:1477,planformUrl:"https://bucket-model.oss-cn-beijing.aliyuncs.com/c07782ca_on4j_b6f9_cs_1/2022-08-16-13-48-02/map_fit_00.png",ratio:.1,width:1147},locations:[]},{name:"测试2",info:{center_point_coordinates:{u:.5011234283447266,v:.5610423684120178},direction:0,floor_height:3.563536167144775,flooridx:1,height:1477,planformUrl:"https://bucket-model.oss-cn-beijing.aliyuncs.com/c07782ca_on4j_b6f9_cs_1/2022-08-16-13-48-02/map_fit_01.png",ratio:.1,width:1147},locations:[]}],o=n.map((function(t){var e=t.info,n=e.width,o=e.height,i=e.flooridx,r=e.planformUrl,a=e.ratio,s=e.extra,l=e.floor_height,c=e.center_point_coordinates,u=[];return Array.isArray(s)&&s.length&&($r.setWidth(n/a),$r.setHeight(o/a),$r.setRotation(0),$r.setCenter(0,0),$r.setReferenceY(l),$r.setWorldOrigin(c.u,c.v),u=s.map((function(t){return t.map((function(t){return $r.threeToGeometry(t.x,t.y)}))}))),{level:i,bitmap:r,scale:a,extra:u}})),i={name:n[0].name,base:0,list:o},w.isHouse(i)){e.next=5;break}throw new TypeError("Invalid house, a house object expected.");case 5:return e.next=7,t.Registry.negativeListRegister(i.list.map((function(t){var e=t.level,n=t.bitmap,o=t.scale,i=t.extra;return{id:"negative".concat(e),url:n,scale:o,extra:i}})));case 7:if(r=w.fromHouse(i),null!==r&&0!==Object.keys(r).length){e.next=18;break}return a=w.fromHouse(i),s=new FormData,s.append("drawing",JSON.stringify(a)),s.append("map",JSON.stringify({})),e.next=15,Sr.saveDrawing(s);case 15:return e.next=17,Sr.getDrawing();case 17:r=e.sent;case 18:if(w.isDrawing(r)){e.next=20;break}throw new TypeError("Invalid drawing, a drawing object expected.");case 20:return r.name=n[0].name,l=0,c=!0,l&&r.floor.list.forEach((function(t){t.drawing.compass.rotation=Dr(l)})),e.abrupt("return",{status:c,drawing:r,model:n.map((function(t){return{info:t.info,locations:t.locations}}))});case 25:case"end":return e.stop()}}),e)})))()}}});var e=new O["default"]({render:function(t){return t(Lo)}});window.addEventListener("keydown",(function(t){t.altKey&&t.preventDefault()})),window.addEventListener("resize",(function(){e.$emit("drawing-resize")})),e.$mount("#app")}))},"687c":function(t,e,n){"use strict";n("2b1a")},"698f":function(t,e,n){"use strict";n("389a")},"6db6":function(t,e,n){"use strict";n("aeae")},"783f":function(t,e,n){"use strict";n("ddc3")},"78a9":function(t,e,n){"use strict";n("026c")},"7b33":function(t,e,n){"use strict";n("b2ed")},8899:function(t,e,n){},"88d6":function(t,e,n){},"8f9c":function(t){t.exports=JSON.parse('{"breakpoints":["xs","sm","md","lg","xl","xxl"],"formControls":{"size":"sm"},"BLink":{"activeClass":"active"},"BButton":{"variant":"primary","size":"sm"},"BToast":{"toaster":"b-toaster-top-center","autoHideDelay":3000,"variant":"primary","toastClass":null,"headerClass":null,"bodyClass":null},"BModal":{"cancelVariant":"secondary","okVariant":"primary"},"BFormGroup":{"labelSize":"sm"},"BInputGroup":{"size":"sm"},"BNavItem":{"linkClasses":["p-0","px-1"]}}')},9018:function(t,e,n){},9224:function(t){t.exports=JSON.parse('{"a":"0.0.0"}')},9342:function(t,e,n){"use strict";n("f083")},"95f6":function(t,e,n){"use strict";n("cdee")},aeae:function(t,e,n){},b2ed:function(t,e,n){},bb78:function(t,e,n){"use strict";n("5051")},cdee:function(t,e,n){},ddc3:function(t,e,n){},f083:function(t,e,n){},f709:function(t,e,n){"use strict";n("fabd")},fabd:function(t,e,n){}});