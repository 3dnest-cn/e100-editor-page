(function(t){function e(e){for(var i,a,s=e[0],l=e[1],c=e[2],p=0,d=[];p<s.length;p++)a=s[p],Object.prototype.hasOwnProperty.call(o,a)&&o[a]&&d.push(o[a][0]),o[a]=0;for(i in l)Object.prototype.hasOwnProperty.call(l,i)&&(t[i]=l[i]);u&&u(e);while(d.length)d.shift()();return r.push.apply(r,c||[]),n()}function n(){for(var t,e=0;e<r.length;e++){for(var n=r[e],i=!0,s=1;s<n.length;s++){var l=n[s];0!==o[l]&&(i=!1)}i&&(r.splice(e--,1),t=a(a.s=n[0]))}return t}var i={},o={app:0},r=[];function a(e){if(i[e])return i[e].exports;var n=i[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=t,a.c=i,a.d=function(t,e,n){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},a.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)a.d(n,i,function(e){return t[e]}.bind(null,i));return n},a.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],l=s.push.bind(s);s.push=e,s=s.slice();for(var c=0;c<s.length;c++)e(s[c]);var u=l;r.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"0085":function(t,e,n){"use strict";n("12fd")},"026c":function(t,e,n){},1227:function(t,e,n){},"12fd":function(t,e,n){},"14ac":function(t,e,n){"use strict";n("9018")},"2b1a":function(t,e,n){},"389a":function(t,e,n){},"3a74":function(t,e,n){},"40e4":function(t,e,n){"use strict";n("8899")},"4c00":function(t,e,n){"use strict";n("88d6")},5051:function(t,e,n){},"507d":function(t,e,n){"use strict";n("3a74")},"56d7":function(t,e,n){"use strict";n.r(e);var i={};n.r(i),n.d(i,"Line",(function(){return be})),n.d(i,"Vector",(function(){return ye})),n.d(i,"Segment",(function(){return ke})),n.d(i,"Point",(function(){return Oe}));var o={};n.r(o),n.d(o,"fromBothPoint",(function(){return Te})),n.d(o,"fromSegment",(function(){return je})),n.d(o,"from",(function(){return _e})),n.d(o,"dot",(function(){return Ce})),n.d(o,"multiply",(function(){return $e})),n.d(o,"cross",(function(){return Le})),n.d(o,"length",(function(){return We})),n.d(o,"rotate90",(function(){return Re})),n.d(o,"normalize",(function(){return Ee})),n.d(o,"invert",(function(){return Ne})),n.d(o,"rotate",(function(){return Pe})),n.d(o,"project",(function(){return Ae})),n.d(o,"equal",(function(){return Ve}));var r={};n.r(r),n.d(r,"fromSegment",(function(){return Ke})),n.d(r,"toStandard",(function(){return tn})),n.d(r,"intersectLine",(function(){return nn}));var a={};n.r(a),n.d(a,"translate",(function(){return Se})),n.d(a,"toLeftOfSegment",(function(){return Ue})),n.d(a,"rotate",(function(){return Ge})),n.d(a,"project",(function(){return He})),n.d(a,"distanceToPoint",(function(){return Je})),n.d(a,"distanceToLine",(function(){return Ye})),n.d(a,"distanceToSegment",(function(){return on})),n.d(a,"equal",(function(){return rn}));var s={};n.r(s),n.d(s,"install",(function(){return Ri}));var l={};n.r(l),n.d(l,"install",(function(){return Pi}));var c={};n.r(c),n.d(c,"install",(function(){return Ai}));var u={};n.r(u),n.d(u,"install",(function(){return Gi}));var p={};n.r(p),n.d(p,"SingleDoor",(function(){return eo})),n.d(p,"DoubleDoor",(function(){return no})),n.d(p,"SlidingDoor",(function(){return io})),n.d(p,"ParentDoor",(function(){return oo})),n.d(p,"Bealock",(function(){return ro}));var d={};n.r(d),n.d(d,"BasicWindow",(function(){return ao})),n.d(d,"BoilerWindow",(function(){return so})),n.d(d,"FloorWindow",(function(){return lo})),n.d(d,"LWindow",(function(){return co})),n.d(d,"UWindow",(function(){return uo})),n.d(d,"LBoilerWindow",(function(){return po})),n.d(d,"UBoilerWindow",(function(){return fo}));var f={};n.r(f),n.d(f,"install",(function(){return ho}));var h={};n.r(h),n.d(h,"install",(function(){return vo}));var m={};n.r(m),n.d(m,"install",(function(){return ko}));var v={};n.r(v),n.d(v,"isHouse",(function(){return Oo})),n.d(v,"isDrawing",(function(){return So})),n.d(v,"fromHouse",(function(){return To}));var b={};n.r(b),n.d(b,"symbol",(function(){return Po})),n.d(b,"map",(function(){return Ao}));var g={};n.r(g),n.d(g,"symbol",(function(){return Fo})),n.d(g,"typeSymbol",(function(){return Mo})),n.d(g,"toolSymbol",(function(){return Bo})),n.d(g,"map",(function(){return zo})),n.d(g,"typeMap",(function(){return Io})),n.d(g,"toolMap",(function(){return Vo}));var y={};n.r(y),n.d(y,"typeSymbol",(function(){return Uo})),n.d(y,"toolSymbol",(function(){return Go})),n.d(y,"typeMap",(function(){return Ho})),n.d(y,"toolMap",(function(){return Jo}));var w={};n.r(w),n.d(w,"typeList",(function(){return Yo}));var k,x=n("d198"),O=n("7580"),S=(n("e260"),n("e6cf"),n("cca6"),n("a79d"),n("b0c0"),n("d81d"),n("d9e2"),n("b64b"),n("e9c4"),n("1227"),n("2b0e")),T=n("5f5b"),j=n("b1e0"),_=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"d-flex flex-column position-relative w-100 h-100",attrs:{id:"app"}},[n("div",[n("app-menu")],1),n("div",{staticClass:"d-flex flex-fill w-100"},[n("div",[n("app-tool-bar")],1),n("div",{staticClass:"h-100 w-100 overflow-hidden position-relative"},[n("div",{ref:"drawing",staticClass:"w-100 h-100",staticStyle:{"line-height":"0"},on:{dblclick:t.useTransformerFromSelector}}),n("app-tool-setting"),n("app-property-card"),n("div",{staticClass:"position-absolute",staticStyle:{right:"20px",bottom:"100px"}},[n("app-check")],1),n("div",{staticClass:"position-absolute",staticStyle:{right:"20px",bottom:"40px"}},[n("app-viewport")],1),n("div",{staticClass:"position-absolute",staticStyle:{left:"40px",bottom:"40px"}},[n("app-visible")],1)],1),n("div",[n("app-property")],1)])])},C=[],$=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"d-flex justify-content-between align-items-center border-bottom",staticStyle:{height:"76px"},attrs:{id:"menu"}},[n("div",{staticClass:"d-flex align-items-center px-3 font-weight-bold",staticStyle:{width:"500px",height:"50px","line-height":"50px"}},[n("b-img",{staticClass:"mr-3",staticStyle:{width:"30px"},attrs:{src:"img/House.svg"}}),n("span",[t._v(t._s(t.name))])],1),n("div",{staticClass:"d-flex align-items-center app-custom"},t._l(t.toolGroupList,(function(e,i){return n("div",{key:i,staticClass:"d-flex align-items-center"},[t._l(e,(function(e){return n("b-button",{directives:[{name:"show",rawName:"v-show",value:t.shownMap[e],expression:"shownMap[symbol]"}],key:e,staticClass:"menu-btn",attrs:{disabled:t.disabledMap[e]||t.readonly,pressed:e===t.active,variant:"outline-secondary"},on:{click:t.buttonMethods[e]}},[n("b-img",{staticStyle:{width:"30px"},attrs:{src:t.toolMap[e].image[e===t.active?"active":"base"]}}),n("span",{staticClass:"mt-1"},[t._v(t._s(t.toolMap[e].label))])],1)})),i<t.toolGroupList.length-1?n("div",{staticClass:"border-left",staticStyle:{height:"50px"}}):t._e()],2)})),0),n("div",{staticClass:"d-flex flex-row-reverse",staticStyle:{width:"500px"}},[n("b-button",{staticClass:"menu-btn",attrs:{variant:"outline-secondary"},on:{click:t.showExitModal}},[n("b-img",{staticStyle:{width:"30px"},attrs:{src:"img/Quit.svg"}}),n("span",{staticClass:"mt-1"},[t._v("退出")])],1)],1),n("b-modal",{attrs:{id:"clear-modal",title:"一键清空","hide-footer":"",size:"sm"}},[n("div",{staticClass:"d-block text-center mt-3 mb-4"},[t._v("您确定要清空当前楼层的户型图")]),n("div",{staticClass:"d-flex justify-content-center align-items-center"},[n("b-button",{staticClass:"mt-0 mr-3",attrs:{block:""},on:{click:function(e){return t.$bvModal.hide("clear-modal")}}},[t._v("取消")]),n("b-button",{staticClass:"mt-0",attrs:{block:"",variant:"danger"},on:{click:t.clear}},[t._v("确定")])],1)]),n("b-modal",{attrs:{id:"exit-modal",title:"退出","hide-footer":"",size:"sm"}},[n("div",{staticClass:"d-block text-center mt-3 mb-4"},[t._v("您是否要退出户型图绘制工具")]),n("div",{staticClass:"d-flex justify-content-center align-items-center"},[n("b-button",{staticClass:"mt-0 mr-3",attrs:{block:""},on:{click:function(e){return t.$bvModal.hide("exit-modal")}}},[t._v("取消")]),n("b-button",{staticClass:"mt-0",attrs:{block:"",variant:"danger"},on:{click:t.exit}},[t._v("确定")])],1)]),n("b-toast",{attrs:{visible:t.readonly,"no-auto-hide":"","no-hover-pause":"",variant:"danger","toast-class":"custom-toast"}},[t._v("已有用户正在绘制中，暂不支持同时绘制，请稍等")])],1)},L=[],D=n("2fe6"),W=n("b192"),R=(n("d3b7"),n("159b"),n("4de4"),n("7db0"),6e5),E={data:function(){return{name:"",active:this.$spec.menu.symbol.selector,locked:!1,hasWall:!1,readonly:!1}},computed:{toolMap:function(){return this.$spec.menu.map},toolGroupList:function(){var t=this.$spec.menu.symbol;return[[t.selector,t.transformer],[t.save,t.clear,t.lock,t.unlock]]},disabledMap:function(){var t=this.$spec.menu.symbol,e={};return Object.keys(t).forEach((function(t){return e[t]=!1})),Object(W["a"])(Object(W["a"])({},e),{},Object(D["a"])({},t.unlock,this.hasWall))},shownMap:function(){var t,e=this.$spec.menu.symbol,n={};return Object.keys(e).forEach((function(t){return n[t]=!0})),Object(W["a"])(Object(W["a"])({},n),{},(t={},Object(D["a"])(t,e.lock,!this.locked),Object(D["a"])(t,e.unlock,this.locked),t))},buttonMethods:function(){var t,e=this,n=this.$spec.menu.symbol;return t={},Object(D["a"])(t,n.selector,(function(){return e.select()})),Object(D["a"])(t,n.transformer,(function(){return e.move()})),Object(D["a"])(t,n.save,(function(){return e.save()})),Object(D["a"])(t,n.clear,(function(){return e.requestClear()})),Object(D["a"])(t,n.lock,(function(){return e.lock()})),Object(D["a"])(t,n.unlock,(function(){return e.unlock()})),t}},mounted:function(){this.init(),this.autoSave()},destroyed:function(){var t=this.$editor;t.off("opened",this._openedListener),t.off("tool-open",this._toolOpenListener),t.off("wall-create",this._wallCreateListener),t.off("wall-destroy",this._wallDestroyListener),this.closeAutoSave()},methods:{init:function(){var t=this,e=this.$editor;this.$root.$on("readonly",(function(e){t.readonly!==e&&(t.readonly=e,e?t.closeAutoSave():t.autoSave())})),e.on("opened",this._openedListener=function(){t.name=e.feature.document.name}),e.on("tool-open",this._toolOpenListener=function(e){t.active!==e&&(t.active=e)}),e.on("wall-create",this._wallCreateListener=function(){t.hasWall=!0,t.locked||t.lock(!0)}),e.on("wall-destroy",this._wallDestroyListener=function(){t.hasWallAllFloor()||(t.hasWall=!1,t.unlock())})},select:function(){this.$editor.feature.tool.openSelector()},move:function(){this.$editor.feature.tool.openTransformer()},save:function(){var t=this;this.$editor.feature.document.save().then((function(){t.$root.$emit("save"),t.$bvToast.toast("保存成功",{autoHideDelay:2e3,noHoverPause:!0,toastClass:"custom-toast",variant:"default"})}))},autoSave:function(){var t=this;this._timeout=setTimeout((function(){t.$bvToast.toast("自动保存成功...",{autoHideDelay:2e3,noHoverPause:!0,toastClass:"custom-toast",variant:"default"}),t.autoSave()}),R)},closeAutoSave:function(){this._timeout&&clearTimeout(this._timeout)},retreat:function(){console.log("retreat")},advance:function(){console.log("advance")},hasWallAllFloor:function(){var t=this.$editor,e=t.feature.floor,n=t.solution.drawing.structure.getAllWallList(),i=e.getData().list.filter((function(t){return t.level!==e.current}));return n.length>0||i.find((function(t){return t.drawing.wallList.length>0}))},requestClear:function(){this.$bvModal.show("clear-modal")},clear:function(){this.$editor.feature.floor.clear(),this.$bvModal.hide("clear-modal"),this.hasWallAllFloor()||(this.hasWall=!1,this.unlock())},lock:function(t){var e=t?"底图已锁定，清空户型图后可解锁":"底图已锁定";this.locked=!0,this.$bvToast.toast(e,{autoHideDelay:2e3,noHoverPause:!0,toastClass:"custom-toast",variant:"default"}),this.$root.$emit("lock")},unlock:function(){this.locked=!1,this.$root.$emit("unlock")},showExitModal:function(){this.$bvModal.show("exit-modal")},exit:function(){var t=this;this.$editor.feature.document.save().then((function(){t.$bvModal.hide("exit-modal"),window.close()}))}}},N=E,P=(n("bb78"),n("0c7c")),A=Object(P["a"])(N,$,L,!1,null,null,null),F=A.exports,M=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"h-100 border-right d-flex",attrs:{id:"tool-bar-container"}},[n("b-button-toolbar",{staticClass:"flex-column border-right app-custom",staticStyle:{width:"68px","font-size":"12px"},attrs:{id:"app-toolgroup"}},t._l(t.toolList,(function(e,i){return n("b-button-group",{key:i,staticClass:"p-1"},[n("b-button",{staticClass:"d-flex flex-column align-items-center p-1 border-0",attrs:{pressed:e.id===t.active,variant:"outline-secondary",disabled:t.readonly},on:{click:function(n){return t.changeTool(e.id)}}},[n("b-img",{staticStyle:{width:"30px"},attrs:{src:e.id===t.active?e.active:e.img}}),n("span",{staticClass:"app-text-tiny mt-1"},[t._v(t._s(e.title))])],1)],1)})),1),n("div",{staticClass:"tool-bar-content"},[n("span",{staticClass:"content-button",on:{click:t.toggleConetnt}},[n("b-icon",{attrs:{icon:t.contentVisible?"chevron-left":"chevron-right"}})],1),n(t.activeTool,{tag:"component",staticClass:"content-component",class:{hidden:!t.contentVisible}})],1)],1)},B=[],z=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"d-flex flex-column",attrs:{id:"tool"}},[t._l(t.toolGroup,(function(e,i){return n("div",{key:e.title+i,staticClass:"px-2"},[n("div",{staticClass:"border-bottom px-2",staticStyle:{height:"30px","line-height":"30px"}},[t._v(t._s(e.title))]),n("div",{staticClass:"d-flex flex-wrap pt-2"},t._l(e.toolList,(function(e,i){return n("b-button",{key:e+i,staticClass:"tool-item",class:{"no-margin-right":(i+1)%3===0,"btn-active":t.toolGroupMap[e].id===t.activeToolGroup},attrs:{disabled:t.readonly},on:{click:function(n){return t.activeTool(e)}}},[n("span",{staticStyle:{width:"40px",height:"40px","line-height":"40px"}},[n("b-img",{staticClass:"w-100 h-100",attrs:{src:t.toolGroupMap[e].id===t.activeToolGroup&&t.toolGroupMap[e].active?t.toolGroupMap[e].active:t.toolGroupMap[e].img}})],1),n("span",{staticClass:"mt-2 app-text-tiny text-center"},[t._v(t._s(t.toolGroupMap[e].title))])])})),1)])})),t._l(t.windoorGroup,(function(e,i){return n("div",{key:e.title+i,staticClass:"px-2"},[n("div",{staticClass:"border-bottom px-2",staticStyle:{height:"30px","line-height":"30px"}},[t._v(t._s(e.title))]),n("div",{staticClass:"d-flex flex-wrap pt-3"},t._l(e.toolList,(function(e,i){return n("b-button",{key:e+i,staticClass:"tool-item",class:{"no-margin-right":(i+1)%3===0},attrs:{disabled:t.readonly},on:{click:function(n){return t.activeWindoor(e)}}},[n("span",{staticStyle:{width:"40px",height:"40px","line-height":"40px"}},[n("b-img",{staticClass:"w-100 h-100",attrs:{src:t.windoorMap[e].img}})],1),n("span",{staticClass:"mt-1 app-text-tiny text-center"},[t._v(t._s(t.windoorMap[e].title))])])})),1)])}))],2)},I=[],V="selector",U="transformer",G="builder",H="chamber",J="spliter",Y="labeler",K="viewport",X=(k={},Object(D["a"])(k,V,{id:V,title:"选择器",icon:"cursor",click:function(t){t.feature.tool.openSelector()}}),Object(D["a"])(k,U,{id:U,title:"变形器",icon:"arrows-move",click:function(t){t.feature.tool.openTransformer()}}),Object(D["a"])(k,G,{id:G,title:"画墙",img:"img/Wall.svg",active:"img/Wall_Active.svg",click:function(t){t.feature.tool.openBuilder()}}),Object(D["a"])(k,H,{id:H,title:"画房间",img:"img/Room.svg",active:"img/Room_Active.svg",click:function(t){t.feature.tool.openChamber()}}),Object(D["a"])(k,J,{id:J,title:"截断器",icon:"input-cursor",click:function(t){t.feature.tool.openSpliter()}}),Object(D["a"])(k,Y,{id:Y,title:"标注",icon:"tags",click:function(t){t.feature.tool.openLabeler()}}),Object(D["a"])(k,K,{id:K,title:"视口",icon:"search",click:function(t){t.feature.tool.openViewport()}}),k),q={singleDoor:{id:"singleDoor",title:"单开门",img:"img/SingleDoor.svg"},doubleDoor:{id:"doubleDoor",title:"双开门",img:"img/DoubleDoor.svg"},slidingDoor:{id:"slidingDoor",title:"推拉门",img:"img/SlidingDoor.svg"},basicWindow:{id:"basicWindow",title:"普通窗",img:"img/BasicWindow.svg"},boilerWindow:{id:"boilerWindow",title:"一字飘窗",img:"img/BoilerWindow.svg"},bealock:{id:"bealock",title:"垭口",img:"img/Bealock.svg"}},Q=[{title:"画墙",toolList:[G,H]}],Z=[{title:"门窗",toolList:["singleDoor","doubleDoor","slidingDoor","basicWindow","boilerWindow"]},{title:"其他构件",toolList:["bealock"]}],tt={name:"Tool",data:function(){return{activeToolGroup:null,toolGroup:Q,windoorGroup:Z,toolGroupMap:X,windoorMap:q,readonly:!1}},mounted:function(){var t=this;this.activeTool(V),this.$root.$on("readonly",(function(e){return t.readonly=e})),this.$editor.on("tool-open",this._toolOpenListener=function(e){t.activeToolGroup!==e&&(t.activeToolGroup=e,t.$root.$emit("toolGroupChange",e))})},destroyed:function(){this.$editor.off("open",this._toolOpenListener)},methods:{activeTool:function(t){X[t].click(this.$editor),this.activeToolGroup=t,this.$root.$emit("toolGroupChange",t)},activeWindoor:function(t){var e=this.$editor;e.feature.tool.openDefault();var n=e.solution.drawing.windoor.createMovingHollow();e.map.get(n).setResource(this.$spec.hollow.map[t].resource)}}},et=tt,nt=(n("6db6"),Object(P["a"])(et,z,I,!1,null,null,null)),it=nt.exports,ot=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"tool-bar-material"}},[n("b-tabs",{staticClass:"p-2",attrs:{pills:"","no-fade":"","nav-class":"material-tab-nav"}},t._l(t.materialGroup,(function(e,i){return n("b-tab",{key:i,attrs:{title:e.title,active:e.active}},t._l(e.dataList,(function(e,i){return n("div",{key:i},[n("div",{staticClass:"border-bottom px-2",staticStyle:{height:"30px","line-height":"30px"}},[t._v(t._s(e.title))]),n("div",{staticClass:"d-flex flex-wrap pt-3"},t._l(e.materialList,(function(e,i){return n("div",{key:i,staticClass:"d-flex flex-column align-items-center mb-2",staticStyle:{width:"50px"},on:{click:function(n){return t.create(t.materialMap[e].id)}}},[n("span",{staticStyle:{width:"40px",height:"40px",cursor:"pointer"}},[n("b-img",{staticClass:"h-100 w-100",attrs:{src:t.materialMap[e].img}})],1),n("span",{staticClass:"mt-1 app-text-tiny text-center"},[t._v(t._s(t.materialMap[e].title))])])})),0)])})),0)})),1)],1)},rt=[],at={0:{id:0,title:"单人床",img:"img/SingleDoor.png"},1:{id:1,title:"双人床",img:"img/SingleDoor.png"},2:{id:2,title:"组合床",img:"img/SingleDoor.png"},3:{id:3,title:"榻榻米",img:"img/SingleDoor.png"},4:{id:4,title:"单人沙发",img:"img/SingleDoor.png"},5:{id:5,title:"双人沙发",img:"img/SingleDoor.png"},6:{id:6,title:"多人沙发",img:"img/SingleDoor.png"},7:{id:7,title:"组合沙发",img:"img/SingleDoor.png"},8:{id:8,title:"转角沙发",img:"img/SingleDoor.png"},9:{id:9,title:"弧形沙发",img:"img/SingleDoor.png"},10:{id:10,title:"圆形餐桌",img:"img/SingleDoor.png"},11:{id:11,title:"方形餐桌",img:"img/SingleDoor.png"},12:{id:12,title:"长条形餐桌",img:"img/SingleDoor.png"},13:{id:13,title:"书桌",img:"img/SingleDoor.png"},14:{id:14,title:"梳妆台",img:"img/SingleDoor.png"},15:{id:15,title:"一字型橱柜",img:"img/SingleDoor.png"},16:{id:16,title:"L形橱柜",img:"img/SingleDoor.png"},17:{id:17,title:"U形橱柜",img:"img/SingleDoor.png"},18:{id:18,title:"浴缸",img:"img/SingleDoor.png"},19:{id:19,title:"淋浴房",img:"img/SingleDoor.png"},20:{id:20,title:"洗手台",img:"img/SingleDoor.png"},21:{id:21,title:"马桶",img:"img/SingleDoor.png"},22:{id:22,title:"洗衣机",img:"img/SingleDoor.png"},23:{id:23,title:"绿植",img:"img/SingleDoor.png"},24:{id:24,title:"地毯",img:"img/SingleDoor.png"},25:{id:25,title:"长方形楼梯",img:"img/SingleDoor.png"},26:{id:26,title:"L形楼梯",img:"img/SingleDoor.png"},27:{id:27,title:"U形楼梯",img:"img/SingleDoor.png"},28:{id:28,title:"圆形楼梯",img:"img/SingleDoor.png"},29:{id:29,title:"地板",img:"img/SingleDoor.png"},30:{id:30,title:"瓷砖",img:"img/SingleDoor.png"},31:{id:31,title:"地毯",img:"img/SingleDoor.png"}},st=[{title:"家具",dataList:[{title:"床",materialList:[0,1,2,3]},{title:"沙发",materialList:[4,5,6,7,8,9]},{title:"桌几",materialList:[10,11,12,13,14]}]},{title:"厨卫",dataList:[{title:"厨房",materialList:[15,16,17]},{title:"卫浴",materialList:[18,19,20,21,22]}]},{title:"家饰",dataList:[{title:"家饰",materialList:[23,24]}]},{title:"建筑",dataList:[{title:"楼梯",materialList:[25,26,27,28]},{title:"地板设计",materialList:[29,30,31]}]}],lt={name:"Material",data:function(){return{materialMap:at,materialGroup:st}},mounted:function(){console.log("material")},methods:{create:function(t){console.log(t)}}},ct=lt,ut=(n("9342"),Object(P["a"])(ct,ot,rt,!1,null,null,null)),pt=ut.exports,dt={tool:it,material:pt},ft={name:"ToolBarContainer",data:function(){return{toolList:[{id:"tool",title:"绘制工具",img:"img/DrawTool.svg",active:"img/DrawTool_Active.svg"}],active:"tool",activeTool:it,contentVisible:!0,readonly:!1}},mounted:function(){var t=this;this.$root.$on("readonly",(function(e){return t.readonly=e}))},methods:{changeTool:function(t){this.active=t,this.activeTool=dt[t],this.contentVisible||this.toggleConetnt()},toggleConetnt:function(){var t=this.$editor.solution.drawing;this.contentVisible=!this.contentVisible,t.setOrigin(t.origin[0]+(this.contentVisible?-200:200),t.origin[1]),this.$root.$emit("drawing-resize")}}},ht=ft,mt=(n("0085"),Object(P["a"])(ht,M,B,!1,null,null,null)),vt=mt.exports,bt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"position-absolute d-flex justify-content-center w-100",staticStyle:{top:"0",height:"0"}},[n(t.current,{tag:"component",staticClass:"border mt-1 position-absolute",staticStyle:{"background-color":"#FFF"}})],1)},gt=[],yt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"d-flex",attrs:{id:"builder-setting"}},[n("b-form-radio-group",{staticClass:"d-flex align-items-center pr-1 pl-3",attrs:{options:t.alignOptions},on:{change:t.setWallAlignment},model:{value:t.align,callback:function(e){t.align=e},expression:"align"}}),n("div",{staticClass:"position-relative"},[n("b-form-group",{staticClass:"my-1 px-2 border-left border-right",staticStyle:{width:"12em"},attrs:{"label-cols-sm":"3","content-cols-sm":"9",label:"墙厚","label-for":"wall-thinkness"}},[n("b-input-group",{attrs:{append:"mm"}},[n("b-form-input",{attrs:{id:"wall-thinkness",type:"number",autocomplete:"off"},on:{change:t.setWallThinkness,focus:function(){return t.thinknessDropdownShow=!0},blur:function(){return t.thinknessDropdownShow=!1}},model:{value:t.thinkness,callback:function(e){t.thinkness=t._n(e)},expression:"thinkness"}})],1)],1),n("b-list-group",{directives:[{name:"show",rawName:"v-show",value:t.thinknessDropdownShow,expression:"thinknessDropdownShow"}],staticClass:"input-dropdown"},t._l(t.thinknessList,(function(e,i){return n("b-list-group-item",{key:i,attrs:{button:""},on:{mousedown:function(n){return t.setWallThinkness(e)}}},[t._v(t._s(e))])})),1)],1),n("b-form-checkbox",{staticClass:"d-flex align-items-center mx-3",on:{change:t.setSnapState},model:{value:t.snapState,callback:function(e){t.snapState=e},expression:"snapState"}},[t._v("吸附")])],1)},wt=[],kt=(n("a9e3"),10),xt=1e3,Ot={name:"BuilderSetting",data:function(){return{thinkness:240,thinknessList:[100,120,180,200,240],thinknessDropdownShow:!1,align:"center",alignOptions:[{value:"center",text:"墙中线绘制"},{value:"right",text:"墙内线绘制"}],snapState:!0}},mounted:function(){this.setWallThinkness(this.thinkness),this.setWallAlignment(this.align),this.snapState=this.$editor.getState().snap},methods:{setWallThinkness:function(t){var e=Number(t);this.thinkness=e<kt?kt:e>xt?xt:e,this.$editor.solution.drawing.bricklayer.Builder.setThickness(this.thinkness)},setWallAlignment:function(t){this.$editor.solution.drawing.bricklayer.Builder.setAlignment(t)},setSnapState:function(t){this.$editor.setSnap(t)}}},St=Ot,Tt=(n("7b33"),Object(P["a"])(St,yt,wt,!1,null,null,null)),jt=Tt.exports,_t=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"d-flex",attrs:{id:"chamber-setting"}},[n("div",[n("b-form-group",{staticClass:"my-1 pr-2 pl-3 border-right",staticStyle:{width:"12em"},attrs:{"label-cols-sm":"3","content-cols-sm":"9",label:"墙厚","label-for":"wall-thinkness"}},[n("b-input-group",{attrs:{append:"mm"}},[n("b-form-input",{attrs:{id:"wall-thinkness",type:"number",autocomplete:"off"},on:{change:t.setWallThinkness,focus:function(){return t.thinknessDropdownShow=!0},blur:function(){return t.thinknessDropdownShow=!1}},model:{value:t.thinkness,callback:function(e){t.thinkness=t._n(e)},expression:"thinkness"}})],1)],1),n("b-list-group",{directives:[{name:"show",rawName:"v-show",value:t.thinknessDropdownShow,expression:"thinknessDropdownShow"}],staticClass:"input-dropdown"},t._l(t.thinknessList,(function(e,i){return n("b-list-group-item",{key:i,attrs:{button:""},on:{mousedown:function(n){return t.setWallThinkness(e)}}},[t._v(t._s(e))])})),1)],1),n("b-form-checkbox",{staticClass:"d-flex align-items-center mx-3",on:{change:t.setSnapState},model:{value:t.snapState,callback:function(e){t.snapState=e},expression:"snapState"}},[t._v("吸附")])],1)},Ct=[],$t=10,Lt=1e3,Dt={name:"ChamberSetting",data:function(){return{thinkness:240,thinknessList:[100,120,180,200,240],thinknessDropdownShow:!1,snapState:!0}},mounted:function(){this.setWallThinkness(this.thinkness),this.snapState=this.$editor.getState().snap},methods:{setWallThinkness:function(t){var e=Number(t);this.thinkness=e<$t?$t:e>Lt?Lt:e,this.$editor.solution.drawing.bricklayer.Chamber.setThickness(this.thinkness)},setSnapState:function(t){this.$editor.setSnap(t)}}},Wt=Dt,Rt=(n("698f"),Object(P["a"])(Wt,_t,Ct,!1,null,null,null)),Et=Rt.exports,Nt={builder:jt,chamber:Et},Pt={name:"ToolSetting",data:function(){return{current:null}},mounted:function(){var t=this;this.$root.$on("toolGroupChange",(function(e){t.current=Nt[e]}))}},At=Pt,Ft=Object(P["a"])(At,bt,gt,!1,null,null,null),Mt=Ft.exports,Bt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"border-left",attrs:{id:"property-container"}},[n("span",{staticClass:"property-button",on:{click:t.toggleConetnt}},[n("b-icon",{attrs:{icon:t.contentVisible?"chevron-right":"chevron-left"}})],1),n("div",{staticClass:"property-content",class:{hidden:!t.contentVisible}},[n("floor",{staticClass:"mb-3"}),n(t.activeTool,{tag:"component"})],1)])},zt=[],It=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"property-floor"}},[n("div",{staticClass:"border-bottom px-3",staticStyle:{height:"45px","line-height":"45px"}},[t._v("户型属性")]),n("div",{staticClass:"d-flex flex-column app-text-tiny px-3"},[n("div",{staticClass:"property-item"},[n("span",[t._v("底图旋转：")]),n("div",{staticClass:"position-relative"},[n("b-form-input",{staticClass:"spin-input spin-button-hidden",staticStyle:{width:"39px",left:"36px"},attrs:{type:"number",readonly:t.negativeLocked||t.readonly},on:{change:t.bitmapRotate},model:{value:t.property.bitmapRotation,callback:function(e){t.$set(t.property,"bitmapRotation",e)},expression:"property.bitmapRotation"}}),n("b-form-spinbutton",{staticClass:"mr-2",attrs:{inline:"",wrap:"",min:"0",max:"359",readonly:t.negativeLocked||t.readonly},on:{change:function(e){return t.rotationUpdate("bitmap",e)}},model:{value:t.spinNumber.bitmapRotation,callback:function(e){t.$set(t.spinNumber,"bitmapRotation",e)},expression:"spinNumber.bitmapRotation"}}),n("b-icon",{staticStyle:{cursor:"pointer"},attrs:{icon:"arrow-repeat","font-scale":"1.5"},on:{click:function(e){return t.bitmapRotate(0)}}})],1)]),n("div",{staticClass:"property-item"},[n("span",[t._v("指北针：")]),n("div",{staticClass:"position-relative"},[n("b-form-input",{staticClass:"position-absolute rounded-0 border-left-0 border-right-0 text-center spin-button-hidden",staticStyle:{width:"39px",left:"36px"},attrs:{type:"number",readonly:t.readonly},on:{change:t.compassRotate},model:{value:t.property.compassRotation,callback:function(e){t.$set(t.property,"compassRotation",e)},expression:"property.compassRotation"}}),n("b-form-spinbutton",{staticClass:"mr-2",attrs:{inline:"",wrap:"",min:"0",max:"359",readonly:t.readonly},on:{change:function(e){return t.rotationUpdate("compass",e)}},model:{value:t.spinNumber.compassRotation,callback:function(e){t.$set(t.spinNumber,"compassRotation",e)},expression:"spinNumber.compassRotation"}}),n("b-icon",{staticStyle:{cursor:"pointer"},attrs:{icon:"arrow-repeat","font-scale":"1.5"},on:{click:function(e){return t.compassRotate(0)}}})],1)]),n("div",{staticClass:"property-item"},[n("span",[t._v("楼层数量：")]),n("b-form-input",{staticStyle:{width:"137px"},attrs:{readonly:""},model:{value:t.property.length,callback:function(e){t.$set(t.property,"length",e)},expression:"property.length"}})],1),n("div",{staticClass:"property-item"},[n("span",[t._v("楼层选择：")]),n("b-form-select",{staticStyle:{width:"137px"},attrs:{options:t.floorOptions,disabled:t.readonly},on:{change:t.changeFloor},model:{value:t.selectedFloor,callback:function(e){t.selectedFloor=e},expression:"selectedFloor"}})],1),n("div",{staticClass:"property-item"},[n("span",[t._v("名称修改：")]),n("b-form-input",{staticStyle:{width:"137px"},attrs:{state:t.floorNameChangeState,readonly:t.readonly},on:{change:t.changeFloorName},model:{value:t.property.floorName,callback:function(e){t.$set(t.property,"floorName",e)},expression:"property.floorName"}})],1),n("div",{staticClass:"property-item"},[n("span",[t._v("户型面积（单层）：")]),n("div",{staticClass:"d-flex align-items-center"},[n("b-form-input",{staticClass:"mr-1",staticStyle:{width:"118px"},attrs:{readonly:""},model:{value:t.layerArea,callback:function(e){t.layerArea=e},expression:"layerArea"}}),n("span",[t._v("m²")])],1)])])])},Vt=[],Ut=(n("b680"),function(t){return(t/1e6).toFixed(2)}),Gt=function(t){return t/Math.PI/2*360},Ht=function(t){return t/360*2*Math.PI},Jt=function(t){return t<0?0:t>359?359:Number(t)},Yt={name:"FloorProperty",data:function(){return{floorOptions:[],property:{length:0,floorName:"",bitmapRotation:0,compassRotation:0},spinNumber:{bitmapRotation:0,compassRotation:0},selectedFloor:1,layerArea:0,floorNameChangeState:null,negativeLocked:!1,readonly:!1}},mounted:function(){var t=this,e=this.$editor;e.on("floor-set",this._floorSetListener=function(){t.updateFloorOptions(),t.updateProperty()}),e.on("area-change",this._areaListener=function(e){return t.layerArea=Ut(e)}),e.on("compass-change",this._compassListener=function(e){t.spinNumber.compassRotation=t.property.compassRotation=Number(Gt(e.rotation).toFixed())}),e.on("bitmap-create",this._bitmapListener=function(){return t.updateProperty()}),this.$root.$on("lock",(function(){return t.negativeLocked=!0})),this.$root.$on("unlock",(function(){return t.negativeLocked=!1})),this.$root.$on("readonly",(function(e){return t.readonly=e}))},destroyed:function(){var t=this.$editor;t.off("floor-set",this._floorSetListener),t.off("area-change",this._areaListener),t.off("compass-change",this._compassListener),t.off("bitmap-create",this._bitmapListener)},methods:{compassRotate:function(t){this.readonly||(this.property.compassRotation=Jt(t),this.$editor.solution.drawing.compass.setRotation(Ht(this.property.compassRotation)))},bitmapRotate:function(t){this.negativeLocked||this.readonly||this.$editor.negativeRotate(Ht(Jt(t)))},rotationUpdate:function(t,e){this.property["".concat(t,"Rotation")]=e,this["".concat(t,"Rotate")](e)},changeFloor:function(t){this.$editor.feature.floor.select(t),this.updateProperty(),this.selectedFloor=t},changeFloorName:function(){var t=this,e=this.property.floorName;e?(this.$editor.feature.floor.setFloorName(e),this.floorOptions.find((function(e){return e.level===t.selectedFloor})).text=e):(this.$editor.feature.floor.setFloorName(""),this.property.floorName="",this.updateFloorOptions()),this.floorNameChangeState=!0},updateProperty:function(){var t=this.$editor.solution.drawing,e=this.$editor.feature.floor,n=e.currentFloor,i=t.negative.getAllBitmapList();this.property.length=e.length,this.property.floorName=n?n.name:"",this.property.compassRotation=Gt(t.compass.rotation),this.property.bitmapRotation=i[0]?Gt(i[0].rotation):0,this.selectedFloor=e.current,this.floorNameChangeState=null},updateFloorOptions:function(){var t=this.$editor.feature.floor.getData();this.floorOptions=t.list.map((function(t){return{level:t.level,text:t.name||"".concat(t.level+1,"层"),value:t.level}}))}}},Kt=Yt,Xt=(n("4c00"),Object(P["a"])(Kt,It,Vt,!1,null,null,null)),qt=Xt.exports,Qt=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"property-room"}},[n("div",{staticClass:"border-bottom px-3",staticStyle:{height:"45px","line-height":"45px"}},[t._v("功能间信息")]),n("div",{staticClass:"app-text-tiny px-3"},[n("div",{staticClass:"property-item"},[n("span",[t._v("房间类型：")]),n("b-form-select",{staticStyle:{width:"137px"},attrs:{options:t.options},on:{change:t.changeRoomType},model:{value:t.property.type,callback:function(e){t.$set(t.property,"type",e)},expression:"property.type"}})],1),n("div",{staticClass:"property-item"},[n("span",[t._v("房间名称：")]),n("b-form-input",{staticStyle:{width:"137px"},on:{change:t.changeRoomName},model:{value:t.property.name,callback:function(e){t.$set(t.property,"name",e)},expression:"property.name"}})],1)])])},Zt=[],te=null,ee={name:"PropertyRoom",data:function(){return{property:{type:"",name:""}}},computed:{options:function(){var t=this.$spec.room.typeList.map((function(t){return{value:t,text:t}}));return t.unshift({value:"自定义",text:"自定义"}),t}},mounted:function(){this.init()},destroyed:function(){this.$editor.off("select",this._selectListener),this.$root.$off("room-property-change",this._changeListener)},methods:{init:function(){var t=this,e=this.$editor;te=e.getSelected()[0],this.updateProperty(te),e.on("select",this._selectListener=function(e){var n=e[0];n!==te&&n.constructor===te.constructor&&(te=n,t.updateProperty(n))}),this.$root.$on("room-property-change",this._changeListener=function(){return t.updateProperty(te)})},updateProperty:function(t){var e=t.type,n=t.name;Object.assign(this.property,{type:e||"自定义",name:n||""})},changeRoomType:function(){this.property.name=this.property.type,te.setType(this.property.type),te.setName(this.property.name),this.$root.$emit("room-property-change")},changeRoomName:function(){te.setName(this.property.name||"未命名"),this.$root.$emit("room-property-change")}}},ne=ee,ie=(n("783f"),Object(P["a"])(ne,Qt,Zt,!1,null,null,null)),oe=ie.exports,re=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"property-wall"}},[n("div",{staticClass:"border-bottom px-3",staticStyle:{height:"45px","line-height":"45px"}},[t._v("基础参数（墙体）")]),n("div",{staticClass:"app-text-small px-3"},[n("div",[n("div",{staticStyle:{height:"40px","line-height":"40px"}},[t._v("墙体类型：")]),n("b-form-radio-group",{staticClass:"wall-type-radio",attrs:{options:t.typeOptions,buttons:"","button-variant":"outline-secondary"},on:{change:t.setType},model:{value:t.property.type,callback:function(e){t.$set(t.property,"type",e)},expression:"property.type"}})],1),n("div",[n("div",{staticStyle:{height:"40px","line-height":"40px"}},[t._v("墙体参数：")]),n("div",{staticClass:"d-flex align-items-center"},[n("div",{staticClass:"app-text-tiny",staticStyle:{width:"50px"}},[t._v("厚度")]),n("b-form-input",{staticClass:"mx-2",attrs:{min:"10",max:"1000",type:"range"},on:{update:t.setThickness},model:{value:t.property.thickness,callback:function(e){t.$set(t.property,"thickness",e)},expression:"property.thickness"}}),n("b-form-input",{staticClass:"mr-1",staticStyle:{width:"60px"},attrs:{min:"10",max:"1000"},on:{change:t.setThickness},model:{value:t.property.thickness,callback:function(e){t.$set(t.property,"thickness",e)},expression:"property.thickness"}}),n("span",[t._v("mm")])],1)])])])},ae=[],se=null,le={name:"PropertyWall",data:function(){return{property:{thickness:0,type:""}}},computed:{typeOptions:function(){var t=this.$spec.wall,e=t.typeSymbol,n=t.typeMap;return Object.keys(e).map((function(t){return{value:e[t],text:n[e[t]].label}}))}},mounted:function(){this.init()},destroyed:function(){this.$editor.off("select",this._selectListener)},methods:{init:function(){var t=this,e=this.$editor;se=e.getSelected()[0],this.updateProperty(se),e.on("select",this._selectListener=function(e){var n=e[0];n!==se&&n.constructor===se.constructor&&(se=n,t.updateProperty(n))})},updateProperty:function(t){var e=t.thickness,n=t.type;Object.assign(this.property,{thickness:e.toFixed(),type:n||"common"})},setType:function(t){se.setResource(this.$spec.wall.typeMap[t].resource)},setThickness:function(t){isNaN(Number(t))?this.property.thickness=100:se.thickness=Number(t)}}},ce=le,ue=(n("687c"),Object(P["a"])(ce,re,ae,!1,null,null,null)),pe=ue.exports,de=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"property-hollow"}},[n("div",{staticClass:"border-bottom px-3",staticStyle:{height:"45px","line-height":"45px"}},[t._v(t._s("基础参数（"+t.typeName+"）"))]),n("div",{staticClass:"app-text-small px-3"},[n("div",{directives:[{name:"show",rawName:"v-show",value:t.hollowTypeOptions.length,expression:"hollowTypeOptions.length"}]},[n("div",{staticStyle:{height:"40px","line-height":"40px"}},[t._v(t._s(t.typeName+"类型："))]),n("b-form-radio-group",{staticClass:"type-radio",attrs:{options:t.hollowTypeOptions,buttons:"","button-variant":"outline-secondary"},on:{change:t.setType},model:{value:t.property.material,callback:function(e){t.$set(t.property,"material",e)},expression:"property.material"}})],1),n("div",[n("div",{staticStyle:{height:"40px","line-height":"40px"}},[t._v(t._s(t.typeName+"参数："))]),n("div",{staticClass:"d-flex align-items-center"},[n("div",{staticClass:"app-text-tiny",staticStyle:{width:"50px"}},[t._v("长度")]),n("b-form-input",{staticClass:"mx-2",attrs:{min:"100",max:t.maxWidth,type:"range"},on:{update:t.setWidth},model:{value:t.property.width,callback:function(e){t.$set(t.property,"width",e)},expression:"property.width"}}),n("b-form-input",{staticClass:"mr-1",staticStyle:{width:"60px"},attrs:{min:"100",max:"3000"},on:{change:t.setWidth},model:{value:t.property.width,callback:function(e){t.$set(t.property,"width",e)},expression:"property.width"}}),n("span",[t._v("mm")])],1)]),n("div",{staticClass:"py-3 d-flex flex-row-reverse"},[n("b-button",{attrs:{variant:"primary"},on:{click:t.setDefault}},[t._v("恢复默认")])],1)])])},fe=[],he=n("0bd7"),me=(n("99af"),n("caad"),n("2532"),Math),ve=(me.PI,[0,0,1,0]),be=function(t,e,n,i){return ve[0]=t,ve[1]=e,ve[2]=n,ve[3]=i,ve},ge=[0,0],ye=function(t,e){return ge[0]=t,ge[1]=e,ge},we=[0,0,0,0],ke=function(t,e,n,i){return we[0]=t,we[1]=e,we[2]=n,we[3]=i,we},xe=[0,0],Oe=function(t,e){return xe[0]=t,xe[1]=e,xe},Se=function(t,e,n,i){return Oe(t+n,e+i)},Te=function(t,e,n,i){return ye(n-t,i-e)},je=Te,_e=Te,Ce=function(t,e,n,i){return t*n+e*i},$e=function(t,e,n){return ye(t*n,e*n)},Le=function(t,e,n,i){return t*i-e*n},De=n("a326"),We=function(t,e){return De["b"].sqrt(Ce(t,e,t,e))},Re=function(t,e){return ye(-e,t)},Ee=function(t,e){var n=We(t,e);return 0===n&&De["a"].throwError("Zero Vector CAN NOT be normalized."),ye(t/n,e/n)},Ne=function(t,e){return ye(-t,-e)},Pe=function(t,e,n){var i=De["b"].cos(n),o=De["b"].sin(n);return ye(t*i-e*o,t*o+e*i)},Ae=function(t,e,n,i){var o=Ee(n,i);return $e.apply(void 0,Object(he["a"])(o).concat([Ce.apply(void 0,[t,e].concat(Object(he["a"])(o)))]))},Fe=1e-6,Me=function(t){return t<Fe&&t>-Fe},Be=function(t,e){var n=t-e;return n<Fe&&n>-Fe},ze=function(t,e){return t-e>Fe},Ie=function(t,e){return t-e<-Fe},Ve=function(t,e,n,i){return Be(t,n)&&Be(e,i)},Ue=function(t,e,n,i,r,a){return ze(Le.apply(o,Object(he["a"])(Te(n,i,r,a)).concat(Object(he["a"])(Te(r,a,t,e)))),0)},Ge=function(t,e,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=Te(i,r,t,e);return Se.apply(void 0,Object(he["a"])(Pe.apply(o,Object(he["a"])(a).concat([n]))).concat([i,r]))},He=function(t,e,n,i,r,a){if(rn(t,e,n,i))return Oe(t,e);var s=Te(t,e,n,i);return Me(Le.apply(o,Object(he["a"])(s).concat([r,a])))?Oe(n,i):Se.apply(void 0,[t,e].concat(Object(he["a"])(Ae.apply(o,Object(he["a"])(s).concat([r,a])))))},Je=function(t,e,n,i){return We.apply(o,Object(he["a"])(Te(t,e,n,i)))},Ye=function(t,e){for(var n=arguments.length,i=new Array(n>2?n-2:0),o=2;o<n;o++)i[o-2]=arguments[o];return Je.apply(void 0,[t,e].concat(Object(he["a"])(He.apply(void 0,[t,e].concat(i)))))},Ke=function(t,e,n,r){var a=je(t,e,n,r),s=Re.apply(o,Object(he["a"])(Ee.apply(o,Object(he["a"])(a)))),l=Ce.apply(o,Object(he["a"])(s).concat([t,e])),c=Ie(l,0)?s:Ne.apply(o,Object(he["a"])(s));return be.apply(i,[t,e].concat(Object(he["a"])(c)))},Xe=[0,0,0],qe=0,Qe=1,Ze=2,tn=function(t,e,n,i){return Xe[qe]=n,Xe[Qe]=i,Xe[Ze]=Ce(n,i,t,e),Xe},en=n("26a3"),nn=function(t,e,n,i,o,r,a,s){var l=tn(t,e,n,i),c=Object(en["a"])(l,3),u=c[0],p=c[1],d=c[2],f=tn(o,r,a,s),h=Object(en["a"])(f,3),m=h[0],v=h[1],b=h[2],g=u*v-p*m,y=d*v-p*b,w=u*b-d*m;return Me(g)?null:Me(p)?Oe(d/u,w/g):Me(v)?Oe(b/m,w/g):Me(u)?Oe(y/g,d/p):Me(m)?Oe(y/g,b/v):Oe(y/g,w/g)},on=function(t,e,n,i,o,r){return Ye.apply(void 0,[t,e].concat(Object(he["a"])(Ke(n,i,o,r))))},rn=function(t,e,n,i){return Be(t,n)&&Be(e,i)},an=n("2d58"),sn=n("ac84");var ln=n("0402"),cn=(n("aff5"),n("a434"),function(t,e,n,i){return o.length.apply(o,Object(he["a"])(o.fromBothPoint(t,e,n,i)))}),un=function(t,e,n){var i=t.corner,o=t.back.corner,s=a.project.apply(a,[e,n].concat(Object(he["a"])(r.fromSegment(i.x,i.y,o.x,o.y))));return cn.apply(void 0,[i.x,i.y].concat(Object(he["a"])(s)))},pn=null,dn={name:"PropertyHollow",data:function(){return{property:{material:"",width:0},hollowTypeOptions:[],typeName:"",maxWidth:0,aheadTrap:null,behindTrap:null}},mounted:function(){this.init()},destroyed:function(){this.$editor.off("select",this._selectListener)},methods:{init:function(){var t=this,e=this.$editor;pn=e.getSelected()[0],this.updateProperty(pn),e.on("select",this._selectListener=function(e){var n=e[0];n!==pn&&n.constructor===pn.constructor&&(pn=n,t.updateProperty(n))})},updateProperty:function(t){var e=this.$spec.hollow,n=e.map,i=e.typeMap,o=t.width,r=t.resource,a=Object.keys(n).find((function(t){return n[t].resource===r})),s=Object.keys(i).find((function(t){return i[t].list.includes(a)}));Object.assign(this.property,{width:o.toFixed(),material:a}),this.hollowTypeOptions=i[s].list.map((function(t){return{value:t,text:n[t].label}})),this.typeName=i[s].label,this.updateTrap(t)},updateTrap:function(t){var e=t.surface,n=t.offset;if("virtual"!==e.name){var i=this.$editor.solution.drawing,o=e.back,r=i.windoor.getAllHollowList(),a=r.filter((function(n){return n!==t&&n!==t.$proxy&&n.surface===e})),s=r.filter((function(e){return e!==t&&e!==t.$proxy&&e.surface===o})),l=[],c=cn(e.corner.x,e.corner.y,o.corner.x,o.corner.y);a.forEach((function(t){var e=t.width,n=t.offset;l.push([n-e/2,n+e/2])})),s.forEach((function(t){var e=t.width,n=t.offset;l.push([c-(n+e/2),c-(n-e/2)])})),l.push([0,o.wall===o.next.wall?0:un.apply(void 0,[e].concat(Object(he["a"])(e.origin)))]),l.push([e.wall===e.next.wall?c:c-un.apply(void 0,[o].concat(Object(he["a"])(o.origin))),c]);var u=null,p=null;l.forEach((function(t){t[0]>n&&(null===p||t[1]<p[0])&&(p=t),t[1]<n&&(null===u||t[0]>u[1])&&(u=t)})),this.maxWidth=(p[0]-u[1]).toFixed(),this.aheadTrap=u,this.behindTrap=p}else this.maxWidth=1e4},setType:function(t){pn.setResource(this.$spec.hollow.map[t].resource)},setWidth:function(t){var e=pn,n=e.offset,i=e.surface;if(isNaN(Number(t)))return this.property.width=100,void(pn.width=100);if("virtual"!==i.name){if(Number(t)>this.maxWidth)return this.property.width=this.maxWidth,void(pn.width=Number(this.maxWidth));var o=n-Number(t)/2,r=n+Number(t)/2;pn.width=Number(t),o<this.aheadTrap[1]&&(pn.offset=n+(this.aheadTrap[1]-o)),r>this.behindTrap[0]&&(pn.offset=n-(r-this.behindTrap[0]))}else pn.width=Number(t)},setDefault:function(){pn.setDefaultWidth()}}},fn=dn,hn=(n("14ac"),Object(P["a"])(fn,de,fe,!1,null,null,null)),mn=hn.exports,vn={name:"Property",components:{Floor:qt},data:function(){return{activeTool:null,contentVisible:!0}},mounted:function(){this.init()},destroyed:function(){var t=this.$editor;t.off("select",this._selectListener),t.off("select",this._unselectListener)},methods:{init:function(){var t=this,e=this.$editor,n={EditorWall:pe,EditorRoom:oe,EditorHollow:mn};e.on("select",this._selectListener=function(e){t.activeTool=n[e[0].className],t.contentVisible||t.toggleConetnt()}),e.on("unselect",this._unselectListener=function(){t.activeTool=null})},toggleConetnt:function(){this.contentVisible=!this.contentVisible,this.$root.$emit("drawing-resize")}}},bn=vn,gn=(n("f709"),Object(P["a"])(bn,Bt,zt,!1,null,null,null)),yn=gn.exports,wn=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"property-card"}},[n(t.activeCard,{tag:"component",staticClass:"card-component app-text-tiny"})],1)},kn=[],xn=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("span",{staticClass:"mr-2",staticStyle:{width:"25px"}},[t._v("类型")]),n("b-form-select",{staticClass:"mr-2",staticStyle:{width:"100px"},attrs:{options:t.options},on:{change:t.changeRoomType},model:{value:t.property.type,callback:function(e){t.$set(t.property,"type",e)},expression:"property.type"}}),n("b-form-input",{staticStyle:{width:"100px"},attrs:{placeholder:"房间名称"},on:{change:t.changeRoomName},model:{value:t.property.name,callback:function(e){t.$set(t.property,"name",e)},expression:"property.name"}})],1)},On=[],Sn=null,Tn={name:"PropertyCardRoom",data:function(){return{property:{type:"",name:""}}},computed:{options:function(){var t=this.$spec.room.typeList.map((function(t){return{value:t,text:t}}));return t.unshift({value:"自定义",text:"自定义"}),t}},mounted:function(){this.init()},destroyed:function(){this.$editor.off("select",this._selectListener),this.$root.$off("room-property-change",this._changeListener)},methods:{init:function(){var t=this,e=this.$editor;Sn=e.getSelected()[0],this.updateProperty(Sn),e.on("select",this._selectListener=function(e){var n=e[0];n!==Sn&&n.constructor===Sn.constructor&&(Sn=n,t.updateProperty(n))}),this.$root.$on("room-property-change",this._changeListener=function(){return t.updateProperty(Sn)})},updateProperty:function(t){var e=t.type,n=t.name;Object.assign(this.property,{type:e||"自定义",name:n||""})},changeRoomType:function(){this.property.name=this.property.type,Sn.setType(this.property.type),Sn.setName(this.property.name),this.$root.$emit("room-property-change")},changeRoomName:function(){Sn.setName(this.property.name||"未命名"),this.$root.$emit("room-property-change")}}},jn=Tn,_n=Object(P["a"])(jn,xn,On,!1,null,null,null),Cn=_n.exports,$n=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",t._l(t.toolList,(function(e){return n("b-button",{key:e,attrs:{variant:"outline-secondary",title:t.toolMap[e].label},on:{click:t.buttonMethods[e]}},[n("span",{staticStyle:{height:"25px","line-height":"25px"}},[n("b-img",{staticClass:"w-100",attrs:{src:t.toolMap[e].image.base}})],1)])})),1)},Ln=[],Dn=(n("ac1f"),n("1276"),null),Wn={name:"PropertyCardWall",computed:{toolMap:function(){return this.$spec.wall.toolMap},toolList:function(){var t=this.$spec.wall.toolSymbol;return[t.split,t.delete]},buttonMethods:function(){var t,e=this,n=this.$spec.wall.toolSymbol;return t={},Object(D["a"])(t,n.split,(function(){return e.split()})),Object(D["a"])(t,n.delete,(function(){return e.delete()})),t}},mounted:function(){this.init()},destroyed:function(){this.$editor.off("select",this._selectListener)},methods:{init:function(){var t=this.$editor;Dn=t.getSelected()[0],t.on("select",this._selectListener=function(t){var e=t[0];e!==Dn&&e.constructor===Dn.constructor&&(Dn=e)})},split:function(){Dn.split()},delete:function(){this.$editor.delete()}}},Rn=Wn,En=Object(P["a"])(Rn,$n,Ln,!1,null,null,null),Nn=En.exports,Pn=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",t._l(t.toolList,(function(e){return n("b-button",{directives:[{name:"show",rawName:"v-show",value:t.shownMap[e],expression:"shownMap[symbol]"}],key:e,attrs:{variant:"outline-secondary",title:t.toolMap[e].label},on:{click:t.buttonMethods[e]}},[n("span",{staticStyle:{height:"25px","line-height":"25px"}},[n("b-img",{staticClass:"w-100",attrs:{src:t.toolMap[e].image.base}})],1)])})),1)},An=[],Fn=null,Mn={name:"PropertyCardWall",data:function(){return{entranceShow:!0}},computed:{toolMap:function(){return this.$spec.hollow.toolMap},toolList:function(){var t=this.$spec.hollow.toolSymbol;return[t.entrance,t.flipWall,t.flip,t.delete]},shownMap:function(){var t=this.$spec.hollow.toolSymbol,e={};return Object.keys(t).forEach((function(t){return e[t]=!0})),Object(W["a"])(Object(W["a"])({},e),{},Object(D["a"])({},t.entrance,this.entranceShow))},buttonMethods:function(){var t,e=this,n=this.$spec.hollow.toolSymbol;return t={},Object(D["a"])(t,n.entrance,(function(){return e.setEntrance()})),Object(D["a"])(t,n.flipWall,(function(){return e.changeSurface()})),Object(D["a"])(t,n.flip,(function(){return e.flip()})),Object(D["a"])(t,n.delete,(function(){return e.delete()})),t}},mounted:function(){this.init()},destroyed:function(){this.$editor.off("select",this._selectListener)},methods:{init:function(){var t=this,e=this.$editor;Fn=e.getSelected()[0],this.updateToolList(Fn),e.on("select",this._selectListener=function(e){var n=e[0];n!==Fn&&n.constructor===Fn.constructor&&(Fn=n,t.updateToolList(n))})},getEntranceShow:function(){return this.entranceShow},updateToolList:function(t){var e=t.resource,n=this.$spec.hollow,i=n.typeSymbol,o=n.typeMap,r=n.map,a=Object.keys(r).find((function(t){return r[t].resource===e}));this.entranceShow=o[i.door].list.includes(a)},setEntrance:function(){Fn.setEntrance()},changeSurface:function(){Fn.changeSurface()},flip:function(){Fn.flip()},delete:function(){Fn.arrow&&Fn.arrow.remove(),this.$editor.delete()}}},Bn=Mn,zn=Object(P["a"])(Bn,Pn,An,!1,null,null,null),In=zn.exports,Vn={name:"PropertyCard",data:function(){return{activeCard:null,position:[0,0]}},mounted:function(){this.init()},destroyed:function(){var t=this.$editor;t.off("select",this._selectListener),t.off("unselect",this._unselectListener),document.removeEventListener("mousemove",this._moveListener)},methods:{init:function(){var t=this,e=this.$editor,n=document.getElementById("property-card"),i={EditorWall:Nn,EditorRoom:Cn,EditorHollow:In};e.on("select",this._selectListener=function(e){t.activeCard=i[e[0].className],n.style.left="".concat(t.position[0]+30,"px"),n.style.top="".concat(t.position[1]-70,"px")}),e.on("unselect",this._unselectListener=function(){t.activeCard=null}),document.addEventListener("mousemove",this._moveListener=function(e){t.position[0]=e.layerX,t.position[1]=e.layerY})}}},Un=Vn,Gn=(n("507d"),Object(P["a"])(Un,wn,kn,!1,null,null,null)),Hn=Gn.exports,Jn=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"px-4",attrs:{id:"viewport"}},[n("div",{staticClass:"mr-4",staticStyle:{width:"40px",cursor:"pointer"},on:{click:t.negativeBackToCenter}},[n("b-img",{staticClass:"h-100 w-100",attrs:{src:"img/ViewReset.svg"}})],1),n("span",{staticStyle:{width:"25px",height:"30px","line-height":"25px",cursor:"pointer"},on:{click:t.zoomOut}},[n("b-img",{staticClass:"w-100 h-100",attrs:{src:"img/Dash.svg"}})],1),n("b-form-input",{staticClass:"mx-2",attrs:{type:"range",min:"1",max:"100",disabled:t.readonly},on:{update:t.changeScale},model:{value:t.inputScale,callback:function(e){t.inputScale=e},expression:"inputScale"}}),n("span",{staticStyle:{width:"25px",height:"30px","line-height":"25px",cursor:"pointer"},on:{click:t.zoomIn}},[n("b-img",{staticClass:"w-100 h-100",attrs:{src:"img/Plus.svg"}})],1)],1)},Yn=[],Kn=1,Xn=200,qn={name:"Viewport",data:function(){return{inputScale:0,inputScaleClone:0,readonly:!1}},computed:{scale:function(){return 100-this.inputScale}},mounted:function(){var t=this,e=this.$editor.solution.drawing;this.inputScale=100-e.scale,this._interval=setInterval((function(){t.inputScaleClone=100-e.scale,t.inputScaleClone!==t.inputScale&&(t.inputScale=t.inputScaleClone)}),Xn),this.$root.$on("readonly",(function(e){return t.readonly=e}))},destroyed:function(){clearInterval(this._interval)},methods:{negativeBackToCenter:function(){this.readonly||this.$editor.feature.drawing.negativeBackToCenter()},changeScale:function(){this.$editor.solution.drawing.setScale(this.scale)},zoomOut:function(){1==this.inputScale||this.readonly||(this.inputScale=Number(this.inputScale)-Kn,this.$editor.solution.drawing.setScale(this.scale))},zoomIn:function(){100==this.inputScale||this.readonly||(this.inputScale=Number(this.inputScale)+Kn,this.$editor.solution.drawing.setScale(this.scale))}}},Qn=qn,Zn=(n("95f6"),Object(P["a"])(Qn,Jn,Yn,!1,null,null,null)),ti=Zn.exports,ei=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"visible"}},[n("b-dropdown",{attrs:{"no-caret":"",dropup:"",size:"sm",variant:"link",disabled:t.readonly},scopedSlots:t._u([{key:"button-content",fn:function(){return[n("b-img",{attrs:{src:"img/Eye.svg"}})]},proxy:!0}])},[n("b-dropdown-group",{attrs:{header:"勾选隐藏项","header-classes":"visible-dropdown-header"}},[n("b-dropdown-form",{staticClass:"visible-dropdown-form"},[n("b-form-checkbox",{on:{change:t.changeRoomNameVisible},model:{value:t.visible.roomName,callback:function(e){t.$set(t.visible,"roomName",e)},expression:"visible.roomName"}},[t._v("房间名")]),n("b-form-checkbox",{on:{change:t.changeRoomAreaVisible},model:{value:t.visible.roomArea,callback:function(e){t.$set(t.visible,"roomArea",e)},expression:"visible.roomArea"}},[t._v("面积")]),n("b-form-checkbox",{on:{change:t.changeSizeVisible},model:{value:t.visible.size,callback:function(e){t.$set(t.visible,"size",e)},expression:"visible.size"}},[t._v("尺寸标注")])],1)],1)],1)],1)},ni=[],ii={name:"Visible",data:function(){return{visible:{roomName:!1,roomArea:!1,size:!1},readonly:!1}},mounted:function(){var t=this;this.$editor.setRoomAreaShow(!0),this.$root.$on("readonly",(function(e){return t.readonly=e}))},methods:{changeRoomNameVisible:function(t){this.$editor.setRoomNameShow(!t)},changeRoomAreaVisible:function(t){this.$editor.setRoomAreaShow(!t)},changeSizeVisible:function(t){this.$editor.setDimensionShow(!t)}}},oi=ii,ri=(n("40e4"),Object(P["a"])(oi,ei,ni,!1,null,null,null)),ai=ri.exports,si=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{directives:[{name:"show",rawName:"v-show",value:t.visiable,expression:"visiable"}],attrs:{id:"check"}},[n("b-card",{directives:[{name:"show",rawName:"v-show",value:t.modalVisiable,expression:"modalVisiable"}],staticStyle:{width:"330px"},attrs:{"no-body":"","header-class":"p-2"},scopedSlots:t._u([{key:"header",fn:function(){return[n("div",{staticClass:"d-flex justify-content-between"},[n("div",[t._v("智能检测结果")]),n("b-button",{staticClass:"p-0 border-0",attrs:{variant:"outline-secondary"},on:{click:t.toggleVisiable}},[n("b-icon",{attrs:{icon:"chevron-down"}})],1)],1)]},proxy:!0}])},[n("div",{staticClass:"d-flex align-items-center py-3 mb-3",staticStyle:{"border-bottom":"1px dotted #CCCCCC"}},[n("div",{staticClass:"sign-warning app-text-tiny"},[t._v("警告")]),n("div",{staticStyle:{width:"210px"}},[n("div",{staticClass:"app-text-small font-weight-bold"},[t._v("未设置入户门")]),n("div",{staticClass:"app-text-tiny"},[t._v("请设置一个入户门，设置为入户门，多楼层注意选择正确的入户门")])]),n("b-button",{staticClass:"app-text-tiny ml-1",attrs:{variant:"outline-secondary"},on:{click:t.save}},[t._v("忽略")])],1)]),n("b-button",{directives:[{name:"show",rawName:"v-show",value:!t.modalVisiable&&!t.hasEntrance,expression:"!modalVisiable && !hasEntrance"}],staticClass:"p-0 border-0",attrs:{variant:"outline-secondary"},on:{click:t.toggleVisiable}},[n("b-img",{attrs:{src:"img/Duty.svg"}})],1),n("b-img",{directives:[{name:"show",rawName:"v-show",value:t.hasEntrance,expression:"hasEntrance"}],attrs:{src:"img/Signs.svg"}})],1)},li=[],ci={data:function(){return{visiable:!1,hasEntrance:!1,modalVisiable:!1}},mounted:function(){this.init()},destroyed:function(){this.$editor.off("entrance",this._listener)},methods:{init:function(){var t=this;this.$editor.on("entrance",this._listener=function(e){t.hasEntrance=e,e&&(t.modalVisiable=!1)}),this.$root.$on("save",(function(){t.hasEntrance||(t.visiable=!0,t.modalVisiable=!0)}))},toggleVisiable:function(){this.modalVisiable=!this.modalVisiable},save:function(){this.$editor.feature.document.save()}}},ui=ci,pi=(n("78a9"),Object(P["a"])(ui,si,li,!1,null,null,null)),di=pi.exports,fi=6e4,hi={name:"",components:{AppMenu:F,AppToolBar:vt,AppToolSetting:Mt,AppProperty:yn,AppPropertyCard:Hn,appViewport:ti,appVisible:ai,appCheck:di},mounted:function(){var t=this.$editor.solution.drawing;t.mount(this.$refs.drawing),this.$editor.feature.drawing.originBackToCenter(),setInterval((function(){}),fi),t.options.style.backgroundColor=16711422,t.structure.options.corner.style.hover.color=4235007,t.structure.options.wall.style.color=8355711,t.structure.options.wall.midline.show=!1,t.grid.options.rectangular.style.lineWidth=.5,t.compass.element.setNorthPointColor(4235007),t.compass.element.setSouthPointColor(14540253),this.$root.$on("drawing-resize",(function(){t.resize()}))},methods:{useTransformerFromSelector:function(){var t=this.$editor.solution,e=t.tool,n=t.drawing;e.activated===e.symbol.SELECTOR&&(e.openTransformer(),n.focusing instanceof this.$editor.Element.Hollow&&n.hammer.adjuster.pick())},checkEditState:function(){var t=this,e=this.$editor;this.$e100.getEditState().then((function(n){n?(e.feature.tool.closeAll(),e.solution.drawing.compass.lock()):e.solution.drawing.compass.unlock(),t.$root.$emit("readonly",n)}))}}},mi=hi,vi=Object(P["a"])(mi,_,C,!1,null,null,null),bi=vi.exports,gi=n("c20e"),yi=n("a007"),wi=n("e3fc"),ki=(n("dca8"),n("3ca3"),n("10d1"),n("ddb0"),n("7d94")),xi=function(t){Object(yi["a"])(n,t);var e=Object(wi["a"])(n);function n(){return Object(sn["a"])(this,n),e.apply(this,arguments)}return Object(an["a"])(n)}(ki["a"].Emitter),Oi=function(t){return t/1e3},Si=function(){function t(){Object(sn["a"])(this,t),this.width=0,this.height=0,this.center=[0,0],this.worldOrigin=[0,0],this.referenceY=0,this.rotation=0}return Object(an["a"])(t,[{key:"bitmapUvOrigin",get:function(){var t=this.width,e=this.height,n=this.center,i=Object(en["a"])(n,2),o=i[0],r=i[1];return[o-t/2,r-e/2]}},{key:"worldOriginGeometry",get:function(){return this.bitmapUvToGeometry.apply(this,Object(he["a"])(this.worldOrigin))}},{key:"setWidth",value:function(t){this.width=t}},{key:"setHeight",value:function(t){this.height=t}},{key:"setRotation",value:function(t){this.rotation=t}},{key:"setReferenceY",value:function(t){this.referenceY=t}},{key:"setCenter",value:function(t,e){this.center=[t,e]}},{key:"setWorldOrigin",value:function(t,e){this.worldOrigin=[t,e]}},{key:"bitmapUvToGeometry",value:function(t,e){var n=this.width,i=this.height,o=this.rotation,r=this.center,s=this.bitmapUvOrigin,l=Object(en["a"])(r,2),c=l[0],u=l[1],p=Object(en["a"])(s,2),d=p[0],f=p[1];return Object(he["a"])(a.rotate(d+n*t,f+i*e,-o,c,u))}},{key:"bitmapUvTo3D",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.referenceY,i=Object(en["a"])(this.worldOriginGeometry,2),o=i[0],r=i[1],a=this.bitmapUvToGeometry(t,e),s=Object(en["a"])(a,2),l=s[0],c=s[1];return[Oi(l-o),n,Oi(r-c)]}},{key:"geometryTo3D",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.referenceY,i=Object(en["a"])(this.worldOriginGeometry,2),o=i[0],r=i[1];return[Oi(t-o),n,Oi(r-e)]}},{key:"geometryToCaptureUv",value:function(t,e,n,i,o,r){return[(o-n)/t,(r-i)/e]}},{key:"bitmapUvToCaptureUv",value:function(t,e,n,i,o,r){var a=this.bitmapUvToGeometry(o,r),s=Object(en["a"])(a,2),l=s[0],c=s[1];return[(l-n)/t,(c-i)/e]}}]),t}(),Ti=new Si;function ji(){return{name:"untitled",floor:{base:0,list:[]}}}var _i,Ci,$i,Li,Di,Wi,Ri=function(t){var e=t.editor,n=t.accessor,i={name:""};function o(){var t=ji();return t.floor=e.feature.floor.getData(),t.name=i.name,t}function r(t){i.name=t.name,e.feature.floor.setData(t.floor)}return{get name(){return i.name},open:function(){return Object(O["a"])(Object(x["a"])().mark((function t(){var i,o,a;return Object(x["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,n.open();case 2:i=t.sent,o=i.drawing,a=i.model,r(o),e.data.model=a,e.emit("opened");case 8:case"end":return t.stop()}}),t)})))()},save:function(){var t=arguments;return Object(O["a"])(Object(x["a"])().mark((function i(){var r,a,s,l,c,u;return Object(x["a"])().wrap((function(i){while(1)switch(i.prev=i.next){case 0:return r=!(t.length>0&&void 0!==t[0])||t[0],r&&e.feature.floor.updateFloorData(),a=o(),s=new FormData,l=e.data.model,c=[],i.next=8,e.feature.screenshoter.screenshot();case 8:return u=i.sent,a.floor.list.forEach((function(t,e){var n={},i=t.level,o=l.find((function(t){return t.info.flooridx===i})),r=o.info,a=o.locations,p=r.width,d=r.height,f=r.ratio,h=r.floor_height,m=r.center_point_coordinates,v=u[e];if(Ti.setWidth(p/f),Ti.setHeight(d/f),Ti.setRotation(t.bitmap.rotation),Ti.setCenter.apply(Ti,Object(he["a"])(t.bitmap.position)),Ti.setReferenceY(h),Ti.setWorldOrigin(m.u,m.v),!v)return n.locations=[],void c.push(n);var b=new Blob([v.base64.split(",")[1]],{type:"image/png"});s.append("screenshot",b,"screenshot_".concat(i,".png")),n.locations=a.map((function(t){var e=t.locationid,n=t.uv,i=t.viewpoint,o=Ti.bitmapUvToCaptureUv(v.width,v.height,v.x,v.y-v.height,n.u,n.v),r=Object(en["a"])(o,2),a=r[0],s=r[1];return{locationid:e,viewpoint:i,uv:{u:a,v:s}}})),c.push(n)})),s.append("drawing",JSON.stringify(a)),s.append("map",JSON.stringify(c)),i.next=14,n.save(s);case 14:case"end":return i.stop()}}),i)})))()}}},Ei=(n("8ba4"),n("4e82"),n("fb6a"),function(t){if(!Number.isInteger(t))throw new TypeError("Invalid base, an integer expected.")}),Ni=function(t){if(Ei(t.base),!Array.isArray(t.list))throw new TypeError("Invalid lsit, an Array expected.")},Pi=function(t){var e=t.editor,n=null,i={base:null,list:[]},o=function(t){if(!i.list.some((function(e){return e.level===t})))throw new Error("Can NOT found a floor level=".concat(t))},r=function(){i.base=null,i.list=[]},a=function(t){return i.list.find((function(e){return e.level===t}))},s={get length(){return i.list.length},get base(){return i.base},get current(){return n},set current(t){n=t},get currentFloor(){return a(n)},select:function(t){if(Ei(t),o(t),null!==n){var i=a(n);Object.assign(i,e.serialize())}n=t,this.clear(!0),e.deserialize(a(t))},getData:function(){return i},setData:function(t){Ni(t),r(),t.list.slice(0).sort((function(t,e){return t.level-e.level})).forEach((function(t){return i.list.push(t)})),i.base=t.base,s.select(t.base),e.emit("floor-set")},setFloorName:function(t){a(n).name=t},clear:function(t){var n=e.solution.drawing,i=n.structure.getAllCornerList(),o=n.windoor.getAllHollowList(),r=n.entrance.getAllArrowList(),a=n.negative.getAllBitmapList();e.feature.tool.openDefault();try{o.forEach((function(t){return t.remove()})),i.forEach((function(t){return t.remove()})),r.forEach((function(t){return t.remove()})),t&&a.forEach((function(t){return t.remove()}))}catch(s){console.log(s),this.save()}},updateFloorData:function(){null!==n&&Object.assign(a(n),e.serialize())}};return s},Ai=function(t){var e=t.editor,n=e.solution.tool,i={get activated(){return n.activated},get symbol(){return n.symbol},openDefault:function(){n.openDefault(),e.solution.drawing.common.selector.drop()},openSelector:function(){n.openSelector()},openTransformer:function(){n.openTransformer()},openBuilder:function(){n.openWallBuilder()},openChamber:function(){n.openChamber()},closeAll:function(){n.closeAllTool()}};return i},Fi=function(){function t(e,n){Object(sn["a"])(this,t),this.wall=e,this.editor=n,this.className="EditorWall",this.resource=1}return Object(an["a"])(t,[{key:"thisSurface",get:function(){return this.wall.thisSurface}},{key:"thatSurface",get:function(){return this.wall.thatSurface}},{key:"thickness",get:function(){return this.wall.thickness},set:function(t){this.wall.thickness=t}},{key:"color",set:function(t){this.wall.color=t}},{key:"setResource",value:function(t){this.resource=t,this.editor.feature.resource.get(t).apply(this.wall)}},{key:"split",value:function(){var t=this.editor.solution.drawing,e=this.wall,n=e.thisCorner,i=e.thatCorner,o=e.thickness,r=t.structure.createCorner((n.x+i.x)/2,(n.y+i.y)/2);t.common.selector.drop(),this.wall.removeSimple();var a=this.editor.map.get(t.structure.createWall(n,r)),s=this.editor.map.get(t.structure.createWall(r,i));a.thickness=o,s.thickness=o,a.setResource(this.resource),s.setResource(this.resource)}}]),t}(),Mi=function(t){return(t/1e6).toFixed(2)},Bi=function(t,e,n,i,o,r){return((n-t)*(r-e)-(o-t)*(i-e))/2},zi=function(t){if(!(t.length<3)){for(var e=t[0],n=0,i=0,o=0,r=t[1],a=2;a<t.length;a++){var s=t[a],l=Bi.apply(void 0,Object(he["a"])(e).concat(Object(he["a"])(r),Object(he["a"])(s)));o+=l,n+=(e[0]+r[0]+s[0])*l,i+=(e[1]+r[1]+s[1])*l,r=s}return[n/o/3,i/o/3]}},Ii=function(){function t(e,n){Object(sn["a"])(this,t),this.room=e,this.editor=n,this.className="EditorRoom",this.type="",this.name="",this.labelPosition=null}return Object(an["a"])(t,[{key:"area",get:function(){return this.room.area}},{key:"label",get:function(){var t=this;return this.editor.solution.drawing.label.getAllLabelTextList().find((function(e){return e.room===t.room}))||null}},{key:"setType",value:function(t){this.type=t}},{key:"setName",value:function(t){if(this.name=t,this.label){var e="";this.editor.state.roomNameShow&&(e+=t),this.editor.state.roomAreaShow&&(e+="".concat(e.length>0?"\n":"","约").concat(Mi(this.area),"m²")),this.label.setText(e)}}},{key:"getLabelPosition",value:function(){return Object(he["a"])(this.labelPosition)}},{key:"setLabelPosition",value:function(t,e){this.labelPosition=[t,e],this.label&&this.label.setPosition(t,e)}},{key:"updateLabelPosition",value:function(){var t=this.room.getOuterSurfaceList().map((function(t){return[t.corner.x,t.corner.y]}));this.setLabelPosition.apply(this,Object(he["a"])(zi(t)))}},{key:"updateLabelText",value:function(){this.setName(this.name)}}]),t}(),Vi=function(t,e){var n=t.x-e.x,i=t.y-e.y;return Math.pow(n*n+i*i,.5)},Ui=function(){function t(e,n){Object(sn["a"])(this,t),this.hollow=e,this.editor=n,this.className="EditorHollow",this.resource=100}return Object(an["a"])(t,[{key:"width",get:function(){return this.hollow.width},set:function(t){this.hollow.setWidth(t)}},{key:"materialName",get:function(){return this.hollow.materialName}},{key:"surface",get:function(){return this.hollow.surface}},{key:"offset",get:function(){return this.hollow.offset},set:function(t){this.hollow.setOffset(t)}},{key:"arrow",get:function(){var t=this,e=this.editor.solution.drawing.entrance.getAllArrowList().find((function(e){return e.hollow===t.hollow}));return e||null}},{key:"setResource",value:function(t){this.resource=t,this.editor.feature.resource.get(t).apply(this.hollow)}},{key:"setDefaultWidth",value:function(){this.hollow.setWidth(this.hollow.defaultWidth)}},{key:"flip",value:function(){this.hollow.flip()}},{key:"setEntrance",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],e=this.editor.solution.drawing,n=e.entrance.getAllArrowList();if(this.arrow)return this.arrow.remove(),void this.editor.emit("entrance",!1);n.forEach((function(t){return t.remove()})),this.editor.feature.floor.getData().list.forEach((function(t){var e=t.hollowList;e&&e.length&&e.forEach((function(t){return t.entrance=null}))}));var i=e.entrance.createArrow(this.hollow);t&&i.flip(),this.editor.emit("entrance",!0)}},{key:"changeSurface",value:function(){var t=Vi(this.surface.corner,this.surface.back.corner)-this.offset;this.hollow.setSurface(this.surface.back),this.hollow.setOffset(t)}}]),t}(),Gi=function(t){var e,n,i,o,r=t.editor,a=t.Element,s=t.Tool,l=r.solution.drawing,c=l.bricklayer.Builder,u=l.bricklayer.Chamber,p=!1,d=(e={},Object(D["a"])(e,s.Bricklayer.Builder.PICKUP_FROM,(function(t){0===t&&c.pick()})),Object(D["a"])(e,s.Bricklayer.Builder.PICKUP_TO,(function(t){0===t&&c.build().pick().pick()})),e),f=(n={},Object(D["a"])(n,s.Bricklayer.Builder.PICKUP_FROM,(function(t){2!==t||p||r.feature.tool.openDefault()})),Object(D["a"])(n,s.Bricklayer.Builder.PICKUP_TO,(function(t){2!==t||p||c.drop()})),n),h=(i={},Object(D["a"])(i,s.Bricklayer.Chamber.PICKUP_FROM,(function(t){0===t&&u.pick()})),Object(D["a"])(i,s.Bricklayer.Chamber.PICKUP_TO,(function(t){0===t&&u.build().pick()})),i),m=(o={},Object(D["a"])(o,s.Bricklayer.Chamber.PICKUP_FROM,(function(t){2!==t||p||r.feature.tool.openDefault()})),Object(D["a"])(o,s.Bricklayer.Chamber.PICKUP_TO,(function(t){2!==t||p||u.drop()})),o),v=function(t){0===t&&l.common.selectorAction(l.focusing)},b=function(t){if(2!==t||p||r.feature.tool.openDefault(),0===t){var e=l.focusing;l.common.transformerAction(e),e instanceof a.Hollow?l.hammer.adjuster.pick():l.hammer.adjuster.drop(),e instanceof a.LabelText?l.label.LabelTransformer.pick():l.label.LabelTransformer.drop()}};l.on("pointerdown",(function(t){if(2===t.button){var e=function(){return p=!0},n=function t(){l.off("pointermove",e),window.removeEventListener("mouseup",t)};p=!1,l.on("pointermove",e),window.addEventListener("mouseup",n)}c.$state!==s.Ready&&d[c.$state](t.button),u.$state!==s.Ready&&h[u.$state](t.button)})),l.on("pointerup",(function(t){r.feature.tool.activated===r.feature.tool.symbol.SELECTOR&&v(t.button),r.feature.tool.activated===r.feature.tool.symbol.TRANSFORMER&&b(t.button),u.$state!==s.Ready&&m[u.$state](t.button),c.$state!==s.Ready&&f[c.$state](t.button)}));var g=function(){var t=l.structure.getAllRoomList();return t.length?t.map((function(t){return t.area})).reduce((function(t,e){return t+e})):0},y=function(t){r.map.set(t,new Fi(t,r)),t.on("destroy",(function(){r.map.delete(t),setTimeout((function(){var t,e=Object(ln["a"])(l.structure.rooms());try{for(e.s();!(t=e.n()).done;){var n=t.value;r.map.get(n).updateLabelPosition(),r.map.get(n).updateLabelText()}}catch(i){e.e(i)}finally{e.f()}r.emit("area-change",g())}))}))},w=function(t){var e=new Ii(t,r);r.map.set(t,e),setTimeout((function(){var n="未命名",i=l.label.createLabelText();i.setRoom(t),e.setName(n),e.updateLabelPosition(),r.emit("area-change",g()),t.on("destroy",(function(){i.remove(),r.map.delete(t)})),c.$state===s.Bricklayer.Builder.PICKUP_TO&&1!==c.from.size&&c.drop()}))},k=function(t){r.map.has(t)||r.map.set(t,new Ui(t,r)),t.on("destory",(function(){return r.map.delete(t)}))},x=function(t){t.on("change",(function(){t.room&&r.map.get(t.room).setLabelPosition(t.x,t.y)}))},O=function(t){t.on("pointerdown",(function(){t.flip()}))},S=function(t){r.state.dimensionShow||t.hide()};l.on("element-create",(function(t){t instanceof a.Wall&&y(t),t instanceof a.Room&&w(t),t instanceof a.Hollow&&k(t),t instanceof a.LabelText&&x(t),t instanceof a.Arrow&&O(t),t instanceof a.Dimension&&S(t)})),l.structure.on("change",(function(){var t,e=Object(ln["a"])(l.structure.rooms());try{for(e.s();!(t=e.n()).done;){var n=t.value;r.map.get(n).updateLabelPosition(),r.map.get(n).updateLabelText()}}catch(i){e.e(i)}finally{e.f()}r.emit("area-change",g())})),window.addEventListener("keydown",(function(t){if("Escape"===t.key){if(r.feature.tool.activated===r.feature.tool.symbol.WALL_BUILDER&&c.$state===s.Bricklayer.Builder.PICKUP_TO)return void c.drop();r.feature.tool.openDefault()}"Delete"===t.key&&l.common.remove()}));var T={originBackToCenter:function(){var t=l.width,e=l.height;l.setOrigin(t/2,e/2),l.setScale(25)},negativeBackToCenter:function(){var t=l.width,e=l.height,n=l.negative.getAllBitmapList();if(n[0]){var i=n[0],o=i.width,r=i.height;l.viewport.ViewAdjuster.backToCenter(-o/2,r/2,o/2,-r/2)}else l.setOrigin(t/2,e/2),l.setScale(25)}};return T},Hi=n("493b"),Ji=Object(an["a"])((function t(e){Object(sn["a"])(this,t),this.id=e})),Yi=function(){function t(){Object(sn["a"])(this,t),this.map=new WeakMap,this.resources={},this.classes={}}return Object(an["a"])(t,[{key:"CustomResource",value:function(t){return this.classes[t]}},{key:"get",value:function(t){return this.resources[t]}},{key:"define",value:function(t,e){var n=e,i=this,o="".concat(t,"Resource"),r=Object(D["a"])({},o,function(t){Object(yi["a"])(o,t);var e=Object(wi["a"])(o);function o(t){var r;Object(sn["a"])(this,o),r=e.call(this,t),i.resources[t]=Object(gi["a"])(r);for(var a=arguments.length,s=new Array(a>1?a-1:0),l=1;l<a;l++)s[l-1]=arguments[l];return r.data=n.Data.apply(n,s),r}return Object(an["a"])(o,[{key:"apply",value:function(t,e){return n.apply(t,this.data,e,this.id),i.map.set(t,this),this}}],[{key:"create",value:function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return Object(Hi["a"])(this,[t].concat(n))}}]),o}(Ji))[o];return this.classes[t]=r,r}}]),t}(),Ki=(n("cb29"),Math.PI),Xi=60,qi=15,Qi=10,Zi={stateless:{line:0,arcLine:14145753,fill:16777215,windowFill:13421772},hover:{line:8053503,arcLine:15464441,fill:16777215,windowFill:13421772},select:{line:4096759,arcLine:15068665,fill:16777215,windowFill:13421772},virtual:{line:16711680,arcLine:16711680,fill:16777215,windowFill:16777215}},to=function(t){var e=t.hover,n=t.focus,i=t.select,o=t.virtual;return i||n?Zi.select:e?Zi.hover:o?Zi.virtual:Zi.stateless},eo={width:800,render:function(t,e){var n=e.width,i=e.height,o=e.fliped,r=e.scale,a=o?1:0,s=qi/r,l=Xi/r,c=to(e);return t.lineStyle(s,c.arcLine).beginFill(c.fill,.1).arc(n*a,i/2,n,-Ki/2*a-Ki/2,-Ki*a/2).lineTo(n*a,i/2).lineTo(0,i/2-n+a*n).endFill().beginFill(c.fill).lineStyle(s,c.fill).drawRect(0,0,n,i).lineStyle(s,c.line).moveTo(0,0).lineTo(0,i).moveTo(n,0).lineTo(n,i).lineStyle(s,c.line).drawRect((n-l)*a,i/2,l,-n),t.pivot.x=n/2,t.pivot.y=i/2,t}},no={width:800,render:function(t,e){var n=e.width,i=e.height,o=e.scale,r=qi/o,a=Xi/o,s=to(e);return t.lineStyle(r,s.arcLine).beginFill(s.fill,.1).arc(0,i/2,n/2,-Ki/2,0).lineTo(0,i/2).lineTo(0,(i-n)/2).endFill().beginFill(s.fill,.1).lineStyle(r,s.arcLine).arc(n,i/2,n/2,Ki,-Ki/2).lineTo(n,i/2).lineTo(n/2,i/2).endFill().beginFill(s.fill).lineStyle(r,s.fill).drawRect(0,0,n,i).lineStyle(r,s.line).moveTo(0,0).lineTo(0,i).moveTo(n,0).lineTo(n,i).drawRect(0,i/2,a,-n/2).drawRect(n,i/2,-a,-n/2),t.pivot.x=n/2,t.pivot.y=i/2,t}},io={width:800,render:function(t,e){var n=e.width,i=e.height,o=e.scale,r=e.fliped,a=r?-1:1,s=qi/o,l=Qi/o,c=to(e);return t.lineStyle(s,c.line).beginFill(c.fill).drawRect(0,0,n,i).drawRect(0+s+l,i/2,2*n/3,i/4*a).drawRect(n-s-l,i/2,-2*n/3,-i/4*a),t.pivot.x=n/2,t.pivot.y=i/2,t}},oo={width:1450,render:function(t,e){var n=e.width,i=e.height,o=e.fliped,r=e.scale,a=o?1:0,s=qi/r,l=to(e);return t.lineStyle(s,l.line).beginFill(l.fill).drawRect(0,0,n,i).moveTo(0,i/3).lineTo(n,i/3).moveTo(0,2*i/3).lineTo(n,2*i/3).moveTo(n/4+a*n/2,i/3).lineTo(n/4+a*n/2,2*i/3).endFill(),t.pivot.x=n/2,t.pivot.y=i/2,t}},ro={width:2e3,render:function(t,e){var n=e.width,i=e.height,o=e.scale,r=qi/o,a=to(e);return t.lineStyle(r,a.fill).beginFill(a.fill).drawRect(0,0,n,i).endFill().lineStyle(r,a.line).drawRect(0,0,n,i/3).drawRect(0,2*i/3,n,i/3),t.pivot.x=n/2,t.pivot.y=i/2,t}},ao={width:800,render:function(t,e){var n=e.width,i=e.height,o=e.scale,r=qi/o,a=to(e);return t.lineStyle(r,a.line).beginFill(a.fill).drawRect(0,0,n,i).moveTo(0,i/2).lineTo(n,i/2).endFill(),t.pivot.x=n/2,t.pivot.y=i/2,t}},so={width:1500,render:function(t,e){var n=e.width,i=e.scale,o=e.sillThickness,r=void 0===o?500/i:o,a=e.height,s=qi/i,l=a,c=to(e);return t.lineStyle(s,c.line).beginFill(c.windowFill).drawRect(0,-r,n,r).endFill().beginFill(c.fill).moveTo(0,-a).lineTo(0,-r).lineTo(n,-r).lineTo(n,-a).lineTo(n+l,-a).lineTo(n+l,-(r+l)).lineTo(-l,-(r+l)).lineTo(-l,-a).lineTo(0,-a).endFill().moveTo(-l/2,-a).lineTo(-l/2,-(r+l/2)).lineTo(n+l/2,-(r+l/2)).lineTo(n+l/2,-a),t.pivot.x=n/2,t.pivot.y=-a/2,t}},lo={width:1500,render:function(t,e){var n=e.width,i=e.height,o=e.scale,r=qi/o,a=to(e);return t.lineStyle(r,a.line).beginFill(a.fill).drawRect(0,0,n,i).endFill().moveTo(0,i/2).lineTo(n,i/2).moveTo(0,i/3).lineTo(n,i/3).moveTo(0,2*i/3).lineTo(n,2*i/3).moveTo(n/2,i/3).lineTo(n/2,2*i/3),t.pivot.x=n/2,t.pivot.y=i/2,t}},co={render:function(t,e){var n=e.leftWidth,i=e.rightWidth,o=e.leftWallThickness,r=e.rightWallThickness,a=e.scale,s=qi/a,l=to(e);return t.lineStyle(s,l.line).beginFill(l.fill).moveTo(0,0).lineTo(i,0).lineTo(i,r).lineTo(o,r).lineTo(o,n).lineTo(0,n).lineTo(0,0).endFill().moveTo(o/2,n).lineTo(o/2,r/2).lineTo(i,r/2),t.pivot.x=i/2,t.pivot.y=r/2,t}},uo={render:function(t,e){var n=e.leftWidth,i=e.centerWidtn,o=e.rightWidth,r=e.leftWallThickness,a=e.centerWallThickness,s=e.rightWallThickness,l=e.scale,c=qi/l,u=to(e);return t.lineStyle(c,u.line).beginFill(u.fill).moveTo(0,0).lineTo(i,0).lineTo(i,o).lineTo(i-s,o).lineTo(i-s,a).lineTo(r,a).lineTo(r,n).lineTo(0,n).lineTo(0,0).endFill().moveTo(r/2,n).lineTo(r/2,a/2).lineTo(i-s/2,a/2).lineTo(i-s/2,o),t.pivot.x=i/2,t.pivot.y=a/2,t}},po={render:function(t,e){var n=e.leftWidth,i=e.rightWidth,o=e.leftWindowThickness,r=e.rightWindowThickness,a=e.leftWallThickness,s=e.rightWallThickness,l=e.scale,c=qi/l,u=to(e);return t.lineStyle(c,u.line).beginFill(u.windowFill).moveTo(a,s).lineTo(i,s).lineTo(i,s-r).lineTo(a-o,s-r).lineTo(a-o,n).lineTo(a,n).lineTo(a,s).endFill().beginFill(u.fill).moveTo(a-o,s-r).lineTo(i,s-r).lineTo(i,0).lineTo(i+s,0).lineTo(i+s,-r).lineTo(-o,-r).lineTo(-o,n+a).lineTo(0,n+a).lineTo(0,n).lineTo(a-o,n).lineTo(a-o,s-r).endFill().moveTo(0,n+a/2).lineTo(a/2-o,n+a/2).lineTo(a/2-o,s/2-r).lineTo(i+s/2,s/2-r).lineTo(i+s/2,0),t.pivot.x=i/2,t.pivot.y=s/2,t}},fo={render:function(t,e){var n=e.leftWidth,i=e.centerWidtn,o=e.rightWidth,r=e.leftWindowThinkness,a=e.centerWindowThinkness,s=e.rightWindowThinkness,l=e.leftWallThickness,c=e.centerWallThickness,u=e.rightWallThickness,p=e.scale,d=qi/p,f=to(e);return t.lineStyle(d,f.line).beginFill(f.windowFill).moveTo(l,c).lineTo(i-u,c).lineTo(i-u,o).lineTo(i-u+s,o).lineTo(i-u+s,c-a).lineTo(l-r,c-a).lineTo(l-r,n).lineTo(l,n).lineTo(l,c).endFill().beginFill(f.fill).moveTo(l-r,c-a).lineTo(i+s-u,c-a).lineTo(i+s-u,o).lineTo(i,o).lineTo(i,o+u).lineTo(i+s,o+u).lineTo(i+s,-a).lineTo(-r,-a).lineTo(-r,n+l).lineTo(0,n+l).lineTo(0,n).lineTo(l-r,n).lineTo(l-r,c-a).endFill().moveTo(0,n+l/2).lineTo(l/2-r,n+l/2).lineTo(l/2-r,c/2-a).lineTo(i+s-u/2,c/2-a).lineTo(i+s-u/2,o+u/2).lineTo(i,o+u/2),t.pivot.x=i/2,t.pivot.y=c/2,t}},ho=function(){var t=new Yi,e=p,n=d,i=t.define("Wall",{Data:function(t){return t},apply:function(t,e){t.color=e}}),o=t.define("Hollow",{Data:function(t){return t},apply:function(t,e){t.setMaterial(e)}});return i.create(1,null),i.create(2,3355443),i.create(3,16777215),o.create(100,e.SingleDoor),o.create(101,e.DoubleDoor),o.create(102,e.SlidingDoor),o.create(103,n.BasicWindow),o.create(104,n.BoilerWindow),o.create(105,e.Bealock),t},mo=null,vo=function(t){var e=t.editor;mo=setInterval((function(){e.feature.floor.updateFloorData()}),5e3),window.addEventListener("error",(function(){clearInterval(mo),e.feature.document.save(!1)}))},bo=function(t){var e={begin:function(t,e){var n=e.negative.getAllBitmapList();n[0]&&(t.bitmap={position:[n[0].x,n[0].y],rotation:n[0].rotation})},walls:function(t){t.wallList=[]},wall:function(e,n){e.wallList.push({resource:t.map.get(n).resource})},rooms:function(t){t.roomList=[]},room:function(e,n){var i=t.map.get(n);e.roomList.push({type:i.type,name:i.name,labelPosition:Object(he["a"])(i.labelPosition)})},hollows:function(t){t.hollowList=[]},hollow:function(e,n,i){var o=i.entrance.getAllArrowList().find((function(t){return t.hollow===n}));e.hollowList.push({resource:t.map.get(n).resource,entrance:o?{fliped:o.fliped}:null})}},n={end:function(t,e){if(t.bitmap){var n=t.bitmap,i=n.position,o=n.rotation,r=e.negative.createBitmap("negative".concat(t.level));r.setPosition.apply(r,Object(he["a"])(i)),r.setRotation(o)}},wall:function(e,n,i){var o=e.wallList[i],r=t.map.get(n);r.setResource(o.resource)},room:function(e,n,i){var o=e.roomList[i],r=o.name,a=o.type,s=o.labelPosition,l=t.map.get(n);r&&l.setName(r),a&&l.setType(a),s&&l.setLabelPosition.apply(l,Object(he["a"])(s))},hollow:function(e,n,i){var o=e.hollowList[i],r=o.resource,a=o.entrance,s=t.map.get(n);s.setResource(r),a&&s.setEntrance(a.fliped)}};return{serializer:e,deserializer:n}},go=10,yo=function(t,e){return new Promise((function(n){var i=e.drawing,o=e.hollowList,r=e.wallList,a=e.roomList;t.deserialize({drawing:i,hollowList:o,wallList:r,roomList:a}),setTimeout((function(){var e,i=t.solution.drawing,o=Object(ln["a"])(i.measure.dimensions());try{for(o.s();!(e=o.n()).done;){var r=e.value;r.hide()}}catch(C){o.e(C)}finally{o.f()}var a=i.getElementContainerBounds("Wall"),s=i.getElementContainerBounds("Hollow"),l=0!==a.width&&0!==a.height,c=0!==s.width&&0!==s.height;if(l||c){var u=i.scale,p=t.screenshot(),d=i.toGeometry(a.x,a.y),f=Object(en["a"])(d,2),h=f[0],m=f[1],v=i.toGeometry(s.x,s.y),b=Object(en["a"])(v,2),g=b[0],y=b[1],w=a.width*u,k=a.height*u,x=s.width*u,O=s.height*u;if(l)if(c){var S=Math.min(h,g),T=Math.max(m,y),j=Math.max(h+w,g+x)-S,_=T-Math.min(m-k,y-O);n({base64:p,width:j,height:_,x:S,y:T})}else n({base64:p,x:h,y:m,width:w,height:k});else n({base64:p,x:g,y:y,width:x,height:O})}else n(null)}))}))},wo=function(t,e){return new Promise((function(n){var i=[];setTimeout(Object(O["a"])(Object(x["a"])().mark((function o(){var r,a,s,l;return Object(x["a"])().wrap((function(o){while(1)switch(o.prev=o.next){case 0:r=Object(ln["a"])(e.list),o.prev=1,r.s();case 3:if((a=r.n()).done){o.next=11;break}return s=a.value,o.next=7,yo(t,s);case 7:l=o.sent,i.push(l);case 9:o.next=3;break;case 11:o.next=16;break;case 13:o.prev=13,o.t0=o["catch"](1),r.e(o.t0);case 16:return o.prev=16,r.f(),o.finish(16);case 19:n(i);case 20:case"end":return o.stop()}}),o,null,[[1,13,16,19]])}))))}))},ko=function(t){var e=t.Solution,n=t.editor,i={Wall:e.Element.Wall,Room:e.Element.Room,Hollow:e.Element.Hollow},o=function(t){Object(yi["a"])(o,t);var n=Object(wi["a"])(o);function o(){var t;Object(sn["a"])(this,o),t=n.call(this),t.map=new WeakMap,t.solution=new e(bo(Object(gi["a"])(t)));var r=t.solution.drawing;return t.feature={resource:ho()},r.on("element-create",(function(e){e instanceof i.Wall&&t.map.set(e,new Fi(e,Object(gi["a"])(t))),e instanceof i.Room&&t.map.set(e,new Ii(e,Object(gi["a"])(t))),e instanceof i.Hollow&&t.map.set(e,new Ui(e,Object(gi["a"])(t))),e.on("destory",(function(){return t.map.delete(e)}))})),r.mount(document.createElement("div")),r.compass.element.hide(),r.setScale(go),t}return Object(an["a"])(o,[{key:"deserialize",value:function(t){var e=this.solution.drawing,n=e.structure.getAllCornerList(),i=e.windoor.getAllHollowList(),o=e.negative.getAllBitmapList();i.forEach((function(t){return t.remove()})),n.forEach((function(t){return t.remove()})),o.forEach((function(t){return t.remove()})),this.solution.deserializer.execute(t.drawing,t)}},{key:"screenshot",value:function(){return this.solution.drawing.screenshot()}}]),o}(xi);return{screenshot:function(){return Object(O["a"])(Object(x["a"])().mark((function t(){var e,i;return Object(x["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n.feature.floor.updateFloorData(),e=new o,i=n.feature.floor.getData(),t.next=5,wo(e,i);case 5:return t.abrupt("return",t.sent);case 6:case"end":return t.stop()}}),t)})))()}}},xo=function(t){var e=t.Solution,n=t.accessor,i={Corner:e.Element.Corner,Wall:e.Element.Wall,Room:e.Element.Room,Hollow:e.Element.Hollow,LabelText:e.Element.LabelText,Bitmap:e.Element.Bitmap,Arrow:e.Element.Arrow,Dimension:e.Element.Dimension},o={Ready:e.Tool.Ready,Common:e.Tool.Common,Hammer:e.Tool.Hammer,Bricklayer:e.Tool.Bricklayer},r=function(t){return Object.freeze({editor:t,Element:i,Tool:o,accessor:n,Solution:e})},a=function(t){Object(yi["a"])(o,t);var n=Object(wi["a"])(o);function o(){var t;Object(sn["a"])(this,o),t=n.call(this),t.map=new WeakMap,t.data={},t.state={roomNameShow:!0,roomAreaShow:!0,dimensionShow:!0,snap:!0};var a=r(Object(gi["a"])(t)),p=new e(bo(Object(gi["a"])(t))),d=p.drawing;return t.solution=p,t.feature={document:s.install(a),floor:l.install(a),tool:c.install(a),drawing:u.install(a),resource:f.install(a),screenshoter:m.install(a)},h.install(a),t.feature.document.open(),d.common.on("selector-add",(function(e){var n=e.map((function(e){return t.map.get(e)||null}));t.emit("select",n)})),d.common.on("selector-clear",(function(){t.emit("unselect")})),d.on("element-create",(function(e){e instanceof i.Wall?t.emit("wall-create",e):e instanceof i.Room?t.emit("room-create",e):e instanceof i.Hollow?t.emit("hollow-create",e):e instanceof i.Bitmap&&t.emit("bitmap-create",e)})),d.on("element-destroy",(function(e){e instanceof i.Wall?t.emit("wall-destroy",e):e instanceof i.Room?t.emit("room-destroy",e):e instanceof i.Hollow&&t.emit("hollow-destroy",e)})),p.tool.on("open",(function(e){t.emit("tool-open",e)})),d.compass.element.on("change",(function(e){t.emit("compass-change",e)})),Object.freeze(Object(gi["a"])(t)),t}return Object(an["a"])(o,[{key:"Element",get:function(){return i}},{key:"getSelected",value:function(){var t=this;return this.solution.drawing.common.getSelectedList().map((function(e){return t.map.get(e)||null}))}},{key:"getState",value:function(){return this.state}},{key:"serialize",value:function(){var t=this.feature.floor,e=t.currentFloor,n=this.solution.serializer.execute(e);return e.drawing=n,t.getData().list.forEach((function(t){t.drawing.compass?t.drawing.compass.rotation=n.compass.rotation:t.drawing.compass={rotation:n.compass.rotation}})),e}},{key:"deserialize",value:function(t){this.solution.deserializer.execute(t.drawing,t)}},{key:"updateAllRoomLabel",value:function(){var t,e=Object(ln["a"])(this.solution.drawing.structure.rooms());try{for(e.s();!(t=e.n()).done;){var n=t.value;this.map.get(n).updateLabelText()}}catch(i){e.e(i)}finally{e.f()}}},{key:"setRoomNameShow",value:function(t){this.state.roomNameShow=t,this.updateAllRoomLabel()}},{key:"setRoomAreaShow",value:function(t){this.state.roomAreaShow=t,this.updateAllRoomLabel()}},{key:"setDimensionShow",value:function(t){this.state.dimensionShow=t;var e,n=Object(ln["a"])(this.solution.drawing.measure.dimensions());try{for(n.s();!(e=n.n()).done;){var i=e.value;t?i.show():i.hide()}}catch(o){n.e(o)}finally{n.f()}}},{key:"setSnap",value:function(t){var e=this.solution.drawing;e.grid.options.rectangular.snap.enabled=t,e.structure.options.snap.corner.active=t,this.state.snap=t}},{key:"negativeRotate",value:function(t){var e=this.solution.drawing.negative.getAllBitmapList(),n=this.feature.floor.getData();e[0].setRotation(t);var i,o=Object(ln["a"])(n.list);try{for(o.s();!(i=o.n()).done;){var r=i.value;r.bitmap.rotation=t}}catch(a){o.e(a)}finally{o.f()}}},{key:"delete",value:function(){this.solution.drawing.common.remove()}}]),o}(xi);return a},Oo=function(t){return!!t&&("string"===typeof t.name&&(!!Number.isInteger(t.base)&&!!Array.isArray(t.list)))},So=function(t){return!(!t||!t.floor)&&("string"===typeof t.name&&(!!Number.isInteger(t.floor.base)&&!!Array.isArray(t.floor.list)))},To=function(t){return{name:t.name,floor:{base:0,list:t.list.map((function(t){return{name:"",level:t.level,bitmap:{position:[0,0],rotation:0},drawing:{compass:{rotation:0},cornerList:[],wallList:[],roomList:[],hollowList:[],stuffList:[],labelTextList:[],labelLineList:[]}}}))}}},jo={install:function(t,e){var n=xo(e);t.prototype.$editor=new n}},_o=location.origin+"",Co="c07782ca_on4j_b6f9_cs_1",$o="2022-08-16-13-48-02",Lo="17STfo8rNMM",Do="eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VyX2lkIjoxLCJ1c2VybmFtZSI6ImFkbWluX2FjY291bnQiLCJleHAiOjE2NjE5NDc2MTUsImVtYWlsIjoiNTUzOTA0NjVAcXEuY29tIiwib3JpZ19pYXQiOjE2NjA3MzgwMTUsImlkZW50aXR5X2NvZGUiOiIiLCJjb21wYW55X2lkIjoxfQ.v6HAlTn7X4I81Jo_avY_2flbzT_JtGnVL7WhWjhLnJU",Wo=function(){var t=Object(O["a"])(Object(x["a"])().mark((function t(e){var n;return Object(x["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.json();case 2:if(n=t.sent,1!==n.code){t.next=7;break}return t.abrupt("return",n.data);case 7:return t.abrupt("return",null);case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),Ro=function(){function t(){Object(sn["a"])(this,t)}return Object(an["a"])(t,[{key:"getTicket",value:function(){return fetch(_o+"/ticket/").then((function(){return""}))}},{key:"getModel",value:function(){return fetch("".concat(_o,"/model_data/"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:Do},body:JSON.stringify({model_id:Co,model_version:$o,scene_id:Lo})}).then((function(t){return Wo(t)}))}},{key:"getDrawing",value:function(){return fetch("".concat(_o,"/manager/?model=").concat(Co,"&model_version=").concat($o,"&work=").concat(Lo),{method:"GET",headers:{Authorization:Do}}).then((function(t){return Wo(t)})).then((function(t){return JSON.parse(t.drawing)}))}},{key:"saveDrawing",value:function(t){return t.append("model",Co),t.append("model_version",$o),t.append("work",Lo),fetch("".concat(_o,"/manager/"),{method:"POST",headers:{Authorization:Do},body:t}).then((function(t){return Wo(t)}))}},{key:"getEditState",value:function(){return fetch(_o+"/").then((function(){return!1}))}}]),t}(),Eo=new Ro,No={install:function(t,e){_o=e.baseURL,t.prototype.$e100=Eo}},Po={selector:"selector",transformer:"transformer",save:"save",clear:"clear",lock:"lock",unlock:"unlock"},Ao=(_i={},Object(D["a"])(_i,Po.selector,{label:"选择",image:{base:"img/Pointer.svg",active:"img/Pointer_Active.svg"}}),Object(D["a"])(_i,Po.transformer,{label:"移动",image:{base:"img/Move.svg",active:"img/Move_Active.svg"}}),Object(D["a"])(_i,Po.save,{label:"保存",image:{base:"img/Save.svg"}}),Object(D["a"])(_i,Po.clear,{label:"清空",image:{base:"img/Clear.svg"}}),Object(D["a"])(_i,Po.lock,{label:"锁定",image:{base:"img/Lock.svg"}}),Object(D["a"])(_i,Po.unlock,{label:"解锁",image:{base:"img/Lock.svg"}}),_i),Fo={singleDoor:"singleDoor",doubleDoor:"doubleDoor",slidingDoor:"slidingDoor",basicWindow:"basicWindow",boilerWindow:"boilerWindow",bealock:"bealock"},Mo={door:"door",window:"window",bealock:"bealock"},Bo={entrance:"entrance",flipWall:"flipWall",flip:"flip",delete:"delete"},zo=(Ci={},Object(D["a"])(Ci,Fo.singleDoor,{label:"单开门",resource:100}),Object(D["a"])(Ci,Fo.doubleDoor,{label:"双开门",resource:101}),Object(D["a"])(Ci,Fo.slidingDoor,{label:"推拉门",resource:102}),Object(D["a"])(Ci,Fo.basicWindow,{label:"普通窗",resource:103}),Object(D["a"])(Ci,Fo.boilerWindow,{label:"一字飘窗",resource:104}),Object(D["a"])(Ci,Fo.bealock,{label:"垭口",resource:105}),Ci),Io=($i={},Object(D["a"])($i,Mo.door,{label:"门",list:[Fo.singleDoor,Fo.doubleDoor,Fo.slidingDoor]}),Object(D["a"])($i,Mo.window,{label:"窗",list:[Fo.basicWindow,Fo.boilerWindow]}),Object(D["a"])($i,Mo.bealock,{label:"垭口",list:[Fo.bealock]}),$i),Vo=(Li={},Object(D["a"])(Li,Bo.entrance,{label:"入户门",image:{base:"img/Entrance.svg"}}),Object(D["a"])(Li,Bo.flipWall,{label:"墙侧翻转",image:{base:"img/FlipWall.svg"}}),Object(D["a"])(Li,Bo.flip,{label:"翻转",image:{base:"img/Flip.svg"}}),Object(D["a"])(Li,Bo.delete,{label:"删除",image:{base:"img/Delete.svg"}}),Li),Uo={common:"common",bearing:"bearing",short:"short"},Go={split:"split",delete:"delete"},Ho=(Di={},Object(D["a"])(Di,Uo.common,{label:"普通墙",resource:1}),Object(D["a"])(Di,Uo.bearing,{label:"承重墙",resource:2}),Object(D["a"])(Di,Uo.short,{label:"矮墙",resource:3}),Di),Jo=(Wi={},Object(D["a"])(Wi,Go.split,{label:"截断",image:{base:"img/Split.svg"}}),Object(D["a"])(Wi,Go.delete,{label:"删除",image:{base:"img/Delete.svg"}}),Wi),Yo=["客厅","餐厅","客餐厅","厨房","主卧","次卧","卧室","老人房","儿童房","过道","阳台","卫生间","玄关","地下室"],Ko={install:function(t){t.prototype.$spec={menu:b,hollow:g,wall:y,room:w}}},Xo=(n("2b3d"),n("9861"),n("c6c5")),qo=function(){var t=Object(O["a"])(Object(x["a"])().mark((function t(){var e,n,i,o,r,a=arguments;return Object(x["a"])().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=a.length>0&&void 0!==a[0]?a[0]:function(){},t.next=3,Eo.getTicket();case 3:n=t.sent,i=new URL(location.href),o=i.searchParams.get("host")||"127.0.0.1",r=i.searchParams.get("port")||"3001",Xo["a"]({origin:"http://".concat(o,":").concat(r),ticket:n},(function(t,n){window.PIXI=n.PIXI,e(t)}));case 8:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),Qo=n("8f9c");qo((function(t){var e=location.origin+"/api/v1/e100/business/house_plan";S["default"].use(T["a"],Qo),S["default"].use(j["a"]),S["default"].use(No,{baseURL:e}),S["default"].use(Ko),S["default"].use(jo,{Solution:t,accessor:{save:function(t){return Object(O["a"])(Object(x["a"])().mark((function e(){return Object(x["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:console.log(t);case 1:case"end":return e.stop()}}),e)})))()},open:function(){return Object(O["a"])(Object(x["a"])().mark((function e(){var n,i,o,r,a;return Object(x["a"])().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=[{name:"测试1",info:{center_point_coordinates:{u:.4268035292625427,v:.4820511341094971},direction:0,floor_height:6.162445068359375,flooridx:0,height:1477,planformUrl:"https://bucket-model.oss-cn-beijing.aliyuncs.com/c07782ca_on4j_b6f9_cs_1/2022-08-16-13-48-02/map_fit_00.png",ratio:.1,width:1147},locations:[]},{name:"测试2",info:{center_point_coordinates:{u:.5011234283447266,v:.5610423684120178},direction:0,floor_height:3.563536167144775,flooridx:1,height:1477,planformUrl:"https://bucket-model.oss-cn-beijing.aliyuncs.com/c07782ca_on4j_b6f9_cs_1/2022-08-16-13-48-02/map_fit_01.png",ratio:.1,width:1147},locations:[]}],i={name:n[0].name,base:0,list:n.map((function(t){return{level:t.info.flooridx,bitmap:t.info.planformUrl,scale:t.info.ratio}}))},v.isHouse(i)){e.next=4;break}throw new TypeError("Invalid house, a house object expected.");case 4:return e.next=6,t.Registry.negativeListRegister(i.list.map((function(t){return{id:"negative".concat(t.level),url:t.bitmap,scale:t.scale}})));case 6:if(o=v.fromHouse(i),null!==o&&0!==Object.keys(o).length){e.next=17;break}return r=v.fromHouse(i),a=new FormData,a.append("drawing",JSON.stringify(r)),a.append("map",JSON.stringify([])),e.next=14,Eo.saveDrawing(a);case 14:return e.next=16,Eo.getDrawing();case 16:o=e.sent;case 17:if(v.isDrawing(o)){e.next=19;break}throw new TypeError("Invalid drawing, a drawing object expected.");case 19:return o.name=n[0].name,e.abrupt("return",{drawing:o,model:n.map((function(t){return{info:t.info,locations:t.locations}}))});case 21:case"end":return e.stop()}}),e)})))()}}});var n=new S["default"]({render:function(t){return t(bi)}});window.addEventListener("keydown",(function(t){t.altKey&&t.preventDefault()})),window.addEventListener("resize",(function(){n.$emit("drawing-resize")})),n.$mount("#app")}))},"687c":function(t,e,n){"use strict";n("2b1a")},"698f":function(t,e,n){"use strict";n("389a")},"6db6":function(t,e,n){"use strict";n("aeae")},"783f":function(t,e,n){"use strict";n("ddc3")},"78a9":function(t,e,n){"use strict";n("026c")},"7b33":function(t,e,n){"use strict";n("b2ed")},8899:function(t,e,n){},"88d6":function(t,e,n){},"8f9c":function(t){t.exports=JSON.parse('{"breakpoints":["xs","sm","md","lg","xl","xxl"],"formControls":{"size":"sm"},"BLink":{"activeClass":"active"},"BButton":{"variant":"primary","size":"sm"},"BToast":{"toaster":"b-toaster-top-center","autoHideDelay":3000,"variant":"primary","toastClass":null,"headerClass":null,"bodyClass":null},"BModal":{"cancelVariant":"secondary","okVariant":"primary"},"BFormGroup":{"labelSize":"sm"},"BInputGroup":{"size":"sm"},"BNavItem":{"linkClasses":["p-0","px-1"]}}')},9018:function(t,e,n){},9342:function(t,e,n){"use strict";n("f083")},"95f6":function(t,e,n){"use strict";n("cdee")},aeae:function(t,e,n){},b2ed:function(t,e,n){},bb78:function(t,e,n){"use strict";n("5051")},cdee:function(t,e,n){},ddc3:function(t,e,n){},f083:function(t,e,n){},f709:function(t,e,n){"use strict";n("fabd")},fabd:function(t,e,n){}});